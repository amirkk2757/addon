---
# Source: gitops-bridge/templates/applicationsets.yaml
apiVersion: argoproj.io/v1alpha1
kind: ApplicationSet
metadata:
  name: ack-apigatewayv2
  namespace: argocd
  annotations:
    helm.sh/chart: gitops-bridge-1.0.0
  labels:
    helm.sh/chart: gitops-bridge-1.0.0
    app.kubernetes.io/name: gitops-bridge
    app.kubernetes.io/instance: my-release
    app.kubernetes.io/managed-by: Helm
    addon: "true"
spec:
  syncPolicy:
    preserveResourcesOnDeletion: true
  goTemplate: true
  goTemplateOptions:
  - missingkey=error
  generators:
          - clusters: # for reason this is need it as second in the matrix, if not the above extracting .tenants doesn't work
              selector:
                matchLabels:
                  argocd.argoproj.io/secret-type: cluster
                matchExpressions:
                - key: enable_ack_apigatewayv2
                  operator: In
                  values:
                  - "true"


  template:
    metadata:
      name: addon-ack-apigatewayv2-{{.nameNormalized}}
      annotations:
        argocd.argoproj.io/manifest-generate-paths: default/addons/ack-apigatewayv2/values.yaml;environments/{{.metadata.labels.environment}}/addons/ack-apigatewayv2/values.yaml;clusters/{{.nameNormalized}}/addons/ack-apigatewayv2/values.yaml;
        helm.sh/chart: gitops-bridge-1.0.0
      labels:
        helm.sh/chart: gitops-bridge-1.0.0
        app.kubernetes.io/name: gitops-bridge
        app.kubernetes.io/instance: my-release
        app.kubernetes.io/managed-by: Helm
        addon: "true"
        component: 'ack-apigatewayv2'
        environment: '{{.metadata.labels.environment}}'
        cluster: '{{.name}}'
    spec:
      project: default
      sources:
      - repoURL: '{{.metadata.annotations.addons_repo_url}}'
        targetRevision: '{{.metadata.annotations.addons_repo_revision}}'
        ref: values
      - repoURL: 'public.ecr.aws'
        targetRevision: '1.0.20'
        chart: 'aws-controllers-k8s/apigatewayv2-chart'
        helm:
          releaseName: 'ack-apigatewayv2'
          ignoreMissingValueFiles: true
          valueFiles:
            - '$values/default/addons/ack-apigatewayv2/values.yaml'
            - '$values/default/addons/ack-apigatewayv2/1.0/values.yaml'
            - '$values/environments/{{.metadata.labels.environment}}/addons/ack-apigatewayv2/values.yaml'
            - '$values/environments/{{.metadata.labels.environment}}/addons/ack-apigatewayv2/1.0/values.yaml'
            - '$values/clusters/{{.nameNormalized}}/addons/ack-apigatewayv2/values.yaml'
            - '$values/clusters/{{.nameNormalized}}/addons/ack-apigatewayv2/1.0/values.yaml'
          valuesObject:
            aws:
              region: '{{.metadata.annotations.aws_region}}'
            nameOverride: aws-controllers-k8s
            serviceAccount:
              annotations:
                eks.amazonaws.com/role-arn: '{{.metadata.annotations.ack_apigatewayv2_iam_role_arn}}'
              name: '{{.metadata.annotations.ack_apigatewayv2_service_account}}'
      destination:
        namespace: '{{ default "aws-controllers-k8s" (index .metadata.annotations "ack_apigatewayv2_namespace")}}'
        name: '{{.name}}'
      syncPolicy:
        automated:
          allowEmpty: true
          prune: false
          selfHeal: false
        retry:
          backoff:
            duration: 5s
            factor: 2
            maxDuration: 10m
          limit: -1
        syncOptions:
        - CreateNamespace=true
        - ServerSideApply=true
---
# Source: gitops-bridge/templates/applicationsets.yaml
apiVersion: argoproj.io/v1alpha1
kind: ApplicationSet
metadata:
  name: ack-dynamodb
  namespace: argocd
  annotations:
    helm.sh/chart: gitops-bridge-1.0.0
  labels:
    helm.sh/chart: gitops-bridge-1.0.0
    app.kubernetes.io/name: gitops-bridge
    app.kubernetes.io/instance: my-release
    app.kubernetes.io/managed-by: Helm
    addon: "true"
spec:
  syncPolicy:
    preserveResourcesOnDeletion: true
  goTemplate: true
  goTemplateOptions:
  - missingkey=error
  generators:
          - clusters: # for reason this is need it as second in the matrix, if not the above extracting .tenants doesn't work
              selector:
                matchLabels:
                  argocd.argoproj.io/secret-type: cluster
                matchExpressions:
                - key: enable_ack_dynamodb
                  operator: In
                  values:
                  - "true"


  template:
    metadata:
      name: addon-ack-dynamodb-{{.nameNormalized}}
      annotations:
        argocd.argoproj.io/manifest-generate-paths: default/addons/ack-dynamodb/values.yaml;environments/{{.metadata.labels.environment}}/addons/ack-dynamodb/values.yaml;clusters/{{.nameNormalized}}/addons/ack-dynamodb/values.yaml;
        helm.sh/chart: gitops-bridge-1.0.0
      labels:
        helm.sh/chart: gitops-bridge-1.0.0
        app.kubernetes.io/name: gitops-bridge
        app.kubernetes.io/instance: my-release
        app.kubernetes.io/managed-by: Helm
        addon: "true"
        component: 'ack-dynamodb'
        environment: '{{.metadata.labels.environment}}'
        cluster: '{{.name}}'
    spec:
      project: default
      sources:
      - repoURL: '{{.metadata.annotations.addons_repo_url}}'
        targetRevision: '{{.metadata.annotations.addons_repo_revision}}'
        ref: values
      - repoURL: 'public.ecr.aws'
        targetRevision: '1.2.18'
        chart: 'aws-controllers-k8s/dynamodb-chart'
        helm:
          releaseName: 'ack-dynamodb'
          ignoreMissingValueFiles: true
          valueFiles:
            - '$values/default/addons/ack-dynamodb/values.yaml'
            - '$values/default/addons/ack-dynamodb/1.2/values.yaml'
            - '$values/environments/{{.metadata.labels.environment}}/addons/ack-dynamodb/values.yaml'
            - '$values/environments/{{.metadata.labels.environment}}/addons/ack-dynamodb/1.2/values.yaml'
            - '$values/clusters/{{.nameNormalized}}/addons/ack-dynamodb/values.yaml'
            - '$values/clusters/{{.nameNormalized}}/addons/ack-dynamodb/1.2/values.yaml'
          valuesObject:
            aws:
              region: '{{.metadata.annotations.aws_region}}'
            nameOverride: aws-controllers-k8s
            serviceAccount:
              annotations:
                eks.amazonaws.com/role-arn: '{{.metadata.annotations.ack_dynamodb_iam_role_arn}}'
              name: '{{.metadata.annotations.ack_dynamodb_service_account}}'
      destination:
        namespace: '{{ default "aws-controllers-k8s" (index .metadata.annotations "ack_dynamodb_namespace")}}'
        name: '{{.name}}'
      syncPolicy:
        automated:
          allowEmpty: true
          prune: false
          selfHeal: false
        retry:
          backoff:
            duration: 5s
            factor: 2
            maxDuration: 10m
          limit: -1
        syncOptions:
        - CreateNamespace=true
        - ServerSideApply=true
---
# Source: gitops-bridge/templates/applicationsets.yaml
apiVersion: argoproj.io/v1alpha1
kind: ApplicationSet
metadata:
  name: ack-ec2
  namespace: argocd
  annotations:
    helm.sh/chart: gitops-bridge-1.0.0
  labels:
    helm.sh/chart: gitops-bridge-1.0.0
    app.kubernetes.io/name: gitops-bridge
    app.kubernetes.io/instance: my-release
    app.kubernetes.io/managed-by: Helm
    addon: "true"
spec:
  syncPolicy:
    preserveResourcesOnDeletion: true
  goTemplate: true
  goTemplateOptions:
  - missingkey=error
  generators:
          - clusters: # for reason this is need it as second in the matrix, if not the above extracting .tenants doesn't work
              selector:
                matchLabels:
                  argocd.argoproj.io/secret-type: cluster
                matchExpressions:
                - key: enable_ack_ec2
                  operator: In
                  values:
                  - "true"


  template:
    metadata:
      name: addon-ack-ec2-{{.nameNormalized}}
      annotations:
        argocd.argoproj.io/manifest-generate-paths: default/addons/ack-ec2/values.yaml;environments/{{.metadata.labels.environment}}/addons/ack-ec2/values.yaml;clusters/{{.nameNormalized}}/addons/ack-ec2/values.yaml;
        helm.sh/chart: gitops-bridge-1.0.0
      labels:
        helm.sh/chart: gitops-bridge-1.0.0
        app.kubernetes.io/name: gitops-bridge
        app.kubernetes.io/instance: my-release
        app.kubernetes.io/managed-by: Helm
        addon: "true"
        component: 'ack-ec2'
        environment: '{{.metadata.labels.environment}}'
        cluster: '{{.name}}'
    spec:
      project: default
      sources:
      - repoURL: '{{.metadata.annotations.addons_repo_url}}'
        targetRevision: '{{.metadata.annotations.addons_repo_revision}}'
        ref: values
      - repoURL: 'public.ecr.aws'
        targetRevision: '1.3.4'
        chart: 'aws-controllers-k8s/ec2-chart'
        helm:
          releaseName: 'ack-ec2'
          ignoreMissingValueFiles: true
          valueFiles:
            - '$values/default/addons/ack-ec2/values.yaml'
            - '$values/default/addons/ack-ec2/1.3/values.yaml'
            - '$values/environments/{{.metadata.labels.environment}}/addons/ack-ec2/values.yaml'
            - '$values/environments/{{.metadata.labels.environment}}/addons/ack-ec2/1.3/values.yaml'
            - '$values/clusters/{{.nameNormalized}}/addons/ack-ec2/values.yaml'
            - '$values/clusters/{{.nameNormalized}}/addons/ack-ec2/1.3/values.yaml'
          valuesObject:
            aws:
              region: '{{.metadata.annotations.aws_region}}'
            nameOverride: aws-controllers-k8s
            serviceAccount:
              annotations:
                eks.amazonaws.com/role-arn: '{{ default "" (index .metadata.annotations "ack_ec2_iam_role_arn")}}'
              name: '{{ default "ack-ec2-controller" (index .metadata.annotations "ack_ec2_service_account")}}'
      destination:
        namespace: '{{ default "aws-controllers-k8s" (index .metadata.annotations "ack_ec2_namespace")}}'
        name: '{{.name}}'
      syncPolicy:
        automated:
          allowEmpty: true
          prune: false
          selfHeal: false
        retry:
          backoff:
            duration: 5s
            factor: 2
            maxDuration: 10m
          limit: -1
        syncOptions:
        - CreateNamespace=true
        - ServerSideApply=true
---
# Source: gitops-bridge/templates/applicationsets.yaml
apiVersion: argoproj.io/v1alpha1
kind: ApplicationSet
metadata:
  name: ack-eks
  namespace: argocd
  annotations:
    helm.sh/chart: gitops-bridge-1.0.0
  labels:
    helm.sh/chart: gitops-bridge-1.0.0
    app.kubernetes.io/name: gitops-bridge
    app.kubernetes.io/instance: my-release
    app.kubernetes.io/managed-by: Helm
    addon: "true"
spec:
  syncPolicy:
    preserveResourcesOnDeletion: true
  goTemplate: true
  goTemplateOptions:
  - missingkey=error
  generators:
          - clusters: # for reason this is need it as second in the matrix, if not the above extracting .tenants doesn't work
              selector:
                matchLabels:
                  argocd.argoproj.io/secret-type: cluster
                matchExpressions:
                - key: enable_ack_eks
                  operator: In
                  values:
                  - "true"


  template:
    metadata:
      name: addon-ack-eks-{{.nameNormalized}}
      annotations:
        argocd.argoproj.io/manifest-generate-paths: default/addons/ack-eks/values.yaml;environments/{{.metadata.labels.environment}}/addons/ack-eks/values.yaml;clusters/{{.nameNormalized}}/addons/ack-eks/values.yaml;
        helm.sh/chart: gitops-bridge-1.0.0
      labels:
        helm.sh/chart: gitops-bridge-1.0.0
        app.kubernetes.io/name: gitops-bridge
        app.kubernetes.io/instance: my-release
        app.kubernetes.io/managed-by: Helm
        addon: "true"
        component: 'ack-eks'
        environment: '{{.metadata.labels.environment}}'
        cluster: '{{.name}}'
    spec:
      project: default
      sources:
      - repoURL: '{{.metadata.annotations.addons_repo_url}}'
        targetRevision: '{{.metadata.annotations.addons_repo_revision}}'
        ref: values
      - repoURL: 'public.ecr.aws'
        targetRevision: '1.6.0'
        chart: 'aws-controllers-k8s/eks-chart'
        helm:
          releaseName: 'ack-eks'
          ignoreMissingValueFiles: true
          valueFiles:
            - '$values/default/addons/ack-eks/values.yaml'
            - '$values/default/addons/ack-eks/1.6/values.yaml'
            - '$values/environments/{{.metadata.labels.environment}}/addons/ack-eks/values.yaml'
            - '$values/environments/{{.metadata.labels.environment}}/addons/ack-eks/1.6/values.yaml'
            - '$values/clusters/{{.nameNormalized}}/addons/ack-eks/values.yaml'
            - '$values/clusters/{{.nameNormalized}}/addons/ack-eks/1.6/values.yaml'
          valuesObject:
            aws:
              region: '{{.metadata.annotations.aws_region}}'
            nameOverride: aws-controllers-k8s
            serviceAccount:
              annotations:
                eks.amazonaws.com/role-arn: '{{ default "" (index .metadata.annotations "ack_eks_iam_role_arn")}}'
              name: '{{ default "ack-eks-controller" (index .metadata.annotations "ack_eks_service_account")}}'
      destination:
        namespace: '{{ default "aws-controllers-k8s" (index .metadata.annotations "ack_eks_namespace")}}'
        name: '{{.name}}'
      syncPolicy:
        automated:
          allowEmpty: true
          prune: false
          selfHeal: false
        retry:
          backoff:
            duration: 5s
            factor: 2
            maxDuration: 10m
          limit: -1
        syncOptions:
        - CreateNamespace=true
        - ServerSideApply=true
---
# Source: gitops-bridge/templates/applicationsets.yaml
apiVersion: argoproj.io/v1alpha1
kind: ApplicationSet
metadata:
  name: ack-emrcontainers
  namespace: argocd
  annotations:
    helm.sh/chart: gitops-bridge-1.0.0
  labels:
    helm.sh/chart: gitops-bridge-1.0.0
    app.kubernetes.io/name: gitops-bridge
    app.kubernetes.io/instance: my-release
    app.kubernetes.io/managed-by: Helm
    addon: "true"
spec:
  syncPolicy:
    preserveResourcesOnDeletion: true
  goTemplate: true
  goTemplateOptions:
  - missingkey=error
  generators:
          - clusters: # for reason this is need it as second in the matrix, if not the above extracting .tenants doesn't work
              selector:
                matchLabels:
                  argocd.argoproj.io/secret-type: cluster
                matchExpressions:
                - key: enable_ack_emrcontainers
                  operator: In
                  values:
                  - "true"


  template:
    metadata:
      name: addon-ack-emrcontainers-{{.nameNormalized}}
      annotations:
        argocd.argoproj.io/manifest-generate-paths: default/addons/ack-emrcontainers/values.yaml;environments/{{.metadata.labels.environment}}/addons/ack-emrcontainers/values.yaml;clusters/{{.nameNormalized}}/addons/ack-emrcontainers/values.yaml;
        helm.sh/chart: gitops-bridge-1.0.0
      labels:
        helm.sh/chart: gitops-bridge-1.0.0
        app.kubernetes.io/name: gitops-bridge
        app.kubernetes.io/instance: my-release
        app.kubernetes.io/managed-by: Helm
        addon: "true"
        component: 'ack-emrcontainers'
        environment: '{{.metadata.labels.environment}}'
        cluster: '{{.name}}'
    spec:
      project: default
      sources:
      - repoURL: '{{.metadata.annotations.addons_repo_url}}'
        targetRevision: '{{.metadata.annotations.addons_repo_revision}}'
        ref: values
      - repoURL: 'public.ecr.aws'
        targetRevision: '1.0.16'
        chart: 'aws-controllers-k8s/emrcontainers-chart'
        helm:
          releaseName: 'ack-emrcontainers'
          ignoreMissingValueFiles: true
          valueFiles:
            - '$values/default/addons/ack-emrcontainers/values.yaml'
            - '$values/default/addons/ack-emrcontainers/1.0/values.yaml'
            - '$values/environments/{{.metadata.labels.environment}}/addons/ack-emrcontainers/values.yaml'
            - '$values/environments/{{.metadata.labels.environment}}/addons/ack-emrcontainers/1.0/values.yaml'
            - '$values/clusters/{{.nameNormalized}}/addons/ack-emrcontainers/values.yaml'
            - '$values/clusters/{{.nameNormalized}}/addons/ack-emrcontainers/1.0/values.yaml'
          valuesObject:
            aws:
              region: '{{.metadata.annotations.aws_region}}'
            nameOverride: aws-controllers-k8s
            serviceAccount:
              annotations:
                eks.amazonaws.com/role-arn: '{{.metadata.annotations.ack_emrcontainers_iam_role_arn}}'
              name: '{{.metadata.annotations.ack_emrcontainers_service_account}}'
      destination:
        namespace: '{{ default "aws-controllers-k8s" (index .metadata.annotations "ack_emrcontainers_namespace")}}'
        name: '{{.name}}'
      syncPolicy:
        automated:
          allowEmpty: true
          prune: false
          selfHeal: false
        retry:
          backoff:
            duration: 5s
            factor: 2
            maxDuration: 10m
          limit: -1
        syncOptions:
        - CreateNamespace=true
        - ServerSideApply=true
---
# Source: gitops-bridge/templates/applicationsets.yaml
apiVersion: argoproj.io/v1alpha1
kind: ApplicationSet
metadata:
  name: ack-eventbridge
  namespace: argocd
  annotations:
    helm.sh/chart: gitops-bridge-1.0.0
  labels:
    helm.sh/chart: gitops-bridge-1.0.0
    app.kubernetes.io/name: gitops-bridge
    app.kubernetes.io/instance: my-release
    app.kubernetes.io/managed-by: Helm
    addon: "true"
spec:
  syncPolicy:
    preserveResourcesOnDeletion: true
  goTemplate: true
  goTemplateOptions:
  - missingkey=error
  generators:
          - clusters: # for reason this is need it as second in the matrix, if not the above extracting .tenants doesn't work
              selector:
                matchLabels:
                  argocd.argoproj.io/secret-type: cluster
                matchExpressions:
                - key: enable_ack_eventbridge
                  operator: In
                  values:
                  - "true"


  template:
    metadata:
      name: addon-ack-eventbridge-{{.nameNormalized}}
      annotations:
        argocd.argoproj.io/manifest-generate-paths: default/addons/ack-eventbridge/values.yaml;environments/{{.metadata.labels.environment}}/addons/ack-eventbridge/values.yaml;clusters/{{.nameNormalized}}/addons/ack-eventbridge/values.yaml;
        helm.sh/chart: gitops-bridge-1.0.0
      labels:
        helm.sh/chart: gitops-bridge-1.0.0
        app.kubernetes.io/name: gitops-bridge
        app.kubernetes.io/instance: my-release
        app.kubernetes.io/managed-by: Helm
        addon: "true"
        component: 'ack-eventbridge'
        environment: '{{.metadata.labels.environment}}'
        cluster: '{{.name}}'
    spec:
      project: default
      sources:
      - repoURL: '{{.metadata.annotations.addons_repo_url}}'
        targetRevision: '{{.metadata.annotations.addons_repo_revision}}'
        ref: values
      - repoURL: 'public.ecr.aws'
        targetRevision: '1.0.18'
        chart: 'aws-controllers-k8s/eventbridge-chart'
        helm:
          releaseName: 'ack-eventbridge'
          ignoreMissingValueFiles: true
          valueFiles:
            - '$values/default/addons/ack-eventbridge/values.yaml'
            - '$values/default/addons/ack-eventbridge/1.0/values.yaml'
            - '$values/environments/{{.metadata.labels.environment}}/addons/ack-eventbridge/values.yaml'
            - '$values/environments/{{.metadata.labels.environment}}/addons/ack-eventbridge/1.0/values.yaml'
            - '$values/clusters/{{.nameNormalized}}/addons/ack-eventbridge/values.yaml'
            - '$values/clusters/{{.nameNormalized}}/addons/ack-eventbridge/1.0/values.yaml'
          valuesObject:
            aws:
              region: '{{.metadata.annotations.aws_region}}'
            nameOverride: aws-controllers-k8s
            serviceAccount:
              annotations:
                eks.amazonaws.com/role-arn: '{{.metadata.annotations.ack_eventbridge_iam_role_arn}}'
              name: '{{.metadata.annotations.ack_eventbridge_service_account}}'
      destination:
        namespace: '{{ default "aws-controllers-k8s" (index .metadata.annotations "ack_eventbridge_namespace")}}'
        name: '{{.name}}'
      syncPolicy:
        automated:
          allowEmpty: true
          prune: false
          selfHeal: false
        retry:
          backoff:
            duration: 5s
            factor: 2
            maxDuration: 10m
          limit: -1
        syncOptions:
        - CreateNamespace=true
        - ServerSideApply=true
---
# Source: gitops-bridge/templates/applicationsets.yaml
apiVersion: argoproj.io/v1alpha1
kind: ApplicationSet
metadata:
  name: ack-iam
  namespace: argocd
  annotations:
    helm.sh/chart: gitops-bridge-1.0.0
  labels:
    helm.sh/chart: gitops-bridge-1.0.0
    app.kubernetes.io/name: gitops-bridge
    app.kubernetes.io/instance: my-release
    app.kubernetes.io/managed-by: Helm
    addon: "true"
spec:
  syncPolicy:
    preserveResourcesOnDeletion: true
  goTemplate: true
  goTemplateOptions:
  - missingkey=error
  generators:
          - clusters: # for reason this is need it as second in the matrix, if not the above extracting .tenants doesn't work
              selector:
                matchLabels:
                  argocd.argoproj.io/secret-type: cluster
                matchExpressions:
                - key: enable_ack_iam
                  operator: In
                  values:
                  - "true"


  template:
    metadata:
      name: addon-ack-iam-{{.nameNormalized}}
      annotations:
        argocd.argoproj.io/manifest-generate-paths: default/addons/ack-iam/values.yaml;environments/{{.metadata.labels.environment}}/addons/ack-iam/values.yaml;clusters/{{.nameNormalized}}/addons/ack-iam/values.yaml;
        helm.sh/chart: gitops-bridge-1.0.0
      labels:
        helm.sh/chart: gitops-bridge-1.0.0
        app.kubernetes.io/name: gitops-bridge
        app.kubernetes.io/instance: my-release
        app.kubernetes.io/managed-by: Helm
        addon: "true"
        component: 'ack-iam'
        environment: '{{.metadata.labels.environment}}'
        cluster: '{{.name}}'
    spec:
      project: default
      sources:
      - repoURL: '{{.metadata.annotations.addons_repo_url}}'
        targetRevision: '{{.metadata.annotations.addons_repo_revision}}'
        ref: values
      - repoURL: 'public.ecr.aws'
        targetRevision: '1.3.16'
        chart: 'aws-controllers-k8s/iam-chart'
        helm:
          releaseName: 'ack-eks'
          ignoreMissingValueFiles: true
          valueFiles:
            - '$values/default/addons/ack-iam/values.yaml'
            - '$values/default/addons/ack-iam/1.3/values.yaml'
            - '$values/environments/{{.metadata.labels.environment}}/addons/ack-iam/values.yaml'
            - '$values/environments/{{.metadata.labels.environment}}/addons/ack-iam/1.3/values.yaml'
            - '$values/clusters/{{.nameNormalized}}/addons/ack-iam/values.yaml'
            - '$values/clusters/{{.nameNormalized}}/addons/ack-iam/1.3/values.yaml'
          valuesObject:
            aws:
              region: '{{.metadata.annotations.aws_region}}'
            nameOverride: aws-controllers-k8s
            serviceAccount:
              annotations:
                eks.amazonaws.com/role-arn: '{{ default "" (index .metadata.annotations "ack_iam_iam_role_arn")}}'
              name: '{{ default "ack-iam-controller" (index .metadata.annotations "ack_iam_service_account")}}'
      destination:
        namespace: '{{ default "aws-controllers-k8s" (index .metadata.annotations "ack_iam_namespace")}}'
        name: '{{.name}}'
      syncPolicy:
        automated:
          allowEmpty: true
          prune: false
          selfHeal: false
        retry:
          backoff:
            duration: 5s
            factor: 2
            maxDuration: 10m
          limit: -1
        syncOptions:
        - CreateNamespace=true
        - ServerSideApply=true
---
# Source: gitops-bridge/templates/applicationsets.yaml
apiVersion: argoproj.io/v1alpha1
kind: ApplicationSet
metadata:
  name: ack-prometheusservice
  namespace: argocd
  annotations:
    helm.sh/chart: gitops-bridge-1.0.0
  labels:
    helm.sh/chart: gitops-bridge-1.0.0
    app.kubernetes.io/name: gitops-bridge
    app.kubernetes.io/instance: my-release
    app.kubernetes.io/managed-by: Helm
    addon: "true"
spec:
  syncPolicy:
    preserveResourcesOnDeletion: true
  goTemplate: true
  goTemplateOptions:
  - missingkey=error
  generators:
          - clusters: # for reason this is need it as second in the matrix, if not the above extracting .tenants doesn't work
              selector:
                matchLabels:
                  argocd.argoproj.io/secret-type: cluster
                matchExpressions:
                - key: enable_ack_prometheusservice
                  operator: In
                  values:
                  - "true"


  template:
    metadata:
      name: addon-ack-prometheusservice-{{.nameNormalized}}
      annotations:
        argocd.argoproj.io/manifest-generate-paths: default/addons/ack-prometheusservice/values.yaml;environments/{{.metadata.labels.environment}}/addons/ack-prometheusservice/values.yaml;clusters/{{.nameNormalized}}/addons/ack-prometheusservice/values.yaml;
        helm.sh/chart: gitops-bridge-1.0.0
      labels:
        helm.sh/chart: gitops-bridge-1.0.0
        app.kubernetes.io/name: gitops-bridge
        app.kubernetes.io/instance: my-release
        app.kubernetes.io/managed-by: Helm
        addon: "true"
        component: 'ack-prometheusservice'
        environment: '{{.metadata.labels.environment}}'
        cluster: '{{.name}}'
    spec:
      project: default
      sources:
      - repoURL: '{{.metadata.annotations.addons_repo_url}}'
        targetRevision: '{{.metadata.annotations.addons_repo_revision}}'
        ref: values
      - repoURL: 'public.ecr.aws'
        targetRevision: '1.2.18'
        chart: 'aws-controllers-k8s/prometheusservice-chart'
        helm:
          releaseName: 'ack-prometheusservice'
          ignoreMissingValueFiles: true
          valueFiles:
            - '$values/default/addons/ack-prometheusservice/values.yaml'
            - '$values/default/addons/ack-prometheusservice/1.2/values.yaml'
            - '$values/environments/{{.metadata.labels.environment}}/addons/ack-prometheusservice/values.yaml'
            - '$values/environments/{{.metadata.labels.environment}}/addons/ack-prometheusservice/1.2/values.yaml'
            - '$values/clusters/{{.nameNormalized}}/addons/ack-prometheusservice/values.yaml'
            - '$values/clusters/{{.nameNormalized}}/addons/ack-prometheusservice/1.2/values.yaml'
          valuesObject:
            aws:
              region: '{{.metadata.annotations.aws_region}}'
            nameOverride: aws-controllers-k8s
            serviceAccount:
              annotations:
                eks.amazonaws.com/role-arn: '{{.metadata.annotations.ack_prometheusservice_iam_role_arn}}'
              name: '{{.metadata.annotations.ack_prometheusservice_service_account}}'
      destination:
        namespace: '{{ default "aws-controllers-k8s" (index .metadata.annotations "ack_prometheusservice_namespace")}}'
        name: '{{.name}}'
      syncPolicy:
        automated:
          allowEmpty: true
          prune: false
          selfHeal: false
        retry:
          backoff:
            duration: 5s
            factor: 2
            maxDuration: 10m
          limit: -1
        syncOptions:
        - CreateNamespace=true
        - ServerSideApply=true
---
# Source: gitops-bridge/templates/applicationsets.yaml
apiVersion: argoproj.io/v1alpha1
kind: ApplicationSet
metadata:
  name: ack-rds
  namespace: argocd
  annotations:
    helm.sh/chart: gitops-bridge-1.0.0
  labels:
    helm.sh/chart: gitops-bridge-1.0.0
    app.kubernetes.io/name: gitops-bridge
    app.kubernetes.io/instance: my-release
    app.kubernetes.io/managed-by: Helm
    addon: "true"
spec:
  syncPolicy:
    preserveResourcesOnDeletion: true
  goTemplate: true
  goTemplateOptions:
  - missingkey=error
  generators:
          - clusters: # for reason this is need it as second in the matrix, if not the above extracting .tenants doesn't work
              selector:
                matchLabels:
                  argocd.argoproj.io/secret-type: cluster
                matchExpressions:
                - key: enable_ack_rds
                  operator: In
                  values:
                  - "true"


  template:
    metadata:
      name: addon-ack-rds-{{.nameNormalized}}
      annotations:
        argocd.argoproj.io/manifest-generate-paths: default/addons/ack-rds/values.yaml;environments/{{.metadata.labels.environment}}/addons/ack-rds/values.yaml;clusters/{{.nameNormalized}}/addons/ack-rds/values.yaml;
        helm.sh/chart: gitops-bridge-1.0.0
      labels:
        helm.sh/chart: gitops-bridge-1.0.0
        app.kubernetes.io/name: gitops-bridge
        app.kubernetes.io/instance: my-release
        app.kubernetes.io/managed-by: Helm
        addon: "true"
        component: 'ack-rds'
        environment: '{{.metadata.labels.environment}}'
        cluster: '{{.name}}'
    spec:
      project: default
      sources:
      - repoURL: '{{.metadata.annotations.addons_repo_url}}'
        targetRevision: '{{.metadata.annotations.addons_repo_revision}}'
        ref: values
      - repoURL: 'public.ecr.aws'
        targetRevision: '1.4.9'
        chart: 'aws-controllers-k8s/rds-chart'
        helm:
          releaseName: 'ack-rds'
          ignoreMissingValueFiles: true
          valueFiles:
            - '$values/default/addons/ack-rds/values.yaml'
            - '$values/default/addons/ack-rds/1.4/values.yaml'
            - '$values/environments/{{.metadata.labels.environment}}/addons/ack-rds/values.yaml'
            - '$values/environments/{{.metadata.labels.environment}}/addons/ack-rds/1.4/values.yaml'
            - '$values/clusters/{{.nameNormalized}}/addons/ack-rds/values.yaml'
            - '$values/clusters/{{.nameNormalized}}/addons/ack-rds/1.4/values.yaml'
          valuesObject:
            aws:
              region: '{{.metadata.annotations.aws_region}}'
            nameOverride: aws-controllers-k8s
            serviceAccount:
              annotations:
                eks.amazonaws.com/role-arn: '{{.metadata.annotations.ack_rds_iam_role_arn}}'
              name: '{{.metadata.annotations.ack_rds_service_account}}'
      destination:
        namespace: '{{ default "aws-controllers-k8s" (index .metadata.annotations "ack_rds_namespace")}}'
        name: '{{.name}}'
      syncPolicy:
        automated:
          allowEmpty: true
          prune: false
          selfHeal: false
        retry:
          backoff:
            duration: 5s
            factor: 2
            maxDuration: 10m
          limit: -1
        syncOptions:
        - CreateNamespace=true
        - ServerSideApply=true
---
# Source: gitops-bridge/templates/applicationsets.yaml
apiVersion: argoproj.io/v1alpha1
kind: ApplicationSet
metadata:
  name: ack-s3
  namespace: argocd
  annotations:
    helm.sh/chart: gitops-bridge-1.0.0
  labels:
    helm.sh/chart: gitops-bridge-1.0.0
    app.kubernetes.io/name: gitops-bridge
    app.kubernetes.io/instance: my-release
    app.kubernetes.io/managed-by: Helm
    addon: "true"
spec:
  syncPolicy:
    preserveResourcesOnDeletion: true
  goTemplate: true
  goTemplateOptions:
  - missingkey=error
  generators:
          - clusters: # for reason this is need it as second in the matrix, if not the above extracting .tenants doesn't work
              selector:
                matchLabels:
                  argocd.argoproj.io/secret-type: cluster
                matchExpressions:
                - key: enable_ack_s3
                  operator: In
                  values:
                  - "true"


  template:
    metadata:
      name: addon-ack-s3-{{.nameNormalized}}
      annotations:
        argocd.argoproj.io/manifest-generate-paths: default/addons/ack-s3/values.yaml;environments/{{.metadata.labels.environment}}/addons/ack-s3/values.yaml;clusters/{{.nameNormalized}}/addons/ack-s3/values.yaml;
        helm.sh/chart: gitops-bridge-1.0.0
      labels:
        helm.sh/chart: gitops-bridge-1.0.0
        app.kubernetes.io/name: gitops-bridge
        app.kubernetes.io/instance: my-release
        app.kubernetes.io/managed-by: Helm
        addon: "true"
        component: 'ack-s3'
        environment: '{{.metadata.labels.environment}}'
        cluster: '{{.name}}'
    spec:
      project: default
      sources:
      - repoURL: '{{.metadata.annotations.addons_repo_url}}'
        targetRevision: '{{.metadata.annotations.addons_repo_revision}}'
        ref: values
      - repoURL: 'public.ecr.aws'
        targetRevision: '1.0.22'
        chart: 'aws-controllers-k8s/s3-chart'
        helm:
          releaseName: 'ack-s3'
          ignoreMissingValueFiles: true
          valueFiles:
            - '$values/default/addons/ack-s3/values.yaml'
            - '$values/default/addons/ack-s3/1.0/values.yaml'
            - '$values/environments/{{.metadata.labels.environment}}/addons/ack-s3/values.yaml'
            - '$values/environments/{{.metadata.labels.environment}}/addons/ack-s3/1.0/values.yaml'
            - '$values/clusters/{{.nameNormalized}}/addons/ack-s3/values.yaml'
            - '$values/clusters/{{.nameNormalized}}/addons/ack-s3/1.0/values.yaml'
          valuesObject:
            aws:
              region: '{{.metadata.annotations.aws_region}}'
            nameOverride: aws-controllers-k8s
            serviceAccount:
              annotations:
                eks.amazonaws.com/role-arn: '{{default "" (index .metadata.annotations "ack_s3_iam_role_arn")}}'
              name: '{{default "ack-s3-controller" (index .metadata.annotations "ack_s3_service_account")}}'
      destination:
        namespace: '{{ default "aws-controllers-k8s" (index .metadata.annotations "ack_s3_namespace")}}'
        name: '{{.name}}'
      syncPolicy:
        automated:
          allowEmpty: true
          prune: false
          selfHeal: false
        retry:
          backoff:
            duration: 5s
            factor: 2
            maxDuration: 10m
          limit: -1
        syncOptions:
        - CreateNamespace=true
        - ServerSideApply=true
---
# Source: gitops-bridge/templates/applicationsets.yaml
apiVersion: argoproj.io/v1alpha1
kind: ApplicationSet
metadata:
  name: ack-secretsmanager
  namespace: argocd
  annotations:
    helm.sh/chart: gitops-bridge-1.0.0
  labels:
    helm.sh/chart: gitops-bridge-1.0.0
    app.kubernetes.io/name: gitops-bridge
    app.kubernetes.io/instance: my-release
    app.kubernetes.io/managed-by: Helm
    addon: "true"
spec:
  syncPolicy:
    preserveResourcesOnDeletion: true
  goTemplate: true
  goTemplateOptions:
  - missingkey=error
  generators:
          - clusters: # for reason this is need it as second in the matrix, if not the above extracting .tenants doesn't work
              selector:
                matchLabels:
                  argocd.argoproj.io/secret-type: cluster
                matchExpressions:
                - key: enable_ack_secretsmanager
                  operator: In
                  values:
                  - "true"


  template:
    metadata:
      name: addon-ack-secretsmanager-{{.nameNormalized}}
      annotations:
        argocd.argoproj.io/manifest-generate-paths: default/addons/ack-secretsmanager/values.yaml;environments/{{.metadata.labels.environment}}/addons/ack-secretsmanager/values.yaml;clusters/{{.nameNormalized}}/addons/ack-secretsmanager/values.yaml;
        helm.sh/chart: gitops-bridge-1.0.0
      labels:
        helm.sh/chart: gitops-bridge-1.0.0
        app.kubernetes.io/name: gitops-bridge
        app.kubernetes.io/instance: my-release
        app.kubernetes.io/managed-by: Helm
        addon: "true"
        component: 'ack-secretsmanager'
        environment: '{{.metadata.labels.environment}}'
        cluster: '{{.name}}'
    spec:
      project: default
      sources:
      - repoURL: '{{.metadata.annotations.addons_repo_url}}'
        targetRevision: '{{.metadata.annotations.addons_repo_revision}}'
        ref: values
      - repoURL: 'public.ecr.aws'
        targetRevision: '1.0.2'
        chart: 'aws-controllers-k8s/secretsmanager-chart'
        helm:
          releaseName: 'ack-secretsmanager'
          ignoreMissingValueFiles: true
          valueFiles:
            - '$values/default/addons/ack-secretsmanager/values.yaml'
            - '$values/default/addons/ack-secretsmanager/1.0/values.yaml'
            - '$values/environments/{{.metadata.labels.environment}}/addons/ack-secretsmanager/values.yaml'
            - '$values/environments/{{.metadata.labels.environment}}/addons/ack-secretsmanager/1.0/values.yaml'
            - '$values/clusters/{{.nameNormalized}}/addons/ack-secretsmanager/values.yaml'
            - '$values/clusters/{{.nameNormalized}}/addons/ack-secretsmanager/1.0/values.yaml'
          valuesObject:
            aws:
              region: '{{.metadata.annotations.aws_region}}'
            nameOverride: aws-controllers-k8s
            serviceAccount:
              annotations:
                eks.amazonaws.com/role-arn: '{{ default "" (index .metadata.annotations "ack_secretsmanager_iam_role_arn")}}'
              name: '{{ default "ack-secretsmanager-controller" (index .metadata.annotations "ack_secretsmanager_service_account")}}'
      destination:
        namespace: '{{ default "aws-controllers-k8s" (index .metadata.annotations "ack_secretsmanager_namespace")}}'
        name: '{{.name}}'
      syncPolicy:
        automated:
          allowEmpty: true
          prune: false
          selfHeal: false
        retry:
          backoff:
            duration: 5s
            factor: 2
            maxDuration: 10m
          limit: -1
        syncOptions:
        - CreateNamespace=true
        - ServerSideApply=true
---
# Source: gitops-bridge/templates/applicationsets.yaml
apiVersion: argoproj.io/v1alpha1
kind: ApplicationSet
metadata:
  name: ack-sfn
  namespace: argocd
  annotations:
    helm.sh/chart: gitops-bridge-1.0.0
  labels:
    helm.sh/chart: gitops-bridge-1.0.0
    app.kubernetes.io/name: gitops-bridge
    app.kubernetes.io/instance: my-release
    app.kubernetes.io/managed-by: Helm
    addon: "true"
spec:
  syncPolicy:
    preserveResourcesOnDeletion: true
  goTemplate: true
  goTemplateOptions:
  - missingkey=error
  generators:
          - clusters: # for reason this is need it as second in the matrix, if not the above extracting .tenants doesn't work
              selector:
                matchLabels:
                  argocd.argoproj.io/secret-type: cluster
                matchExpressions:
                - key: enable_ack_sfn
                  operator: In
                  values:
                  - "true"


  template:
    metadata:
      name: addon-ack-sfn-{{.nameNormalized}}
      annotations:
        argocd.argoproj.io/manifest-generate-paths: default/addons/ack-sfn/values.yaml;environments/{{.metadata.labels.environment}}/addons/ack-sfn/values.yaml;clusters/{{.nameNormalized}}/addons/ack-sfn/values.yaml;
        helm.sh/chart: gitops-bridge-1.0.0
      labels:
        helm.sh/chart: gitops-bridge-1.0.0
        app.kubernetes.io/name: gitops-bridge
        app.kubernetes.io/instance: my-release
        app.kubernetes.io/managed-by: Helm
        addon: "true"
        component: 'ack-sfn'
        environment: '{{.metadata.labels.environment}}'
        cluster: '{{.name}}'
    spec:
      project: default
      sources:
      - repoURL: '{{.metadata.annotations.addons_repo_url}}'
        targetRevision: '{{.metadata.annotations.addons_repo_revision}}'
        ref: values
      - repoURL: 'public.ecr.aws'
        targetRevision: '1.0.18'
        chart: 'aws-controllers-k8s/sfn-chart'
        helm:
          releaseName: 'ack-sfn'
          ignoreMissingValueFiles: true
          valueFiles:
            - '$values/default/addons/ack-sfn/values.yaml'
            - '$values/default/addons/ack-sfn/1.0/values.yaml'
            - '$values/environments/{{.metadata.labels.environment}}/addons/ack-sfn/values.yaml'
            - '$values/environments/{{.metadata.labels.environment}}/addons/ack-sfn/1.0/values.yaml'
            - '$values/clusters/{{.nameNormalized}}/addons/ack-sfn/values.yaml'
            - '$values/clusters/{{.nameNormalized}}/addons/ack-sfn/1.0/values.yaml'
          valuesObject:
            aws:
              region: '{{.metadata.annotations.aws_region}}'
            nameOverride: aws-controllers-k8s
            serviceAccount:
              annotations:
                eks.amazonaws.com/role-arn: '{{.metadata.annotations.ack_sfn_iam_role_arn}}'
              name: '{{.metadata.annotations.ack_sfn_service_account}}'
      destination:
        namespace: '{{ default "aws-controllers-k8s" (index .metadata.annotations "ack_sfn_namespace")}}'
        name: '{{.name}}'
      syncPolicy:
        automated:
          allowEmpty: true
          prune: false
          selfHeal: false
        retry:
          backoff:
            duration: 5s
            factor: 2
            maxDuration: 10m
          limit: -1
        syncOptions:
        - CreateNamespace=true
        - ServerSideApply=true
---
# Source: gitops-bridge/templates/applicationsets.yaml
apiVersion: argoproj.io/v1alpha1
kind: ApplicationSet
metadata:
  name: adot-collector
  namespace: argocd
  annotations:
    helm.sh/chart: gitops-bridge-1.0.0
  labels:
    helm.sh/chart: gitops-bridge-1.0.0
    app.kubernetes.io/name: gitops-bridge
    app.kubernetes.io/instance: my-release
    app.kubernetes.io/managed-by: Helm
    addon: "true"
spec:
  syncPolicy:
    preserveResourcesOnDeletion: true
  goTemplate: true
  goTemplateOptions:
  - missingkey=error
  generators:
          - clusters: # for reason this is need it as second in the matrix, if not the above extracting .tenants doesn't work
              selector:
                matchLabels:
                  argocd.argoproj.io/secret-type: cluster
                matchExpressions:
                - key: enable_adot_collector
                  operator: In
                  values:
                  - "true"


  template:
    metadata:
      name: addon-adot-collector-{{.nameNormalized}}
      annotations:
        argocd.argoproj.io/manifest-generate-paths: default/addons/adot-collector/values.yaml;environments/{{.metadata.labels.environment}}/addons/adot-collector/values.yaml;clusters/{{.nameNormalized}}/addons/adot-collector/values.yaml;
        helm.sh/chart: gitops-bridge-1.0.0
      labels:
        helm.sh/chart: gitops-bridge-1.0.0
        app.kubernetes.io/name: gitops-bridge
        app.kubernetes.io/instance: my-release
        app.kubernetes.io/managed-by: Helm
        addon: "true"
        component: 'adot-collector'
        environment: '{{.metadata.labels.environment}}'
        cluster: '{{.name}}'
    spec:
      project: default
      sources:
      - repoURL: '{{.metadata.annotations.addons_repo_url}}'
        targetRevision: '{{.metadata.annotations.addons_repo_revision}}'
        ref: values
      - repoURL: '{{.metadata.annotations.addons_repo_url}}'
        targetRevision: '{{.metadata.annotations.addons_repo_revision}}'
        path: '{{.metadata.annotations.addons_repo_basepath}}charts/adot-collector'
        helm:
          releaseName: ''
          ignoreMissingValueFiles: true
          valueFiles:
            - '$values/default/addons/adot-collector/values.yaml'
            - '$values/default/addons/adot-collector/{{.metadata.annotations.addons_repo_revision}}/values.yaml'
            - '$values/environments/{{.metadata.labels.environment}}/addons/adot-collector/values.yaml'
            - '$values/environments/{{.metadata.labels.environment}}/addons/adot-collector/{{.metadata.annotations.addons_repo_revision}}/values.yaml'
            - '$values/clusters/{{.nameNormalized}}/addons/adot-collector/values.yaml'
            - '$values/clusters/{{.nameNormalized}}/addons/adot-collector/{{.metadata.annotations.addons_repo_revision}}/values.yaml'
          valuesObject:
            accountId: '{{.metadata.annotations.aws_account_id}}'
            ampurl: '{{.metadata.annotations.amp_endpoint_url}}api/v1/remote_write'
            ekscluster: '{{.metadata.annotations.aws_cluster_name}}'
            region: '{{.metadata.annotations.aws_region}}'
            serviceAccount: '{{.metadata.annotations.adot_collector_service_account}}'
      destination:
        namespace: '{{ default "adot-collector-kubeprometheus" (index .metadata.annotations "adot_collector_namespace")}}'
        name: '{{.name}}'
      syncPolicy:
        automated:
          allowEmpty: true
          prune: false
          selfHeal: false
        retry:
          backoff:
            duration: 5s
            factor: 2
            maxDuration: 10m
          limit: -1
        syncOptions:
        - CreateNamespace=true
        - ServerSideApply=true
---
# Source: gitops-bridge/templates/applicationsets.yaml
apiVersion: argoproj.io/v1alpha1
kind: ApplicationSet
metadata:
  name: argo-events
  namespace: argocd
  annotations:
    helm.sh/chart: gitops-bridge-1.0.0
  labels:
    helm.sh/chart: gitops-bridge-1.0.0
    app.kubernetes.io/name: gitops-bridge
    app.kubernetes.io/instance: my-release
    app.kubernetes.io/managed-by: Helm
    addon: "true"
spec:
  syncPolicy:
    preserveResourcesOnDeletion: true
  goTemplate: true
  goTemplateOptions:
  - missingkey=error
  generators:
          - clusters: # for reason this is need it as second in the matrix, if not the above extracting .tenants doesn't work
              selector:
                matchLabels:
                  argocd.argoproj.io/secret-type: cluster
                matchExpressions:
                - key: enable_argo_events
                  operator: In
                  values:
                  - "true"


  template:
    metadata:
      name: addon-argo-events-{{.nameNormalized}}
      annotations:
        argocd.argoproj.io/manifest-generate-paths: default/addons/argo-events/values.yaml;environments/{{.metadata.labels.environment}}/addons/argo-events/values.yaml;clusters/{{.nameNormalized}}/addons/argo-events/values.yaml;
        helm.sh/chart: gitops-bridge-1.0.0
      labels:
        helm.sh/chart: gitops-bridge-1.0.0
        app.kubernetes.io/name: gitops-bridge
        app.kubernetes.io/instance: my-release
        app.kubernetes.io/managed-by: Helm
        addon: "true"
        component: 'argo-events'
        environment: '{{.metadata.labels.environment}}'
        cluster: '{{.name}}'
    spec:
      project: default
      sources:
      - repoURL: '{{.metadata.annotations.addons_repo_url}}'
        targetRevision: '{{.metadata.annotations.addons_repo_revision}}'
        ref: values
      - repoURL: 'https://argoproj.github.io/argo-helm'
        targetRevision: '2.4.7'
        chart: 'argo-events'
        helm:
          releaseName: 'argo-events'
          ignoreMissingValueFiles: true
          valueFiles:
            - '$values/default/addons/argo-events/values.yaml'
            - '$values/default/addons/argo-events/2.4/values.yaml'
            - '$values/environments/{{.metadata.labels.environment}}/addons/argo-events/values.yaml'
            - '$values/environments/{{.metadata.labels.environment}}/addons/argo-events/2.4/values.yaml'
            - '$values/clusters/{{.nameNormalized}}/addons/argo-events/values.yaml'
            - '$values/clusters/{{.nameNormalized}}/addons/argo-events/2.4/values.yaml'
      destination:
        namespace: '{{ default "argo-events" (index .metadata.annotations "argo_events_namespace")}}'
        name: '{{.name}}'
      syncPolicy:
        automated:
          allowEmpty: true
          prune: false
          selfHeal: false
        retry:
          backoff:
            duration: 5s
            factor: 2
            maxDuration: 10m
          limit: -1
        syncOptions:
        - CreateNamespace=true
        - ServerSideApply=true
---
# Source: gitops-bridge/templates/applicationsets.yaml
apiVersion: argoproj.io/v1alpha1
kind: ApplicationSet
metadata:
  name: argo-rollouts
  namespace: argocd
  annotations:
    helm.sh/chart: gitops-bridge-1.0.0
  labels:
    helm.sh/chart: gitops-bridge-1.0.0
    app.kubernetes.io/name: gitops-bridge
    app.kubernetes.io/instance: my-release
    app.kubernetes.io/managed-by: Helm
    addon: "true"
spec:
  syncPolicy:
    preserveResourcesOnDeletion: true
  goTemplate: true
  goTemplateOptions:
  - missingkey=error
  generators:
          - clusters: # for reason this is need it as second in the matrix, if not the above extracting .tenants doesn't work
              selector:
                matchLabels:
                  argocd.argoproj.io/secret-type: cluster
                matchExpressions:
                - key: enable_argo_rollouts
                  operator: In
                  values:
                  - "true"


  template:
    metadata:
      name: addon-argo-rollouts-{{.nameNormalized}}
      annotations:
        argocd.argoproj.io/manifest-generate-paths: default/addons/argo-rollouts/values.yaml;environments/{{.metadata.labels.environment}}/addons/argo-rollouts/values.yaml;clusters/{{.nameNormalized}}/addons/argo-rollouts/values.yaml;
        helm.sh/chart: gitops-bridge-1.0.0
      labels:
        helm.sh/chart: gitops-bridge-1.0.0
        app.kubernetes.io/name: gitops-bridge
        app.kubernetes.io/instance: my-release
        app.kubernetes.io/managed-by: Helm
        addon: "true"
        component: 'argo-rollouts'
        environment: '{{.metadata.labels.environment}}'
        cluster: '{{.name}}'
    spec:
      project: default
      sources:
      - repoURL: '{{.metadata.annotations.addons_repo_url}}'
        targetRevision: '{{.metadata.annotations.addons_repo_revision}}'
        ref: values
      - repoURL: 'https://argoproj.github.io/argo-helm'
        targetRevision: '2.37.3'
        chart: 'argo-rollouts'
        helm:
          releaseName: 'argo-rollouts'
          ignoreMissingValueFiles: true
          valueFiles:
            - '$values/default/addons/argo-rollouts/values.yaml'
            - '$values/default/addons/argo-rollouts/2.37/values.yaml'
            - '$values/environments/{{.metadata.labels.environment}}/addons/argo-rollouts/values.yaml'
            - '$values/environments/{{.metadata.labels.environment}}/addons/argo-rollouts/2.37/values.yaml'
            - '$values/clusters/{{.nameNormalized}}/addons/argo-rollouts/values.yaml'
            - '$values/clusters/{{.nameNormalized}}/addons/argo-rollouts/2.37/values.yaml'
      destination:
        namespace: '{{ default "argo-rollouts" (index .metadata.annotations "argo_rollouts_namespace")}}'
        name: '{{.name}}'
      syncPolicy:
        automated:
          allowEmpty: true
          prune: false
          selfHeal: false
        retry:
          backoff:
            duration: 5s
            factor: 2
            maxDuration: 10m
          limit: -1
        syncOptions:
        - CreateNamespace=true
        - ServerSideApply=true
---
# Source: gitops-bridge/templates/applicationsets.yaml
apiVersion: argoproj.io/v1alpha1
kind: ApplicationSet
metadata:
  name: argo-workflows
  namespace: argocd
  annotations:
    helm.sh/chart: gitops-bridge-1.0.0
  labels:
    helm.sh/chart: gitops-bridge-1.0.0
    app.kubernetes.io/name: gitops-bridge
    app.kubernetes.io/instance: my-release
    app.kubernetes.io/managed-by: Helm
    addon: "true"
spec:
  syncPolicy:
    preserveResourcesOnDeletion: true
  goTemplate: true
  goTemplateOptions:
  - missingkey=error
  generators:
          - clusters: # for reason this is need it as second in the matrix, if not the above extracting .tenants doesn't work
              selector:
                matchLabels:
                  argocd.argoproj.io/secret-type: cluster
                matchExpressions:
                - key: enable_argo_workflows
                  operator: In
                  values:
                  - "true"


  template:
    metadata:
      name: addon-argo-workflows-{{.nameNormalized}}
      annotations:
        argocd.argoproj.io/manifest-generate-paths: default/addons/argo-workflows/values.yaml;environments/{{.metadata.labels.environment}}/addons/argo-workflows/values.yaml;clusters/{{.nameNormalized}}/addons/argo-workflows/values.yaml;
        helm.sh/chart: gitops-bridge-1.0.0
      labels:
        helm.sh/chart: gitops-bridge-1.0.0
        app.kubernetes.io/name: gitops-bridge
        app.kubernetes.io/instance: my-release
        app.kubernetes.io/managed-by: Helm
        addon: "true"
        component: 'argo-workflows'
        environment: '{{.metadata.labels.environment}}'
        cluster: '{{.name}}'
    spec:
      project: default
      sources:
      - repoURL: '{{.metadata.annotations.addons_repo_url}}'
        targetRevision: '{{.metadata.annotations.addons_repo_revision}}'
        ref: values
      - repoURL: 'https://argoproj.github.io/argo-helm'
        targetRevision: '0.41.14'
        chart: 'argo-workflows'
        helm:
          releaseName: 'argo-workflows'
          ignoreMissingValueFiles: true
          valueFiles:
            - '$values/default/addons/argo-workflows/values.yaml'
            - '$values/default/addons/argo-workflows/0.41/values.yaml'
            - '$values/environments/{{.metadata.labels.environment}}/addons/argo-workflows/values.yaml'
            - '$values/environments/{{.metadata.labels.environment}}/addons/argo-workflows/0.41/values.yaml'
            - '$values/clusters/{{.nameNormalized}}/addons/argo-workflows/values.yaml'
            - '$values/clusters/{{.nameNormalized}}/addons/argo-workflows/0.41/values.yaml'
      destination:
        namespace: '{{ default "argo-workflows" (index .metadata.annotations "argo_workflows_namespace")}}'
        name: '{{.name}}'
      syncPolicy:
        automated:
          allowEmpty: true
          prune: false
          selfHeal: false
        retry:
          backoff:
            duration: 5s
            factor: 2
            maxDuration: 10m
          limit: -1
        syncOptions:
        - CreateNamespace=true
        - ServerSideApply=true
---
# Source: gitops-bridge/templates/applicationsets.yaml
apiVersion: argoproj.io/v1alpha1
kind: ApplicationSet
metadata:
  name: argocd
  namespace: argocd
  annotations:
    helm.sh/chart: gitops-bridge-1.0.0
  labels:
    helm.sh/chart: gitops-bridge-1.0.0
    app.kubernetes.io/name: gitops-bridge
    app.kubernetes.io/instance: my-release
    app.kubernetes.io/managed-by: Helm
    addon: "true"
spec:
  syncPolicy:
    preserveResourcesOnDeletion: true
  goTemplate: true
  goTemplateOptions:
  - missingkey=error
  generators:
          - clusters: # for reason this is need it as second in the matrix, if not the above extracting .tenants doesn't work
              selector:
                matchLabels:
                  argocd.argoproj.io/secret-type: cluster
                matchExpressions:
                - key: enable_argocd
                  operator: In
                  values:
                  - "true"


  template:
    metadata:
      name: addon-argocd-{{.nameNormalized}}
      annotations:
        argocd.argoproj.io/manifest-generate-paths: default/addons/argocd/values.yaml;environments/{{.metadata.labels.environment}}/addons/argocd/values.yaml;clusters/{{.nameNormalized}}/addons/argocd/values.yaml;
        helm.sh/chart: gitops-bridge-1.0.0
      labels:
        helm.sh/chart: gitops-bridge-1.0.0
        app.kubernetes.io/name: gitops-bridge
        app.kubernetes.io/instance: my-release
        app.kubernetes.io/managed-by: Helm
        addon: "true"
        component: 'argocd'
        environment: '{{.metadata.labels.environment}}'
        cluster: '{{.name}}'
    spec:
      project: default
      sources:
      - repoURL: '{{.metadata.annotations.addons_repo_url}}'
        targetRevision: '{{.metadata.annotations.addons_repo_revision}}'
        ref: values
      - repoURL: 'https://argoproj.github.io/argo-helm'
        targetRevision: '7.5.2'
        chart: 'argo-cd'
        helm:
          releaseName: 'argocd'
          ignoreMissingValueFiles: true
          valueFiles:
            - '$values/default/addons/argocd/values.yaml'
            - '$values/default/addons/argocd/7.5/values.yaml'
            - '$values/environments/{{.metadata.labels.environment}}/addons/argocd/values.yaml'
            - '$values/environments/{{.metadata.labels.environment}}/addons/argocd/7.5/values.yaml'
            - '$values/clusters/{{.nameNormalized}}/addons/argocd/values.yaml'
            - '$values/clusters/{{.nameNormalized}}/addons/argocd/7.5/values.yaml'
      destination:
        namespace: 'argocd'
        name: '{{.name}}'
      syncPolicy:
        automated:
          allowEmpty: true
          prune: false
          selfHeal: false
        retry:
          backoff:
            duration: 5s
            factor: 2
            maxDuration: 10m
          limit: -1
        syncOptions:
        - CreateNamespace=true
        - ServerSideApply=true
---
# Source: gitops-bridge/templates/applicationsets.yaml
apiVersion: argoproj.io/v1alpha1
kind: ApplicationSet
metadata:
  name: aws-argo-workflows-ingress
  namespace: argocd
  annotations:
    helm.sh/chart: gitops-bridge-1.0.0
  labels:
    helm.sh/chart: gitops-bridge-1.0.0
    app.kubernetes.io/name: gitops-bridge
    app.kubernetes.io/instance: my-release
    app.kubernetes.io/managed-by: Helm
    addon: "true"
spec:
  syncPolicy:
    preserveResourcesOnDeletion: true
  goTemplate: true
  goTemplateOptions:
  - missingkey=error
  generators:
          - clusters: # for reason this is need it as second in the matrix, if not the above extracting .tenants doesn't work
              selector:
                matchLabels:
                  argocd.argoproj.io/secret-type: cluster
                matchExpressions:
                - key: enable_aws_argo_workflows_ingress
                  operator: In
                  values:
                  - "true"


  template:
    metadata:
      name: addon-aws-argo-workflows-ingress-{{.nameNormalized}}
      annotations:
        argocd.argoproj.io/manifest-generate-paths: default/addons/aws-argo-workflows-ingress/values.yaml;environments/{{.metadata.labels.environment}}/addons/aws-argo-workflows-ingress/values.yaml;clusters/{{.nameNormalized}}/addons/aws-argo-workflows-ingress/values.yaml;
        helm.sh/chart: gitops-bridge-1.0.0
      labels:
        helm.sh/chart: gitops-bridge-1.0.0
        app.kubernetes.io/name: gitops-bridge
        app.kubernetes.io/instance: my-release
        app.kubernetes.io/managed-by: Helm
        addon: "true"
        component: 'aws-argo-workflows-ingress'
        environment: '{{.metadata.labels.environment}}'
        cluster: '{{.name}}'
    spec:
      project: default
      sources:
      - repoURL: '{{.metadata.annotations.addons_repo_url}}'
        targetRevision: '{{.metadata.annotations.addons_repo_revision}}'
        ref: values
      - repoURL: 'https://argoproj.github.io/argo-helm'
        targetRevision: '0.41.14'
        chart: 'argo-workflows'
        helm:
          releaseName: 'aws-argo-workflows-ingress'
          ignoreMissingValueFiles: true
          valueFiles:
            - '$values/default/addons/aws-argo-workflows-ingress/values.yaml'
            - '$values/default/addons/aws-argo-workflows-ingress/0.41/values.yaml'
            - '$values/environments/{{.metadata.labels.environment}}/addons/aws-argo-workflows-ingress/values.yaml'
            - '$values/environments/{{.metadata.labels.environment}}/addons/aws-argo-workflows-ingress/0.41/values.yaml'
            - '$values/clusters/{{.nameNormalized}}/addons/aws-argo-workflows-ingress/values.yaml'
            - '$values/clusters/{{.nameNormalized}}/addons/aws-argo-workflows-ingress/0.41/values.yaml'
          valuesObject:
            server:
              ingress:
                annotations:
                  alb.ingress.kubernetes.io/backend-protocol: HTTP
                  alb.ingress.kubernetes.io/listen-ports: '[{"HTTPS":443}]'
                  alb.ingress.kubernetes.io/scheme: internet-facing
                  alb.ingress.kubernetes.io/tags: Environment=hub,GitOps=true
                  alb.ingress.kubernetes.io/target-type: ip
                enabled: true
                hosts: '{{.metadata.annotations.argo_workflows_hosts}}'
                ingressClassName: alb
                pathType: Prefix
                paths:
                - /
                tls:
                - hosts: '{{.metadata.annotations.argo_workflows_hosts}}'
              servicePort: "2746"
              servicePortName: http
              serviceType: ClusterIP
      destination:
        namespace: '{{ default "argo-worflows" (index .metadata.annotations "argo_workflows_namespace") }}'
        name: '{{.name}}'
      syncPolicy:
        automated:
          allowEmpty: true
          prune: false
          selfHeal: false
        retry:
          backoff:
            duration: 5s
            factor: 2
            maxDuration: 10m
          limit: -1
        syncOptions:
        - CreateNamespace=true
        - ServerSideApply=true
---
# Source: gitops-bridge/templates/applicationsets.yaml
apiVersion: argoproj.io/v1alpha1
kind: ApplicationSet
metadata:
  name: aws-argocd
  namespace: argocd
  annotations:
    helm.sh/chart: gitops-bridge-1.0.0
  labels:
    helm.sh/chart: gitops-bridge-1.0.0
    app.kubernetes.io/name: gitops-bridge
    app.kubernetes.io/instance: my-release
    app.kubernetes.io/managed-by: Helm
    addon: "true"
spec:
  syncPolicy:
    preserveResourcesOnDeletion: true
  goTemplate: true
  goTemplateOptions:
  - missingkey=error
  generators:
          - clusters: # for reason this is need it as second in the matrix, if not the above extracting .tenants doesn't work
              selector:
                matchLabels:
                  argocd.argoproj.io/secret-type: cluster
                matchExpressions:
                - key: enable_aws_argocd
                  operator: In
                  values:
                  - "true"


  template:
    metadata:
      name: addon-aws-argocd-{{.nameNormalized}}
      annotations:
        argocd.argoproj.io/manifest-generate-paths: default/addons/aws-argocd/values.yaml;environments/{{.metadata.labels.environment}}/addons/aws-argocd/values.yaml;clusters/{{.nameNormalized}}/addons/aws-argocd/values.yaml;
        helm.sh/chart: gitops-bridge-1.0.0
      labels:
        helm.sh/chart: gitops-bridge-1.0.0
        app.kubernetes.io/name: gitops-bridge
        app.kubernetes.io/instance: my-release
        app.kubernetes.io/managed-by: Helm
        addon: "true"
        component: 'aws-argocd'
        environment: '{{.metadata.labels.environment}}'
        cluster: '{{.name}}'
    spec:
      project: default
      sources:
      - repoURL: '{{.metadata.annotations.addons_repo_url}}'
        targetRevision: '{{.metadata.annotations.addons_repo_revision}}'
        ref: values
      - repoURL: 'https://argoproj.github.io/argo-helm'
        targetRevision: '7.4.1'
        chart: 'argo-cd'
        helm:
          releaseName: 'argocd'
          ignoreMissingValueFiles: true
          valueFiles:
            - '$values/default/addons/aws-argocd/values.yaml'
            - '$values/default/addons/aws-argocd/7.4/values.yaml'
            - '$values/environments/{{.metadata.labels.environment}}/addons/aws-argocd/values.yaml'
            - '$values/environments/{{.metadata.labels.environment}}/addons/aws-argocd/7.4/values.yaml'
            - '$values/clusters/{{.nameNormalized}}/addons/aws-argocd/values.yaml'
            - '$values/clusters/{{.nameNormalized}}/addons/aws-argocd/7.4/values.yaml'
          valuesObject:
            controller:
              serviceAccount:
                annotations:
                  eks.amazonaws.com/role-arn: '{{.metadata.annotations.argocd_iam_role_arn}}'
            server:
              serviceAccount:
                annotations:
                  eks.amazonaws.com/role-arn: '{{.metadata.annotations.argocd_iam_role_arn}}'
      destination:
        namespace: '{{ default "argocd" (index .metadata.annotations "aws_argocd_namespace") }}'
        name: '{{.name}}'
      syncPolicy:
        automated:
          allowEmpty: true
          prune: false
          selfHeal: false
        retry:
          backoff:
            duration: 5s
            factor: 2
            maxDuration: 10m
          limit: -1
        syncOptions:
        - CreateNamespace=true
        - ServerSideApply=true
---
# Source: gitops-bridge/templates/applicationsets.yaml
apiVersion: argoproj.io/v1alpha1
kind: ApplicationSet
metadata:
  name: aws-argocd-ingress
  namespace: argocd
  annotations:
    helm.sh/chart: gitops-bridge-1.0.0
  labels:
    helm.sh/chart: gitops-bridge-1.0.0
    app.kubernetes.io/name: gitops-bridge
    app.kubernetes.io/instance: my-release
    app.kubernetes.io/managed-by: Helm
    addon: "true"
spec:
  syncPolicy:
    preserveResourcesOnDeletion: true
  goTemplate: true
  goTemplateOptions:
  - missingkey=error
  generators:
          - clusters: # for reason this is need it as second in the matrix, if not the above extracting .tenants doesn't work
              selector:
                matchLabels:
                  argocd.argoproj.io/secret-type: cluster
                matchExpressions:
                - key: enable_aws_argocd_ingress
                  operator: In
                  values:
                  - "true"


  template:
    metadata:
      name: addon-aws-argocd-ingress-{{.nameNormalized}}
      annotations:
        argocd.argoproj.io/manifest-generate-paths: default/addons/aws-argocd-ingress/values.yaml;environments/{{.metadata.labels.environment}}/addons/aws-argocd-ingress/values.yaml;clusters/{{.nameNormalized}}/addons/aws-argocd-ingress/values.yaml;
        helm.sh/chart: gitops-bridge-1.0.0
      labels:
        helm.sh/chart: gitops-bridge-1.0.0
        app.kubernetes.io/name: gitops-bridge
        app.kubernetes.io/instance: my-release
        app.kubernetes.io/managed-by: Helm
        addon: "true"
        component: 'aws-argocd-ingress'
        environment: '{{.metadata.labels.environment}}'
        cluster: '{{.name}}'
    spec:
      project: default
      sources:
      - repoURL: '{{.metadata.annotations.addons_repo_url}}'
        targetRevision: '{{.metadata.annotations.addons_repo_revision}}'
        ref: values
      - repoURL: 'https://argoproj.github.io/argo-helm'
        targetRevision: '7.4.1'
        chart: 'argo-cd'
        helm:
          releaseName: 'argocd'
          ignoreMissingValueFiles: true
          valueFiles:
            - '$values/default/addons/aws-argocd-ingress/values.yaml'
            - '$values/default/addons/aws-argocd-ingress/7.4/values.yaml'
            - '$values/environments/{{.metadata.labels.environment}}/addons/aws-argocd-ingress/values.yaml'
            - '$values/environments/{{.metadata.labels.environment}}/addons/aws-argocd-ingress/7.4/values.yaml'
            - '$values/clusters/{{.nameNormalized}}/addons/aws-argocd-ingress/values.yaml'
            - '$values/clusters/{{.nameNormalized}}/addons/aws-argocd-ingress/7.4/values.yaml'
          valuesObject:
            global:
              domain: '{{.metadata.annotations.argocd_domain}}'
            server:
              ingress:
                annotations:
                  alb.ingress.kubernetes.io/backend-protocol: HTTPS
                  alb.ingress.kubernetes.io/listen-ports: '[{"HTTP":80},{"HTTPS":443}]'
                  alb.ingress.kubernetes.io/scheme: internet-facing
                  alb.ingress.kubernetes.io/ssl-redirect: "443"
                  alb.ingress.kubernetes.io/tags: Environment=hub,GitOps=true
                  alb.ingress.kubernetes.io/target-type: ip
                aws:
                  backendProtocolVersion: GRPC
                  serviceType: ClusterIP
                controller: aws
                enabled: true
                ingressClassName: alb
              service:
                type: ClusterIP
      destination:
        namespace: '{{ default "argocd" (index .metadata.annotations "aws_argocd_ingress_namespace") }}'
        name: '{{.name}}'
      syncPolicy:
        automated:
          allowEmpty: true
          prune: false
          selfHeal: false
        retry:
          backoff:
            duration: 5s
            factor: 2
            maxDuration: 10m
          limit: -1
        syncOptions:
        - CreateNamespace=true
        - ServerSideApply=true
---
# Source: gitops-bridge/templates/applicationsets.yaml
apiVersion: argoproj.io/v1alpha1
kind: ApplicationSet
metadata:
  name: aws-cloudwatch-metrics
  namespace: argocd
  annotations:
    helm.sh/chart: gitops-bridge-1.0.0
  labels:
    helm.sh/chart: gitops-bridge-1.0.0
    app.kubernetes.io/name: gitops-bridge
    app.kubernetes.io/instance: my-release
    app.kubernetes.io/managed-by: Helm
    addon: "true"
spec:
  syncPolicy:
    preserveResourcesOnDeletion: true
  goTemplate: true
  goTemplateOptions:
  - missingkey=error
  generators:
          - clusters: # for reason this is need it as second in the matrix, if not the above extracting .tenants doesn't work
              selector:
                matchLabels:
                  argocd.argoproj.io/secret-type: cluster
                matchExpressions:
                - key: enable_aws_cloudwatch_metrics
                  operator: In
                  values:
                  - "true"


  template:
    metadata:
      name: addon-aws-cloudwatch-metrics-{{.nameNormalized}}
      annotations:
        argocd.argoproj.io/manifest-generate-paths: default/addons/aws-cloudwatch-metrics/values.yaml;environments/{{.metadata.labels.environment}}/addons/aws-cloudwatch-metrics/values.yaml;clusters/{{.nameNormalized}}/addons/aws-cloudwatch-metrics/values.yaml;
        helm.sh/chart: gitops-bridge-1.0.0
      labels:
        helm.sh/chart: gitops-bridge-1.0.0
        app.kubernetes.io/name: gitops-bridge
        app.kubernetes.io/instance: my-release
        app.kubernetes.io/managed-by: Helm
        addon: "true"
        component: 'aws-cloudwatch-metrics'
        environment: '{{.metadata.labels.environment}}'
        cluster: '{{.name}}'
    spec:
      project: default
      sources:
      - repoURL: '{{.metadata.annotations.addons_repo_url}}'
        targetRevision: '{{.metadata.annotations.addons_repo_revision}}'
        ref: values
      - repoURL: 'https://aws.github.io/eks-charts'
        targetRevision: '0.0.11'
        chart: 'aws-cloudwatch-metrics'
        helm:
          releaseName: 'aws-cloudwatch-metrics'
          ignoreMissingValueFiles: true
          valueFiles:
            - '$values/default/addons/aws-cloudwatch-metrics/values.yaml'
            - '$values/default/addons/aws-cloudwatch-metrics/0.0/values.yaml'
            - '$values/environments/{{.metadata.labels.environment}}/addons/aws-cloudwatch-metrics/values.yaml'
            - '$values/environments/{{.metadata.labels.environment}}/addons/aws-cloudwatch-metrics/0.0/values.yaml'
            - '$values/clusters/{{.nameNormalized}}/addons/aws-cloudwatch-metrics/values.yaml'
            - '$values/clusters/{{.nameNormalized}}/addons/aws-cloudwatch-metrics/0.0/values.yaml'
          valuesObject:
            clusterName: '{{.metadata.annotations.aws_cluster_name}}'
            serviceAccount:
              annotations:
                eks.amazonaws.com/role-arn: '{{.metadata.annotations.aws_cloudwatch_metrics_iam_role_arn}}'
              name: '{{.metadata.annotations.aws_cloudwatch_metrics_service_account}}'
      destination:
        namespace: '{{ default "kube-system" (index .metadata.annotations "aws_cloudwatch_metrics_namespace") }}'
        name: '{{.name}}'
      syncPolicy:
        automated:
          allowEmpty: true
          prune: false
          selfHeal: false
        retry:
          backoff:
            duration: 5s
            factor: 2
            maxDuration: 10m
          limit: -1
        syncOptions:
        - CreateNamespace=true
        - ServerSideApply=true
---
# Source: gitops-bridge/templates/applicationsets.yaml
apiVersion: argoproj.io/v1alpha1
kind: ApplicationSet
metadata:
  name: aws-crossplane-provider
  namespace: argocd
  annotations:
    helm.sh/chart: gitops-bridge-1.0.0
  labels:
    helm.sh/chart: gitops-bridge-1.0.0
    app.kubernetes.io/name: gitops-bridge
    app.kubernetes.io/instance: my-release
    app.kubernetes.io/managed-by: Helm
    addon: "true"
spec:
  syncPolicy:
    preserveResourcesOnDeletion: true
  goTemplate: true
  goTemplateOptions:
  - missingkey=error
  generators:
          - clusters: # for reason this is need it as second in the matrix, if not the above extracting .tenants doesn't work
              selector:
                matchLabels:
                  argocd.argoproj.io/secret-type: cluster
                matchExpressions:
                - key: enable_aws_crossplane_provider
                  operator: In
                  values:
                  - "true"


  template:
    metadata:
      name: addon-aws-crossplane-provider-{{.nameNormalized}}
      annotations:
        argocd.argoproj.io/manifest-generate-paths: default/addons/aws-crossplane-provider/values.yaml;environments/{{.metadata.labels.environment}}/addons/aws-crossplane-provider/values.yaml;clusters/{{.nameNormalized}}/addons/aws-crossplane-provider/values.yaml;
        helm.sh/chart: gitops-bridge-1.0.0
      labels:
        helm.sh/chart: gitops-bridge-1.0.0
        app.kubernetes.io/name: gitops-bridge
        app.kubernetes.io/instance: my-release
        app.kubernetes.io/managed-by: Helm
        addon: "true"
        component: 'aws-crossplane-provider'
        environment: '{{.metadata.labels.environment}}'
        cluster: '{{.name}}'
    spec:
      project: default
      sources:
      - repoURL: '{{.metadata.annotations.addons_repo_url}}'
        targetRevision: '{{.metadata.annotations.addons_repo_revision}}'
        ref: values
      - repoURL: 'https://gitops-bridge-dev.github.io/gitops-bridge-helm-charts'
        targetRevision: '2.2.0'
        chart: 'crossplane-aws'
        helm:
          releaseName: 'crossplane-aws'
          ignoreMissingValueFiles: true
          valueFiles:
            - '$values/default/addons/aws-crossplane-provider/values.yaml'
            - '$values/default/addons/aws-crossplane-provider/2.2/values.yaml'
            - '$values/environments/{{.metadata.labels.environment}}/addons/aws-crossplane-provider/values.yaml'
            - '$values/environments/{{.metadata.labels.environment}}/addons/aws-crossplane-provider/2.2/values.yaml'
            - '$values/clusters/{{.nameNormalized}}/addons/aws-crossplane-provider/values.yaml'
            - '$values/clusters/{{.nameNormalized}}/addons/aws-crossplane-provider/2.2/values.yaml'
          valuesObject:
            deploymentRuntimeConfig:
              metadata:
                role_arn: '{{.metadata.annotations.aws_crossplane_iam_role_arn}}'
            provider:
              package:
                registry: xpkg.upbound.io/crossplane-contrib/provider-aws
                version: v0.49.1
      destination:
        namespace: 'crossplane-system'
        name: '{{.name}}'
      syncPolicy:
        automated:
          allowEmpty: true
          prune: false
          selfHeal: false
        retry:
          backoff:
            duration: 5s
            factor: 2
            maxDuration: 10m
          limit: -1
        syncOptions:
        - CreateNamespace=true
        - ServerSideApply=true
---
# Source: gitops-bridge/templates/applicationsets.yaml
apiVersion: argoproj.io/v1alpha1
kind: ApplicationSet
metadata:
  name: aws-crossplane-upbound-provider
  namespace: argocd
  annotations:
    helm.sh/chart: gitops-bridge-1.0.0
  labels:
    helm.sh/chart: gitops-bridge-1.0.0
    app.kubernetes.io/name: gitops-bridge
    app.kubernetes.io/instance: my-release
    app.kubernetes.io/managed-by: Helm
    addon: "true"
spec:
  syncPolicy:
    preserveResourcesOnDeletion: true
  goTemplate: true
  goTemplateOptions:
  - missingkey=error
  generators:
          - clusters: # for reason this is need it as second in the matrix, if not the above extracting .tenants doesn't work
              selector:
                matchLabels:
                  argocd.argoproj.io/secret-type: cluster
                matchExpressions:
                - key: enable_aws_crossplane_upbound_provider
                  operator: In
                  values:
                  - "true"


  template:
    metadata:
      name: addon-aws-crossplane-upbound-provider-{{.nameNormalized}}
      annotations:
        argocd.argoproj.io/manifest-generate-paths: default/addons/aws-crossplane-upbound-provider/values.yaml;environments/{{.metadata.labels.environment}}/addons/aws-crossplane-upbound-provider/values.yaml;clusters/{{.nameNormalized}}/addons/aws-crossplane-upbound-provider/values.yaml;
        helm.sh/chart: gitops-bridge-1.0.0
      labels:
        helm.sh/chart: gitops-bridge-1.0.0
        app.kubernetes.io/name: gitops-bridge
        app.kubernetes.io/instance: my-release
        app.kubernetes.io/managed-by: Helm
        addon: "true"
        component: 'aws-crossplane-upbound-provider'
        environment: '{{.metadata.labels.environment}}'
        cluster: '{{.name}}'
    spec:
      project: default
      sources:
      - repoURL: '{{.metadata.annotations.addons_repo_url}}'
        targetRevision: '{{.metadata.annotations.addons_repo_revision}}'
        ref: values
      - repoURL: 'https://gitops-bridge-dev.github.io/gitops-bridge-helm-charts'
        targetRevision: '3.0.0'
        chart: 'crossplane-aws-upbound'
        helm:
          releaseName: 'crossplane-aws-upbound'
          ignoreMissingValueFiles: true
          valueFiles:
            - '$values/default/addons/aws-crossplane-upbound-provider/values.yaml'
            - '$values/default/addons/aws-crossplane-upbound-provider/3.0/values.yaml'
            - '$values/environments/{{.metadata.labels.environment}}/addons/aws-crossplane-upbound-provider/values.yaml'
            - '$values/environments/{{.metadata.labels.environment}}/addons/aws-crossplane-upbound-provider/3.0/values.yaml'
            - '$values/clusters/{{.nameNormalized}}/addons/aws-crossplane-upbound-provider/values.yaml'
            - '$values/clusters/{{.nameNormalized}}/addons/aws-crossplane-upbound-provider/3.0/values.yaml'
          valuesObject:
            deploymentRuntimeConfig:
              metadata:
                role_arn: '{{.metadata.annotations.aws_upbound_crossplane_iam_role_arn}}'
            provider:
              package:
                registry: xpkg.upbound.io/upbound
                version: v1.1.0
            providers:
            - cloudfront
            - cloudwatchlogs
            - dynamodb
            - ec2
            - eks
            - firehose
            - iam
            - kms
            - lambda
            - rds
            - s3
            - sns
            - sqs
      destination:
        namespace: 'crossplane-system'
        name: '{{.name}}'
      syncPolicy:
        automated:
          allowEmpty: true
          prune: false
          selfHeal: false
        retry:
          backoff:
            duration: 5s
            factor: 2
            maxDuration: 10m
          limit: -1
        syncOptions:
        - CreateNamespace=true
        - ServerSideApply=true
---
# Source: gitops-bridge/templates/applicationsets.yaml
apiVersion: argoproj.io/v1alpha1
kind: ApplicationSet
metadata:
  name: aws-ebs-csi-resources
  namespace: argocd
  annotations:
    helm.sh/chart: gitops-bridge-1.0.0
  labels:
    helm.sh/chart: gitops-bridge-1.0.0
    app.kubernetes.io/name: gitops-bridge
    app.kubernetes.io/instance: my-release
    app.kubernetes.io/managed-by: Helm
    addon: "true"
spec:
  syncPolicy:
    preserveResourcesOnDeletion: true
  goTemplate: true
  goTemplateOptions:
  - missingkey=error
  generators:
          - clusters: # for reason this is need it as second in the matrix, if not the above extracting .tenants doesn't work
              selector:
                matchLabels:
                  argocd.argoproj.io/secret-type: cluster
                matchExpressions:
                - key: enable_aws_ebs_csi_resources
                  operator: In
                  values:
                  - "true"


  template:
    metadata:
      name: addon-aws-ebs-csi-resources-{{.nameNormalized}}
      annotations:
        argocd.argoproj.io/manifest-generate-paths: default/addons/aws-ebs-csi-resources/values.yaml;environments/{{.metadata.labels.environment}}/addons/aws-ebs-csi-resources/values.yaml;clusters/{{.nameNormalized}}/addons/aws-ebs-csi-resources/values.yaml;
        helm.sh/chart: gitops-bridge-1.0.0
      labels:
        helm.sh/chart: gitops-bridge-1.0.0
        app.kubernetes.io/name: gitops-bridge
        app.kubernetes.io/instance: my-release
        app.kubernetes.io/managed-by: Helm
        addon: "true"
        component: 'aws-ebs-csi-resources'
        environment: '{{.metadata.labels.environment}}'
        cluster: '{{.name}}'
    spec:
      project: default
      sources:
      - repoURL: '{{.metadata.annotations.addons_repo_url}}'
        targetRevision: '{{.metadata.annotations.addons_repo_revision}}'
        ref: values
      - repoURL: 'https://gitops-bridge-dev.github.io/gitops-bridge-helm-charts'
        targetRevision: '1.0.0'
        chart: 'aws-ebs-csi-classes'
        helm:
          releaseName: 'aws-ebs-csi-classes'
          ignoreMissingValueFiles: true
          valueFiles:
            - '$values/default/addons/aws-ebs-csi-resources/values.yaml'
            - '$values/default/addons/aws-ebs-csi-resources/1.0/values.yaml'
            - '$values/environments/{{.metadata.labels.environment}}/addons/aws-ebs-csi-resources/values.yaml'
            - '$values/environments/{{.metadata.labels.environment}}/addons/aws-ebs-csi-resources/1.0/values.yaml'
            - '$values/clusters/{{.nameNormalized}}/addons/aws-ebs-csi-resources/values.yaml'
            - '$values/clusters/{{.nameNormalized}}/addons/aws-ebs-csi-resources/1.0/values.yaml'
      destination:
        namespace: 'kube-system'
        name: '{{.name}}'
      syncPolicy:
        automated:
          allowEmpty: true
          prune: false
          selfHeal: false
        retry:
          backoff:
            duration: 5s
            factor: 2
            maxDuration: 10m
          limit: -1
        syncOptions:
        - CreateNamespace=true
        - ServerSideApply=true
---
# Source: gitops-bridge/templates/applicationsets.yaml
apiVersion: argoproj.io/v1alpha1
kind: ApplicationSet
metadata:
  name: aws-efs-csi-driver
  namespace: argocd
  annotations:
    helm.sh/chart: gitops-bridge-1.0.0
  labels:
    helm.sh/chart: gitops-bridge-1.0.0
    app.kubernetes.io/name: gitops-bridge
    app.kubernetes.io/instance: my-release
    app.kubernetes.io/managed-by: Helm
    addon: "true"
spec:
  syncPolicy:
    preserveResourcesOnDeletion: true
  goTemplate: true
  goTemplateOptions:
  - missingkey=error
  generators:
          - clusters: # for reason this is need it as second in the matrix, if not the above extracting .tenants doesn't work
              selector:
                matchLabels:
                  argocd.argoproj.io/secret-type: cluster
                matchExpressions:
                - key: enable_aws_efs_csi_driver
                  operator: In
                  values:
                  - "true"


  template:
    metadata:
      name: addon-aws-efs-csi-driver-{{.nameNormalized}}
      annotations:
        argocd.argoproj.io/manifest-generate-paths: default/addons/aws-efs-csi-driver/values.yaml;environments/{{.metadata.labels.environment}}/addons/aws-efs-csi-driver/values.yaml;clusters/{{.nameNormalized}}/addons/aws-efs-csi-driver/values.yaml;
        helm.sh/chart: gitops-bridge-1.0.0
      labels:
        helm.sh/chart: gitops-bridge-1.0.0
        app.kubernetes.io/name: gitops-bridge
        app.kubernetes.io/instance: my-release
        app.kubernetes.io/managed-by: Helm
        addon: "true"
        component: 'aws-efs-csi-driver'
        environment: '{{.metadata.labels.environment}}'
        cluster: '{{.name}}'
    spec:
      project: default
      sources:
      - repoURL: '{{.metadata.annotations.addons_repo_url}}'
        targetRevision: '{{.metadata.annotations.addons_repo_revision}}'
        ref: values
      - repoURL: 'https://kubernetes-sigs.github.io/aws-efs-csi-driver'
        targetRevision: '3.0.7'
        chart: 'aws-efs-csi-driver'
        helm:
          releaseName: 'aws-efs-csi-driver'
          ignoreMissingValueFiles: true
          valueFiles:
            - '$values/default/addons/aws-efs-csi-driver/values.yaml'
            - '$values/default/addons/aws-efs-csi-driver/3.0/values.yaml'
            - '$values/environments/{{.metadata.labels.environment}}/addons/aws-efs-csi-driver/values.yaml'
            - '$values/environments/{{.metadata.labels.environment}}/addons/aws-efs-csi-driver/3.0/values.yaml'
            - '$values/clusters/{{.nameNormalized}}/addons/aws-efs-csi-driver/values.yaml'
            - '$values/clusters/{{.nameNormalized}}/addons/aws-efs-csi-driver/3.0/values.yaml'
          valuesObject:
            controller:
              serviceAccount:
                annotations:
                  eks.amazonaws.com/role-arn: '{{.metadata.annotations.aws_efs_csi_driver_iam_role_arn}}'
                name: '{{.metadata.annotations.aws_efs_csi_driver_controller_service_account}}'
            node:
              serviceAccount:
                annotations:
                  eks.amazonaws.com/role-arn: '{{.metadata.annotations.aws_efs_csi_driver_iam_role_arn}}'
                name: '{{.metadata.annotations.aws_efs_csi_driver_node_service_account}}'
      destination:
        namespace: '{{ default "kube-system" (index .metadata.annotations "aws_efs_csi_driver_namespace") }}'
        name: '{{.name}}'
      syncPolicy:
        automated:
          allowEmpty: true
          prune: false
          selfHeal: false
        retry:
          backoff:
            duration: 5s
            factor: 2
            maxDuration: 10m
          limit: -1
        syncOptions:
        - CreateNamespace=true
        - ServerSideApply=true
---
# Source: gitops-bridge/templates/applicationsets.yaml
apiVersion: argoproj.io/v1alpha1
kind: ApplicationSet
metadata:
  name: aws-fargate-fluentbit
  namespace: argocd
  annotations:
    helm.sh/chart: gitops-bridge-1.0.0
  labels:
    helm.sh/chart: gitops-bridge-1.0.0
    app.kubernetes.io/name: gitops-bridge
    app.kubernetes.io/instance: my-release
    app.kubernetes.io/managed-by: Helm
    addon: "true"
spec:
  syncPolicy:
    preserveResourcesOnDeletion: true
  goTemplate: true
  goTemplateOptions:
  - missingkey=error
  generators:
          - clusters: # for reason this is need it as second in the matrix, if not the above extracting .tenants doesn't work
              selector:
                matchLabels:
                  argocd.argoproj.io/secret-type: cluster
                matchExpressions:
                - key: enable_fargate_fluentbit
                  operator: In
                  values:
                  - "true"


  template:
    metadata:
      name: addon-aws-fargate-fluentbit-{{.nameNormalized}}
      annotations:
        argocd.argoproj.io/manifest-generate-paths: default/addons/aws-fargate-fluentbit/values.yaml;environments/{{.metadata.labels.environment}}/addons/aws-fargate-fluentbit/values.yaml;clusters/{{.nameNormalized}}/addons/aws-fargate-fluentbit/values.yaml;
        helm.sh/chart: gitops-bridge-1.0.0
      labels:
        helm.sh/chart: gitops-bridge-1.0.0
        app.kubernetes.io/name: gitops-bridge
        app.kubernetes.io/instance: my-release
        app.kubernetes.io/managed-by: Helm
        addon: "true"
        component: 'aws-fargate-fluentbit'
        environment: '{{.metadata.labels.environment}}'
        cluster: '{{.name}}'
    spec:
      project: default
      sources:
      - repoURL: '{{.metadata.annotations.addons_repo_url}}'
        targetRevision: '{{.metadata.annotations.addons_repo_revision}}'
        ref: values
      - repoURL: 'https://gitops-bridge-dev.github.io/gitops-bridge-helm-charts'
        targetRevision: '1.0.0'
        chart: 'aws-fargate-fluentbit'
        helm:
          releaseName: 'aws-fargate-fluentbit'
          ignoreMissingValueFiles: true
          valueFiles:
            - '$values/default/addons/aws-fargate-fluentbit/values.yaml'
            - '$values/default/addons/aws-fargate-fluentbit/1.0/values.yaml'
            - '$values/environments/{{.metadata.labels.environment}}/addons/aws-fargate-fluentbit/values.yaml'
            - '$values/environments/{{.metadata.labels.environment}}/addons/aws-fargate-fluentbit/1.0/values.yaml'
            - '$values/clusters/{{.nameNormalized}}/addons/aws-fargate-fluentbit/values.yaml'
            - '$values/clusters/{{.nameNormalized}}/addons/aws-fargate-fluentbit/1.0/values.yaml'
          valuesObject:
            log_group_name: '{{.metadata.annotations.fargate_fluentbit_log_group_name}}'
            log_stream_prefix: '{{.metadata.annotations.fargate_fluentbit_log_stream_prefix}}'
            region: '{{.metadata.annotations.aws_region}}'
      destination:
        namespace: 'kube-system'
        name: '{{.name}}'
      syncPolicy:
        automated:
          allowEmpty: true
          prune: false
          selfHeal: false
        retry:
          backoff:
            duration: 5s
            factor: 2
            maxDuration: 10m
          limit: -1
        syncOptions:
        - CreateNamespace=true
        - ServerSideApply=true
---
# Source: gitops-bridge/templates/applicationsets.yaml
apiVersion: argoproj.io/v1alpha1
kind: ApplicationSet
metadata:
  name: aws-for-fluentbit
  namespace: argocd
  annotations:
    helm.sh/chart: gitops-bridge-1.0.0
  labels:
    helm.sh/chart: gitops-bridge-1.0.0
    app.kubernetes.io/name: gitops-bridge
    app.kubernetes.io/instance: my-release
    app.kubernetes.io/managed-by: Helm
    addon: "true"
spec:
  syncPolicy:
    preserveResourcesOnDeletion: true
  goTemplate: true
  goTemplateOptions:
  - missingkey=error
  generators:
          - clusters: # for reason this is need it as second in the matrix, if not the above extracting .tenants doesn't work
              selector:
                matchLabels:
                  argocd.argoproj.io/secret-type: cluster
                matchExpressions:
                - key: enable_aws_for_fluentbit
                  operator: In
                  values:
                  - "true"


  template:
    metadata:
      name: addon-aws-for-fluentbit-{{.nameNormalized}}
      annotations:
        argocd.argoproj.io/manifest-generate-paths: default/addons/aws-for-fluentbit/values.yaml;environments/{{.metadata.labels.environment}}/addons/aws-for-fluentbit/values.yaml;clusters/{{.nameNormalized}}/addons/aws-for-fluentbit/values.yaml;
        helm.sh/chart: gitops-bridge-1.0.0
      labels:
        helm.sh/chart: gitops-bridge-1.0.0
        app.kubernetes.io/name: gitops-bridge
        app.kubernetes.io/instance: my-release
        app.kubernetes.io/managed-by: Helm
        addon: "true"
        component: 'aws-for-fluentbit'
        environment: '{{.metadata.labels.environment}}'
        cluster: '{{.name}}'
    spec:
      project: default
      sources:
      - repoURL: '{{.metadata.annotations.addons_repo_url}}'
        targetRevision: '{{.metadata.annotations.addons_repo_revision}}'
        ref: values
      - repoURL: 'https://aws.github.io/eks-charts'
        targetRevision: '0.1.34'
        chart: 'aws-for-fluent-bit'
        helm:
          releaseName: 'aws-for-fluentbit'
          ignoreMissingValueFiles: true
          valueFiles:
            - '$values/default/addons/aws-for-fluentbit/values.yaml'
            - '$values/default/addons/aws-for-fluentbit/0.1/values.yaml'
            - '$values/environments/{{.metadata.labels.environment}}/addons/aws-for-fluentbit/values.yaml'
            - '$values/environments/{{.metadata.labels.environment}}/addons/aws-for-fluentbit/0.1/values.yaml'
            - '$values/clusters/{{.nameNormalized}}/addons/aws-for-fluentbit/values.yaml'
            - '$values/clusters/{{.nameNormalized}}/addons/aws-for-fluentbit/0.1/values.yaml'
          valuesObject:
            cloudWatchLogs:
              enabled: true
              logGroupName: '{{.metadata.annotations.aws_for_fluentbit_log_group_name}}'
              logGroupTemplate: '{{.metadata.annotations.aws_for_fluentbit_log_group_name}}/workload/$kubernetes[''namespace_name'']'
              logRetentionDays: 90
              logStreamTemplate: $kubernetes['pod_name'].$kubernetes['container_name']
              region: '{{.metadata.annotations.aws_region}}'
            serviceAccount:
              annotations:
                eks.amazonaws.com/role-arn: '{{.metadata.annotations.aws_for_fluentbit_iam_role_arn}}'
              name: '{{.metadata.annotations.aws_for_fluentbit_service_account}}'
      destination:
        namespace: '{{ default "kube-system" (index .metadata.annotations "aws_for_fluentbit_namespace") }}'
        name: '{{.name}}'
      syncPolicy:
        automated:
          allowEmpty: true
          prune: false
          selfHeal: false
        retry:
          backoff:
            duration: 5s
            factor: 2
            maxDuration: 10m
          limit: -1
        syncOptions:
        - CreateNamespace=true
        - ServerSideApply=true
---
# Source: gitops-bridge/templates/applicationsets.yaml
apiVersion: argoproj.io/v1alpha1
kind: ApplicationSet
metadata:
  name: aws-gateway-api-controller
  namespace: argocd
  annotations:
    helm.sh/chart: gitops-bridge-1.0.0
  labels:
    helm.sh/chart: gitops-bridge-1.0.0
    app.kubernetes.io/name: gitops-bridge
    app.kubernetes.io/instance: my-release
    app.kubernetes.io/managed-by: Helm
    addon: "true"
spec:
  syncPolicy:
    preserveResourcesOnDeletion: true
  goTemplate: true
  goTemplateOptions:
  - missingkey=error
  generators:
          - clusters: # for reason this is need it as second in the matrix, if not the above extracting .tenants doesn't work
              selector:
                matchLabels:
                  argocd.argoproj.io/secret-type: cluster
                matchExpressions:
                - key: enable_aws_gateway_api_controller
                  operator: In
                  values:
                  - "true"


  template:
    metadata:
      name: addon-aws-gateway-api-controller-{{.nameNormalized}}
      annotations:
        argocd.argoproj.io/manifest-generate-paths: default/addons/aws-gateway-api-controller/values.yaml;environments/{{.metadata.labels.environment}}/addons/aws-gateway-api-controller/values.yaml;clusters/{{.nameNormalized}}/addons/aws-gateway-api-controller/values.yaml;
        helm.sh/chart: gitops-bridge-1.0.0
      labels:
        helm.sh/chart: gitops-bridge-1.0.0
        app.kubernetes.io/name: gitops-bridge
        app.kubernetes.io/instance: my-release
        app.kubernetes.io/managed-by: Helm
        addon: "true"
        component: 'aws-gateway-api-controller'
        environment: '{{.metadata.labels.environment}}'
        cluster: '{{.name}}'
    spec:
      project: default
      sources:
      - repoURL: '{{.metadata.annotations.addons_repo_url}}'
        targetRevision: '{{.metadata.annotations.addons_repo_revision}}'
        ref: values
      - repoURL: 'public.ecr.aws'
        targetRevision: 'v1.0.7'
        chart: 'aws-gateway-controller-chart'
        helm:
          releaseName: 'aws-gateway-api-controller'
          ignoreMissingValueFiles: true
          valueFiles:
            - '$values/default/addons/aws-gateway-api-controller/values.yaml'
            - '$values/default/addons/aws-gateway-api-controller/1.0/values.yaml'
            - '$values/environments/{{.metadata.labels.environment}}/addons/aws-gateway-api-controller/values.yaml'
            - '$values/environments/{{.metadata.labels.environment}}/addons/aws-gateway-api-controller/1.0/values.yaml'
            - '$values/clusters/{{.nameNormalized}}/addons/aws-gateway-api-controller/values.yaml'
            - '$values/clusters/{{.nameNormalized}}/addons/aws-gateway-api-controller/1.0/values.yaml'
          valuesObject:
            awsAccountId: '{{.metadata.annotations.aws_account_id}}'
            awsRegion: '{{.metadata.annotations.aws_region}}'
            clusterVpcId: '{{.metadata.annotations.aws_vpc_id}}'
            serviceAccount:
              annotations:
                eks.amazonaws.com/role-arn: '{{.metadata.annotations.aws_gateway_api_controller_iam_role_arn}}'
              name: '{{.metadata.annotations.aws_gateway_api_controller_service_account}}'
      destination:
        namespace: '{{ default "kube-system" (index .metadata.annotations "aws_gateway_api_controller_namespace") }}'
        name: '{{.name}}'
      syncPolicy:
        automated:
          allowEmpty: true
          prune: false
          selfHeal: false
        retry:
          backoff:
            duration: 5s
            factor: 2
            maxDuration: 10m
          limit: -1
        syncOptions:
        - CreateNamespace=true
        - ServerSideApply=true
---
# Source: gitops-bridge/templates/applicationsets.yaml
apiVersion: argoproj.io/v1alpha1
kind: ApplicationSet
metadata:
  name: aws-load-balancer-controller
  namespace: argocd
  annotations:
    helm.sh/chart: gitops-bridge-1.0.0
    argocd.argoproj.io/sync-wave: "-1"
  labels:
    helm.sh/chart: gitops-bridge-1.0.0
    app.kubernetes.io/name: gitops-bridge
    app.kubernetes.io/instance: my-release
    app.kubernetes.io/managed-by: Helm
    addon: "true"
spec:
  syncPolicy:
    preserveResourcesOnDeletion: true
  goTemplate: true
  goTemplateOptions:
  - missingkey=error
  generators:
          - clusters: # for reason this is need it as second in the matrix, if not the above extracting .tenants doesn't work
              selector:
                matchLabels:
                  argocd.argoproj.io/secret-type: cluster
                matchExpressions:
                - key: enable_aws_load_balancer_controller
                  operator: In
                  values:
                  - "true"


  template:
    metadata:
      name: addon-aws-load-balancer-controller-{{.nameNormalized}}
      annotations:
        argocd.argoproj.io/manifest-generate-paths: default/addons/aws-load-balancer-controller/values.yaml;environments/{{.metadata.labels.environment}}/addons/aws-load-balancer-controller/values.yaml;clusters/{{.nameNormalized}}/addons/aws-load-balancer-controller/values.yaml;
        helm.sh/chart: gitops-bridge-1.0.0
      labels:
        helm.sh/chart: gitops-bridge-1.0.0
        app.kubernetes.io/name: gitops-bridge
        app.kubernetes.io/instance: my-release
        app.kubernetes.io/managed-by: Helm
        addon: "true"
        component: 'aws-load-balancer-controller'
        environment: '{{.metadata.labels.environment}}'
        cluster: '{{.name}}'
    spec:
      project: default
      sources:
      - repoURL: '{{.metadata.annotations.addons_repo_url}}'
        targetRevision: '{{.metadata.annotations.addons_repo_revision}}'
        ref: values
      - repoURL: 'https://aws.github.io/eks-charts'
        targetRevision: '1.11.0'
        chart: 'aws-load-balancer-controller'
        helm:
          releaseName: 'aws-load-balancer-controller'
          ignoreMissingValueFiles: true
          valueFiles:
            - '$values/default/addons/aws-load-balancer-controller/values.yaml'
            - '$values/default/addons/aws-load-balancer-controller/1.11/values.yaml'
            - '$values/environments/{{.metadata.labels.environment}}/addons/aws-load-balancer-controller/values.yaml'
            - '$values/environments/{{.metadata.labels.environment}}/addons/aws-load-balancer-controller/1.11/values.yaml'
            - '$values/clusters/{{.nameNormalized}}/addons/aws-load-balancer-controller/values.yaml'
            - '$values/clusters/{{.nameNormalized}}/addons/aws-load-balancer-controller/1.11/values.yaml'
          valuesObject:
            clusterName: '{{.metadata.annotations.aws_cluster_name}}'
            region: '{{.metadata.annotations.aws_region}}'
            serviceAccount:
              annotations:
                eks.amazonaws.com/role-arn: '{{.metadata.annotations.aws_load_balancer_controller_iam_role_arn}}'
              name: '{{.metadata.annotations.aws_load_balancer_controller_service_account}}'
            vpcId: '{{.metadata.annotations.aws_vpc_id}}'
      destination:
        namespace: '{{ default "kube-system" (index .metadata.annotations "aws_load_balancer_controller_namespace") }}'
        name: '{{.name}}'
      syncPolicy:
        automated:
          allowEmpty: true
          prune: false
          selfHeal: false
        retry:
          backoff:
            duration: 5s
            factor: 2
            maxDuration: 10m
          limit: -1
        syncOptions:
        - CreateNamespace=true
        - ServerSideApply=true
      ignoreDifferences:
        - jsonPointers:
          - /data
          kind: Secret
          name: aws-load-balancer-tls
        - group: admissionregistration.k8s.io
          jqPathExpressions:
          - .webhooks[].clientConfig.caBundle
          kind: MutatingWebhookConfiguration
        - group: admissionregistration.k8s.io
          jqPathExpressions:
          - .webhooks[].clientConfig.caBundle
          kind: ValidatingWebhookConfiguration
---
# Source: gitops-bridge/templates/applicationsets.yaml
apiVersion: argoproj.io/v1alpha1
kind: ApplicationSet
metadata:
  name: aws-node-termination-handler
  namespace: argocd
  annotations:
    helm.sh/chart: gitops-bridge-1.0.0
  labels:
    helm.sh/chart: gitops-bridge-1.0.0
    app.kubernetes.io/name: gitops-bridge
    app.kubernetes.io/instance: my-release
    app.kubernetes.io/managed-by: Helm
    addon: "true"
spec:
  syncPolicy:
    preserveResourcesOnDeletion: true
  goTemplate: true
  goTemplateOptions:
  - missingkey=error
  generators:
          - clusters: # for reason this is need it as second in the matrix, if not the above extracting .tenants doesn't work
              selector:
                matchLabels:
                  argocd.argoproj.io/secret-type: cluster
                matchExpressions:
                - key: enable_aws_node_termination_handler
                  operator: In
                  values:
                  - "true"


  template:
    metadata:
      name: addon-aws-node-termination-handler-{{.nameNormalized}}
      annotations:
        argocd.argoproj.io/manifest-generate-paths: default/addons/aws-node-termination-handler/values.yaml;environments/{{.metadata.labels.environment}}/addons/aws-node-termination-handler/values.yaml;clusters/{{.nameNormalized}}/addons/aws-node-termination-handler/values.yaml;
        helm.sh/chart: gitops-bridge-1.0.0
      labels:
        helm.sh/chart: gitops-bridge-1.0.0
        app.kubernetes.io/name: gitops-bridge
        app.kubernetes.io/instance: my-release
        app.kubernetes.io/managed-by: Helm
        addon: "true"
        component: 'aws-node-termination-handler'
        environment: '{{.metadata.labels.environment}}'
        cluster: '{{.name}}'
    spec:
      project: default
      sources:
      - repoURL: '{{.metadata.annotations.addons_repo_url}}'
        targetRevision: '{{.metadata.annotations.addons_repo_revision}}'
        ref: values
      - repoURL: 'https://aws.github.io/eks-charts'
        targetRevision: '0.21.0'
        chart: 'aws-node-termination-handler'
        helm:
          releaseName: 'aws-node-termination-handler'
          ignoreMissingValueFiles: true
          valueFiles:
            - '$values/default/addons/aws-node-termination-handler/values.yaml'
            - '$values/default/addons/aws-node-termination-handler/0.21/values.yaml'
            - '$values/environments/{{.metadata.labels.environment}}/addons/aws-node-termination-handler/values.yaml'
            - '$values/environments/{{.metadata.labels.environment}}/addons/aws-node-termination-handler/0.21/values.yaml'
            - '$values/clusters/{{.nameNormalized}}/addons/aws-node-termination-handler/values.yaml'
            - '$values/clusters/{{.nameNormalized}}/addons/aws-node-termination-handler/0.21/values.yaml'
          valuesObject:
            awsRegion: '{{.metadata.annotations.aws_region}}'
            enableSqsTerminationDraining: true
            queueURL: '{{.metadata.annotations.aws_node_termination_handler_sqs_queue_url}}'
            serviceAccount:
              annotations:
                eks.amazonaws.com/role-arn: '{{.metadata.annotations.aws_node_termination_handler_iam_role_arn}}'
              name: '{{.metadata.annotations.aws_node_termination_handler_service_account}}'
      destination:
        namespace: '{{ default "kube-system" (index .metadata.annotations "aws_node_termination_handler_namespace") }}'
        name: '{{.name}}'
      syncPolicy:
        automated:
          allowEmpty: true
          prune: false
          selfHeal: false
        retry:
          backoff:
            duration: 5s
            factor: 2
            maxDuration: 10m
          limit: -1
        syncOptions:
        - CreateNamespace=true
        - ServerSideApply=true
---
# Source: gitops-bridge/templates/applicationsets.yaml
apiVersion: argoproj.io/v1alpha1
kind: ApplicationSet
metadata:
  name: aws-privateca-issuer
  namespace: argocd
  annotations:
    helm.sh/chart: gitops-bridge-1.0.0
  labels:
    helm.sh/chart: gitops-bridge-1.0.0
    app.kubernetes.io/name: gitops-bridge
    app.kubernetes.io/instance: my-release
    app.kubernetes.io/managed-by: Helm
    addon: "true"
spec:
  syncPolicy:
    preserveResourcesOnDeletion: true
  goTemplate: true
  goTemplateOptions:
  - missingkey=error
  generators:
          - clusters: # for reason this is need it as second in the matrix, if not the above extracting .tenants doesn't work
              selector:
                matchLabels:
                  argocd.argoproj.io/secret-type: cluster
                matchExpressions:
                - key: enable_aws_privateca_issuer
                  operator: In
                  values:
                  - "true"


  template:
    metadata:
      name: addon-aws-privateca-issuer-{{.nameNormalized}}
      annotations:
        argocd.argoproj.io/manifest-generate-paths: default/addons/aws-privateca-issuer/values.yaml;environments/{{.metadata.labels.environment}}/addons/aws-privateca-issuer/values.yaml;clusters/{{.nameNormalized}}/addons/aws-privateca-issuer/values.yaml;
        helm.sh/chart: gitops-bridge-1.0.0
      labels:
        helm.sh/chart: gitops-bridge-1.0.0
        app.kubernetes.io/name: gitops-bridge
        app.kubernetes.io/instance: my-release
        app.kubernetes.io/managed-by: Helm
        addon: "true"
        component: 'aws-privateca-issuer'
        environment: '{{.metadata.labels.environment}}'
        cluster: '{{.name}}'
    spec:
      project: default
      sources:
      - repoURL: '{{.metadata.annotations.addons_repo_url}}'
        targetRevision: '{{.metadata.annotations.addons_repo_revision}}'
        ref: values
      - repoURL: 'https://cert-manager.github.io/aws-privateca-issuer'
        targetRevision: 'v1.3.0'
        chart: 'aws-privateca-issuer'
        helm:
          releaseName: 'privateca-issuer'
          ignoreMissingValueFiles: true
          valueFiles:
            - '$values/default/addons/aws-privateca-issuer/values.yaml'
            - '$values/default/addons/aws-privateca-issuer/1.3/values.yaml'
            - '$values/environments/{{.metadata.labels.environment}}/addons/aws-privateca-issuer/values.yaml'
            - '$values/environments/{{.metadata.labels.environment}}/addons/aws-privateca-issuer/1.3/values.yaml'
            - '$values/clusters/{{.nameNormalized}}/addons/aws-privateca-issuer/values.yaml'
            - '$values/clusters/{{.nameNormalized}}/addons/aws-privateca-issuer/1.3/values.yaml'
          valuesObject:
            serviceAccount:
              annotations:
                eks.amazonaws.com/role-arn: '{{.metadata.annotations.aws_privateca_issuer_iam_role_arn}}'
              name: '{{.metadata.annotations.aws_privateca_issuer_service_account}}'
      destination:
        namespace: '{{ default "kube-system" (index .metadata.annotations "aws_privateca_issuer_namespace") }}'
        name: '{{.name}}'
      syncPolicy:
        automated:
          allowEmpty: true
          prune: false
          selfHeal: false
        retry:
          backoff:
            duration: 5s
            factor: 2
            maxDuration: 10m
          limit: -1
        syncOptions:
        - CreateNamespace=true
        - ServerSideApply=true
---
# Source: gitops-bridge/templates/applicationsets.yaml
apiVersion: argoproj.io/v1alpha1
kind: ApplicationSet
metadata:
  name: aws-secrets-store-csi-driver-provider
  namespace: argocd
  annotations:
    helm.sh/chart: gitops-bridge-1.0.0
  labels:
    helm.sh/chart: gitops-bridge-1.0.0
    app.kubernetes.io/name: gitops-bridge
    app.kubernetes.io/instance: my-release
    app.kubernetes.io/managed-by: Helm
    addon: "true"
spec:
  syncPolicy:
    preserveResourcesOnDeletion: true
  goTemplate: true
  goTemplateOptions:
  - missingkey=error
  generators:
          - clusters: # for reason this is need it as second in the matrix, if not the above extracting .tenants doesn't work
              selector:
                matchLabels:
                  argocd.argoproj.io/secret-type: cluster
                matchExpressions:
                - key: enable_aws_secrets_store_csi_driver_provider
                  operator: In
                  values:
                  - "true"


  template:
    metadata:
      name: addon-aws-secrets-store-csi-driver-provider-{{.nameNormalized}}
      annotations:
        argocd.argoproj.io/manifest-generate-paths: default/addons/aws-secrets-store-csi-driver-provider/values.yaml;environments/{{.metadata.labels.environment}}/addons/aws-secrets-store-csi-driver-provider/values.yaml;clusters/{{.nameNormalized}}/addons/aws-secrets-store-csi-driver-provider/values.yaml;
        helm.sh/chart: gitops-bridge-1.0.0
      labels:
        helm.sh/chart: gitops-bridge-1.0.0
        app.kubernetes.io/name: gitops-bridge
        app.kubernetes.io/instance: my-release
        app.kubernetes.io/managed-by: Helm
        addon: "true"
        component: 'aws-secrets-store-csi-driver-provider'
        environment: '{{.metadata.labels.environment}}'
        cluster: '{{.name}}'
    spec:
      project: default
      sources:
      - repoURL: '{{.metadata.annotations.addons_repo_url}}'
        targetRevision: '{{.metadata.annotations.addons_repo_revision}}'
        ref: values
      - repoURL: 'https://aws.github.io/secrets-store-csi-driver-provider-aws'
        targetRevision: '0.3.9'
        chart: 'secrets-store-csi-driver-provider-aws'
        helm:
          releaseName: 'secrets-store-csi-driver-provider-aws'
          ignoreMissingValueFiles: true
          valueFiles:
            - '$values/default/addons/aws-secrets-store-csi-driver-provider/values.yaml'
            - '$values/default/addons/aws-secrets-store-csi-driver-provider/0.3/values.yaml'
            - '$values/environments/{{.metadata.labels.environment}}/addons/aws-secrets-store-csi-driver-provider/values.yaml'
            - '$values/environments/{{.metadata.labels.environment}}/addons/aws-secrets-store-csi-driver-provider/0.3/values.yaml'
            - '$values/clusters/{{.nameNormalized}}/addons/aws-secrets-store-csi-driver-provider/values.yaml'
            - '$values/clusters/{{.nameNormalized}}/addons/aws-secrets-store-csi-driver-provider/0.3/values.yaml'
      destination:
        namespace: '{{ default "kube-system" (index .metadata.annotations "aws_secrets_store_csi_driver_provider_namespace")}}'
        name: '{{.name}}'
      syncPolicy:
        automated:
          allowEmpty: true
          prune: false
          selfHeal: false
        retry:
          backoff:
            duration: 5s
            factor: 2
            maxDuration: 10m
          limit: -1
        syncOptions:
        - CreateNamespace=true
        - ServerSideApply=true
---
# Source: gitops-bridge/templates/applicationsets.yaml
apiVersion: argoproj.io/v1alpha1
kind: ApplicationSet
metadata:
  name: cert-manager
  namespace: argocd
  annotations:
    helm.sh/chart: gitops-bridge-1.0.0
    argocd.argoproj.io/sync-wave: "-2"
  labels:
    helm.sh/chart: gitops-bridge-1.0.0
    app.kubernetes.io/name: gitops-bridge
    app.kubernetes.io/instance: my-release
    app.kubernetes.io/managed-by: Helm
    addon: "true"
spec:
  syncPolicy:
    preserveResourcesOnDeletion: true
  goTemplate: true
  goTemplateOptions:
  - missingkey=error
  generators:
          - clusters: # for reason this is need it as second in the matrix, if not the above extracting .tenants doesn't work
              selector:
                matchLabels:
                  argocd.argoproj.io/secret-type: cluster
                matchExpressions:
                - key: enable_cert_manager
                  operator: In
                  values:
                  - "true"


  template:
    metadata:
      name: addon-cert-manager-{{.nameNormalized}}
      annotations:
        argocd.argoproj.io/manifest-generate-paths: default/addons/cert-manager/values.yaml;environments/{{.metadata.labels.environment}}/addons/cert-manager/values.yaml;clusters/{{.nameNormalized}}/addons/cert-manager/values.yaml;
        helm.sh/chart: gitops-bridge-1.0.0
      labels:
        helm.sh/chart: gitops-bridge-1.0.0
        app.kubernetes.io/name: gitops-bridge
        app.kubernetes.io/instance: my-release
        app.kubernetes.io/managed-by: Helm
        addon: "true"
        component: 'cert-manager'
        environment: '{{.metadata.labels.environment}}'
        cluster: '{{.name}}'
    spec:
      project: default
      sources:
      - repoURL: '{{.metadata.annotations.addons_repo_url}}'
        targetRevision: '{{.metadata.annotations.addons_repo_revision}}'
        ref: values
      - repoURL: 'https://charts.jetstack.io'
        targetRevision: 'v1.15.2'
        chart: 'cert-manager'
        helm:
          releaseName: 'cert-manager'
          ignoreMissingValueFiles: true
          valueFiles:
            - '$values/default/addons/cert-manager/values.yaml'
            - '$values/default/addons/cert-manager/1.15/values.yaml'
            - '$values/environments/{{.metadata.labels.environment}}/addons/cert-manager/values.yaml'
            - '$values/environments/{{.metadata.labels.environment}}/addons/cert-manager/1.15/values.yaml'
            - '$values/clusters/{{.nameNormalized}}/addons/cert-manager/values.yaml'
            - '$values/clusters/{{.nameNormalized}}/addons/cert-manager/1.15/values.yaml'
          valuesObject:
            installCRDs: true
            serviceAccount:
              annotations:
                eks.amazonaws.com/role-arn: '{{ default "" (index .metadata.annotations "cert_manager_iam_role_arn")
                  }}'
              name: '{{ default "" (index .metadata.annotations "cert_manager_service_account")
                }}'
      destination:
        namespace: '{{ default "cert-manager" (index .metadata.annotations "cert-manager_namespace") }}'
        name: '{{.name}}'
      syncPolicy:
        automated:
          allowEmpty: true
          prune: false
          selfHeal: false
        retry:
          backoff:
            duration: 5s
            factor: 2
            maxDuration: 10m
          limit: -1
        syncOptions:
        - CreateNamespace=true
        - ServerSideApply=true
---
# Source: gitops-bridge/templates/applicationsets.yaml
apiVersion: argoproj.io/v1alpha1
kind: ApplicationSet
metadata:
  name: cluster-autoscaler
  namespace: argocd
  annotations:
    helm.sh/chart: gitops-bridge-1.0.0
  labels:
    helm.sh/chart: gitops-bridge-1.0.0
    app.kubernetes.io/name: gitops-bridge
    app.kubernetes.io/instance: my-release
    app.kubernetes.io/managed-by: Helm
    addon: "true"
spec:
  syncPolicy:
    preserveResourcesOnDeletion: true
  goTemplate: true
  goTemplateOptions:
  - missingkey=error
  generators:
          - clusters: # for reason this is need it as second in the matrix, if not the above extracting .tenants doesn't work
              selector:
                matchLabels:
                  argocd.argoproj.io/secret-type: cluster
                matchExpressions:
                - key: enable_cluster_autoscaler
                  operator: In
                  values:
                  - "true"


  template:
    metadata:
      name: addon-cluster-autoscaler-{{.nameNormalized}}
      annotations:
        argocd.argoproj.io/manifest-generate-paths: default/addons/cluster-autoscaler/values.yaml;environments/{{.metadata.labels.environment}}/addons/cluster-autoscaler/values.yaml;clusters/{{.nameNormalized}}/addons/cluster-autoscaler/values.yaml;
        helm.sh/chart: gitops-bridge-1.0.0
      labels:
        helm.sh/chart: gitops-bridge-1.0.0
        app.kubernetes.io/name: gitops-bridge
        app.kubernetes.io/instance: my-release
        app.kubernetes.io/managed-by: Helm
        addon: "true"
        component: 'cluster-autoscaler'
        environment: '{{.metadata.labels.environment}}'
        cluster: '{{.name}}'
    spec:
      project: default
      sources:
      - repoURL: '{{.metadata.annotations.addons_repo_url}}'
        targetRevision: '{{.metadata.annotations.addons_repo_revision}}'
        ref: values
      - repoURL: 'https://kubernetes.github.io/autoscaler'
        targetRevision: '9.37.0'
        chart: 'cluster-autoscaler'
        helm:
          releaseName: 'cluster-autoscaler'
          ignoreMissingValueFiles: true
          valueFiles:
            - '$values/default/addons/cluster-autoscaler/values.yaml'
            - '$values/default/addons/cluster-autoscaler/9.37/values.yaml'
            - '$values/environments/{{.metadata.labels.environment}}/addons/cluster-autoscaler/values.yaml'
            - '$values/environments/{{.metadata.labels.environment}}/addons/cluster-autoscaler/9.37/values.yaml'
            - '$values/clusters/{{.nameNormalized}}/addons/cluster-autoscaler/values.yaml'
            - '$values/clusters/{{.nameNormalized}}/addons/cluster-autoscaler/9.37/values.yaml'
          valuesObject:
            autoDiscovery:
              clusterName: '{{.metadata.annotations.aws_cluster_name}}'
            awsRegion: '{{.metadata.annotations.aws_region}}'
            image:
              tag: v{{.metada.labels.kubernetes_version}}.0
            rbac:
              serviceAccount:
                annotations:
                  eks.amazonaws.com/role-arn: '{{.metadata.annotations.cluster_autoscaler_iam_role_arn}}'
                name: '{{.metadata.annotations.cluster_autoscaler_service_account}}'
      destination:
        namespace: '{{ default "kube-system" (index .metadata.annotations "cluster_autoscaler_namespace") }}'
        name: '{{.name}}'
      syncPolicy:
        automated:
          allowEmpty: true
          prune: false
          selfHeal: false
        retry:
          backoff:
            duration: 5s
            factor: 2
            maxDuration: 10m
          limit: -1
        syncOptions:
        - CreateNamespace=true
        - ServerSideApply=true
---
# Source: gitops-bridge/templates/applicationsets.yaml
apiVersion: argoproj.io/v1alpha1
kind: ApplicationSet
metadata:
  name: cluster-proportional-autoscaler
  namespace: argocd
  annotations:
    helm.sh/chart: gitops-bridge-1.0.0
  labels:
    helm.sh/chart: gitops-bridge-1.0.0
    app.kubernetes.io/name: gitops-bridge
    app.kubernetes.io/instance: my-release
    app.kubernetes.io/managed-by: Helm
    addon: "true"
spec:
  syncPolicy:
    preserveResourcesOnDeletion: true
  goTemplate: true
  goTemplateOptions:
  - missingkey=error
  generators:
          - clusters: # for reason this is need it as second in the matrix, if not the above extracting .tenants doesn't work
              selector:
                matchLabels:
                  argocd.argoproj.io/secret-type: cluster
                matchExpressions:
                - key: enable_cluster_proportional_autoscaler
                  operator: In
                  values:
                  - "true"


  template:
    metadata:
      name: addon-cluster-proportional-autoscaler-{{.nameNormalized}}
      annotations:
        argocd.argoproj.io/manifest-generate-paths: default/addons/cluster-proportional-autoscaler/values.yaml;environments/{{.metadata.labels.environment}}/addons/cluster-proportional-autoscaler/values.yaml;clusters/{{.nameNormalized}}/addons/cluster-proportional-autoscaler/values.yaml;
        helm.sh/chart: gitops-bridge-1.0.0
      labels:
        helm.sh/chart: gitops-bridge-1.0.0
        app.kubernetes.io/name: gitops-bridge
        app.kubernetes.io/instance: my-release
        app.kubernetes.io/managed-by: Helm
        addon: "true"
        component: 'cluster-proportional-autoscaler'
        environment: '{{.metadata.labels.environment}}'
        cluster: '{{.name}}'
    spec:
      project: default
      sources:
      - repoURL: '{{.metadata.annotations.addons_repo_url}}'
        targetRevision: '{{.metadata.annotations.addons_repo_revision}}'
        ref: values
      - repoURL: 'https://kubernetes-sigs.github.io/cluster-proportional-autoscaler'
        targetRevision: '1.1.0'
        chart: 'cluster-proportional-autoscaler'
        helm:
          releaseName: 'cluster-proportional-autoscaler'
          ignoreMissingValueFiles: true
          valueFiles:
            - '$values/default/addons/cluster-proportional-autoscaler/values.yaml'
            - '$values/default/addons/cluster-proportional-autoscaler/1.1/values.yaml'
            - '$values/environments/{{.metadata.labels.environment}}/addons/cluster-proportional-autoscaler/values.yaml'
            - '$values/environments/{{.metadata.labels.environment}}/addons/cluster-proportional-autoscaler/1.1/values.yaml'
            - '$values/clusters/{{.nameNormalized}}/addons/cluster-proportional-autoscaler/values.yaml'
            - '$values/clusters/{{.nameNormalized}}/addons/cluster-proportional-autoscaler/1.1/values.yaml'
      destination:
        namespace: '{{ default "kube-system" (index .metadata.annotations "cluster_proportional_autoscaler_namespace")}}'
        name: '{{.name}}'
      syncPolicy:
        automated:
          allowEmpty: true
          prune: false
          selfHeal: false
        retry:
          backoff:
            duration: 5s
            factor: 2
            maxDuration: 10m
          limit: -1
        syncOptions:
        - CreateNamespace=true
        - ServerSideApply=true
---
# Source: gitops-bridge/templates/applicationsets.yaml
apiVersion: argoproj.io/v1alpha1
kind: ApplicationSet
metadata:
  name: cni-metrics-helper
  namespace: argocd
  annotations:
    helm.sh/chart: gitops-bridge-1.0.0
  labels:
    helm.sh/chart: gitops-bridge-1.0.0
    app.kubernetes.io/name: gitops-bridge
    app.kubernetes.io/instance: my-release
    app.kubernetes.io/managed-by: Helm
    addon: "true"
spec:
  syncPolicy:
    preserveResourcesOnDeletion: true
  goTemplate: true
  goTemplateOptions:
  - missingkey=error
  generators:
          - clusters: # for reason this is need it as second in the matrix, if not the above extracting .tenants doesn't work
              selector:
                matchLabels:
                  argocd.argoproj.io/secret-type: cluster
                matchExpressions:
                - key: enable_cni_metrics_helper
                  operator: In
                  values:
                  - "true"


  template:
    metadata:
      name: addon-cni-metrics-helper-{{.nameNormalized}}
      annotations:
        argocd.argoproj.io/manifest-generate-paths: default/addons/cni-metrics-helper/values.yaml;environments/{{.metadata.labels.environment}}/addons/cni-metrics-helper/values.yaml;clusters/{{.nameNormalized}}/addons/cni-metrics-helper/values.yaml;
        helm.sh/chart: gitops-bridge-1.0.0
      labels:
        helm.sh/chart: gitops-bridge-1.0.0
        app.kubernetes.io/name: gitops-bridge
        app.kubernetes.io/instance: my-release
        app.kubernetes.io/managed-by: Helm
        addon: "true"
        component: 'cni-metrics-helper'
        environment: '{{.metadata.labels.environment}}'
        cluster: '{{.name}}'
    spec:
      project: default
      sources:
      - repoURL: '{{.metadata.annotations.addons_repo_url}}'
        targetRevision: '{{.metadata.annotations.addons_repo_revision}}'
        ref: values
      - repoURL: 'https://aws.github.io/eks-charts'
        targetRevision: '1.19.2'
        chart: 'cni-metrics-helper'
        helm:
          releaseName: 'cni-metrics-helper'
          ignoreMissingValueFiles: true
          valueFiles:
            - '$values/default/addons/cni-metrics-helper/values.yaml'
            - '$values/default/addons/cni-metrics-helper/1.19/values.yaml'
            - '$values/environments/{{.metadata.labels.environment}}/addons/cni-metrics-helper/values.yaml'
            - '$values/environments/{{.metadata.labels.environment}}/addons/cni-metrics-helper/1.19/values.yaml'
            - '$values/clusters/{{.nameNormalized}}/addons/cni-metrics-helper/values.yaml'
            - '$values/clusters/{{.nameNormalized}}/addons/cni-metrics-helper/1.19/values.yaml'
          valuesObject:
            env:
              AWS_CLUSTER_ID: '{{.metadata.annotations.aws_cluster_name}}'
      destination:
        namespace: '{{ default "kube-system" (index .metadata.annotations "cni_metrics_helper_namespace")}}'
        name: '{{.name}}'
      syncPolicy:
        automated:
          allowEmpty: true
          prune: false
          selfHeal: false
        retry:
          backoff:
            duration: 5s
            factor: 2
            maxDuration: 10m
          limit: -1
        syncOptions:
        - CreateNamespace=true
        - ServerSideApply=true
---
# Source: gitops-bridge/templates/applicationsets.yaml
apiVersion: argoproj.io/v1alpha1
kind: ApplicationSet
metadata:
  name: crossplane
  namespace: argocd
  annotations:
    helm.sh/chart: gitops-bridge-1.0.0
  labels:
    helm.sh/chart: gitops-bridge-1.0.0
    app.kubernetes.io/name: gitops-bridge
    app.kubernetes.io/instance: my-release
    app.kubernetes.io/managed-by: Helm
    addon: "true"
spec:
  syncPolicy:
    preserveResourcesOnDeletion: true
  goTemplate: true
  goTemplateOptions:
  - missingkey=error
  generators:
          - clusters: # for reason this is need it as second in the matrix, if not the above extracting .tenants doesn't work
              selector:
                matchLabels:
                  argocd.argoproj.io/secret-type: cluster
                matchExpressions:
                - key: enable_crossplane
                  operator: In
                  values:
                  - "true"


  template:
    metadata:
      name: addon-crossplane-{{.nameNormalized}}
      annotations:
        argocd.argoproj.io/manifest-generate-paths: default/addons/crossplane/values.yaml;environments/{{.metadata.labels.environment}}/addons/crossplane/values.yaml;clusters/{{.nameNormalized}}/addons/crossplane/values.yaml;
        helm.sh/chart: gitops-bridge-1.0.0
      labels:
        helm.sh/chart: gitops-bridge-1.0.0
        app.kubernetes.io/name: gitops-bridge
        app.kubernetes.io/instance: my-release
        app.kubernetes.io/managed-by: Helm
        addon: "true"
        component: 'crossplane'
        environment: '{{.metadata.labels.environment}}'
        cluster: '{{.name}}'
    spec:
      project: default
      sources:
      - repoURL: '{{.metadata.annotations.addons_repo_url}}'
        targetRevision: '{{.metadata.annotations.addons_repo_revision}}'
        ref: values
      - repoURL: 'https://crossplane.github.io/charts'
        targetRevision: '1.16.0'
        chart: 'crossplane'
        helm:
          releaseName: 'crossplane'
          ignoreMissingValueFiles: true
          valueFiles:
            - '$values/default/addons/crossplane/values.yaml'
            - '$values/default/addons/crossplane/1.16/values.yaml'
            - '$values/environments/{{.metadata.labels.environment}}/addons/crossplane/values.yaml'
            - '$values/environments/{{.metadata.labels.environment}}/addons/crossplane/1.16/values.yaml'
            - '$values/clusters/{{.nameNormalized}}/addons/crossplane/values.yaml'
            - '$values/clusters/{{.nameNormalized}}/addons/crossplane/1.16/values.yaml'
      destination:
        namespace: '{{ default "crossplane-system" (index .metadata.annotations "crossplane_namespace")}}'
        name: '{{.name}}'
      syncPolicy:
        automated:
          allowEmpty: true
          prune: false
          selfHeal: false
        retry:
          backoff:
            duration: 5s
            factor: 2
            maxDuration: 10m
          limit: -1
        syncOptions:
        - CreateNamespace=true
        - ServerSideApply=true
      ignoreDifferences:
        - group: apps
          jqPathExpressions:
          - .spec.template.spec.containers[].env[].valueFrom.resourceFieldRef.divisor
          - .spec.template.spec.initContainers[].env[].valueFrom.resourceFieldRef.divisor
          kind: Deployment
---
# Source: gitops-bridge/templates/applicationsets.yaml
apiVersion: argoproj.io/v1alpha1
kind: ApplicationSet
metadata:
  name: crossplane-helm-provider
  namespace: argocd
  annotations:
    helm.sh/chart: gitops-bridge-1.0.0
  labels:
    helm.sh/chart: gitops-bridge-1.0.0
    app.kubernetes.io/name: gitops-bridge
    app.kubernetes.io/instance: my-release
    app.kubernetes.io/managed-by: Helm
    addon: "true"
spec:
  syncPolicy:
    preserveResourcesOnDeletion: true
  goTemplate: true
  goTemplateOptions:
  - missingkey=error
  generators:
          - clusters: # for reason this is need it as second in the matrix, if not the above extracting .tenants doesn't work
              selector:
                matchLabels:
                  argocd.argoproj.io/secret-type: cluster
                matchExpressions:
                - key: enable_crossplane_helm_provider
                  operator: In
                  values:
                  - "true"


  template:
    metadata:
      name: addon-crossplane-helm-provider-{{.nameNormalized}}
      annotations:
        argocd.argoproj.io/manifest-generate-paths: default/addons/crossplane-helm-provider/values.yaml;environments/{{.metadata.labels.environment}}/addons/crossplane-helm-provider/values.yaml;clusters/{{.nameNormalized}}/addons/crossplane-helm-provider/values.yaml;
        helm.sh/chart: gitops-bridge-1.0.0
      labels:
        helm.sh/chart: gitops-bridge-1.0.0
        app.kubernetes.io/name: gitops-bridge
        app.kubernetes.io/instance: my-release
        app.kubernetes.io/managed-by: Helm
        addon: "true"
        component: 'crossplane-helm-provider'
        environment: '{{.metadata.labels.environment}}'
        cluster: '{{.name}}'
    spec:
      project: default
      sources:
      - repoURL: '{{.metadata.annotations.addons_repo_url}}'
        targetRevision: '{{.metadata.annotations.addons_repo_revision}}'
        ref: values
      - repoURL: 'https://gitops-bridge-dev.github.io/gitops-bridge-helm-charts'
        targetRevision: '1.1.0'
        chart: 'crossplane-helm'
        helm:
          releaseName: 'crossplane-helm'
          ignoreMissingValueFiles: true
          valueFiles:
            - '$values/default/addons/crossplane-helm-provider/values.yaml'
            - '$values/default/addons/crossplane-helm-provider/1.1/values.yaml'
            - '$values/environments/{{.metadata.labels.environment}}/addons/crossplane-helm-provider/values.yaml'
            - '$values/environments/{{.metadata.labels.environment}}/addons/crossplane-helm-provider/1.1/values.yaml'
            - '$values/clusters/{{.nameNormalized}}/addons/crossplane-helm-provider/values.yaml'
            - '$values/clusters/{{.nameNormalized}}/addons/crossplane-helm-provider/1.1/values.yaml'
      destination:
        namespace: '{{ default "crossplane-system" (index .metadata.annotations "crossplane_helm_namespace")}}'
        name: '{{.name}}'
      syncPolicy:
        automated:
          allowEmpty: true
          prune: false
          selfHeal: false
        retry:
          backoff:
            duration: 5s
            factor: 2
            maxDuration: 10m
          limit: -1
        syncOptions:
        - CreateNamespace=true
        - ServerSideApply=true
---
# Source: gitops-bridge/templates/applicationsets.yaml
apiVersion: argoproj.io/v1alpha1
kind: ApplicationSet
metadata:
  name: crossplane-kubernetes-provider
  namespace: argocd
  annotations:
    helm.sh/chart: gitops-bridge-1.0.0
  labels:
    helm.sh/chart: gitops-bridge-1.0.0
    app.kubernetes.io/name: gitops-bridge
    app.kubernetes.io/instance: my-release
    app.kubernetes.io/managed-by: Helm
    addon: "true"
spec:
  syncPolicy:
    preserveResourcesOnDeletion: true
  goTemplate: true
  goTemplateOptions:
  - missingkey=error
  generators:
          - clusters: # for reason this is need it as second in the matrix, if not the above extracting .tenants doesn't work
              selector:
                matchLabels:
                  argocd.argoproj.io/secret-type: cluster
                matchExpressions:
                - key: enable_crossplane_kubernetes_provider
                  operator: In
                  values:
                  - "true"


  template:
    metadata:
      name: addon-crossplane-kubernetes-provider-{{.nameNormalized}}
      annotations:
        argocd.argoproj.io/manifest-generate-paths: default/addons/crossplane-kubernetes-provider/values.yaml;environments/{{.metadata.labels.environment}}/addons/crossplane-kubernetes-provider/values.yaml;clusters/{{.nameNormalized}}/addons/crossplane-kubernetes-provider/values.yaml;
        helm.sh/chart: gitops-bridge-1.0.0
      labels:
        helm.sh/chart: gitops-bridge-1.0.0
        app.kubernetes.io/name: gitops-bridge
        app.kubernetes.io/instance: my-release
        app.kubernetes.io/managed-by: Helm
        addon: "true"
        component: 'crossplane-kubernetes-provider'
        environment: '{{.metadata.labels.environment}}'
        cluster: '{{.name}}'
    spec:
      project: default
      sources:
      - repoURL: '{{.metadata.annotations.addons_repo_url}}'
        targetRevision: '{{.metadata.annotations.addons_repo_revision}}'
        ref: values
      - repoURL: 'https://gitops-bridge-dev.github.io/gitops-bridge-helm-charts'
        targetRevision: '1.2.0'
        chart: 'crossplane-kubernetes'
        helm:
          releaseName: 'crossplane-kubernetes'
          ignoreMissingValueFiles: true
          valueFiles:
            - '$values/default/addons/crossplane-kubernetes-provider/values.yaml'
            - '$values/default/addons/crossplane-kubernetes-provider/1.2/values.yaml'
            - '$values/environments/{{.metadata.labels.environment}}/addons/crossplane-kubernetes-provider/values.yaml'
            - '$values/environments/{{.metadata.labels.environment}}/addons/crossplane-kubernetes-provider/1.2/values.yaml'
            - '$values/clusters/{{.nameNormalized}}/addons/crossplane-kubernetes-provider/values.yaml'
            - '$values/clusters/{{.nameNormalized}}/addons/crossplane-kubernetes-provider/1.2/values.yaml'
      destination:
        namespace: '{{ default "crossplane-system" (index .metadata.annotations "crossplane_kubernetes_namespace")}}'
        name: '{{.name}}'
      syncPolicy:
        automated:
          allowEmpty: true
          prune: false
          selfHeal: false
        retry:
          backoff:
            duration: 5s
            factor: 2
            maxDuration: 10m
          limit: -1
        syncOptions:
        - CreateNamespace=true
        - ServerSideApply=true
---
# Source: gitops-bridge/templates/applicationsets.yaml
apiVersion: argoproj.io/v1alpha1
kind: ApplicationSet
metadata:
  name: cw-prometheus
  namespace: argocd
  annotations:
    helm.sh/chart: gitops-bridge-1.0.0
  labels:
    helm.sh/chart: gitops-bridge-1.0.0
    app.kubernetes.io/name: gitops-bridge
    app.kubernetes.io/instance: my-release
    app.kubernetes.io/managed-by: Helm
    addon: "true"
spec:
  syncPolicy:
    preserveResourcesOnDeletion: true
  goTemplate: true
  goTemplateOptions:
  - missingkey=error
  generators:
          - clusters: # for reason this is need it as second in the matrix, if not the above extracting .tenants doesn't work
              selector:
                matchLabels:
                  argocd.argoproj.io/secret-type: cluster
                matchExpressions:
                - key: enable_cw_prometheus
                  operator: In
                  values:
                  - "true"


  template:
    metadata:
      name: addon-cw-prometheus-{{.nameNormalized}}
      annotations:
        argocd.argoproj.io/manifest-generate-paths: default/addons/cw-prometheus/values.yaml;environments/{{.metadata.labels.environment}}/addons/cw-prometheus/values.yaml;clusters/{{.nameNormalized}}/addons/cw-prometheus/values.yaml;
        helm.sh/chart: gitops-bridge-1.0.0
      labels:
        helm.sh/chart: gitops-bridge-1.0.0
        app.kubernetes.io/name: gitops-bridge
        app.kubernetes.io/instance: my-release
        app.kubernetes.io/managed-by: Helm
        addon: "true"
        component: 'cw-prometheus'
        environment: '{{.metadata.labels.environment}}'
        cluster: '{{.name}}'
    spec:
      project: default
      sources:
      - repoURL: '{{.metadata.annotations.addons_repo_url}}'
        targetRevision: '{{.metadata.annotations.addons_repo_revision}}'
        ref: values
      - repoURL: '{{.metadata.annotations.addons_repo_url}}'
        targetRevision: '{{.metadata.annotations.addons_repo_revision}}'
        path: '{{.metadata.annotations.addons_repo_basepath}}charts/cw-prometheus'
        helm:
          releaseName: ''
          ignoreMissingValueFiles: true
          valueFiles:
            - '$values/default/addons/cw-prometheus/values.yaml'
            - '$values/default/addons/cw-prometheus/{{.metadata.annotations.addons_repo_revision}}/values.yaml'
            - '$values/environments/{{.metadata.labels.environment}}/addons/cw-prometheus/values.yaml'
            - '$values/environments/{{.metadata.labels.environment}}/addons/cw-prometheus/{{.metadata.annotations.addons_repo_revision}}/values.yaml'
            - '$values/clusters/{{.nameNormalized}}/addons/cw-prometheus/values.yaml'
            - '$values/clusters/{{.nameNormalized}}/addons/cw-prometheus/{{.metadata.annotations.addons_repo_revision}}/values.yaml'
      destination:
        namespace: '{{ default "amazon-cloudwatch" (index .metadata.annotations "cw_prometheus_namespace")}}'
        name: '{{.name}}'
      syncPolicy:
        automated:
          allowEmpty: true
          prune: false
          selfHeal: false
        retry:
          backoff:
            duration: 5s
            factor: 2
            maxDuration: 10m
          limit: -1
        syncOptions:
        - CreateNamespace=true
        - ServerSideApply=true
---
# Source: gitops-bridge/templates/applicationsets.yaml
apiVersion: argoproj.io/v1alpha1
kind: ApplicationSet
metadata:
  name: eks-upgrade-insights-demo
  namespace: argocd
  annotations:
    helm.sh/chart: gitops-bridge-1.0.0
  labels:
    helm.sh/chart: gitops-bridge-1.0.0
    app.kubernetes.io/name: gitops-bridge
    app.kubernetes.io/instance: my-release
    app.kubernetes.io/managed-by: Helm
    addon: "true"
spec:
  syncPolicy:
    preserveResourcesOnDeletion: true
  goTemplate: true
  goTemplateOptions:
  - missingkey=error
  generators:
          - clusters: # for reason this is need it as second in the matrix, if not the above extracting .tenants doesn't work
              selector:
                matchLabels:
                  argocd.argoproj.io/secret-type: cluster
                matchExpressions:
                - key: enable_eks_upgrade_insights_demo
                  operator: In
                  values:
                  - "true"


  template:
    metadata:
      name: addon-eks-upgrade-insights-demo-{{.nameNormalized}}
      annotations:
        argocd.argoproj.io/manifest-generate-paths: default/addons/eks-upgrade-insights-demo/values.yaml;environments/{{.metadata.labels.environment}}/addons/eks-upgrade-insights-demo/values.yaml;clusters/{{.nameNormalized}}/addons/eks-upgrade-insights-demo/values.yaml;
        helm.sh/chart: gitops-bridge-1.0.0
      labels:
        helm.sh/chart: gitops-bridge-1.0.0
        app.kubernetes.io/name: gitops-bridge
        app.kubernetes.io/instance: my-release
        app.kubernetes.io/managed-by: Helm
        addon: "true"
        component: 'eks-upgrade-insights-demo'
        environment: '{{.metadata.labels.environment}}'
        cluster: '{{.name}}'
    spec:
      project: default
      sources:
      - repoURL: '{{.metadata.annotations.addons_repo_url}}'
        targetRevision: '{{.metadata.annotations.addons_repo_revision}}'
        ref: values
      - repoURL: '{{.metadata.annotations.addons_repo_url}}'
        targetRevision: '{{.metadata.annotations.addons_repo_revision}}'
        path: '{{.metadata.annotations.addons_repo_basepath}}charts/eks-upgrade-insights-demo'
        helm:
          releaseName: 'eks-upgrade-insights-demo'
          ignoreMissingValueFiles: true
          valueFiles:
            - '$values/default/addons/eks-upgrade-insights-demo/values.yaml'
            - '$values/default/addons/eks-upgrade-insights-demo/{{.metadata.annotations.addons_repo_revision}}/values.yaml'
            - '$values/environments/{{.metadata.labels.environment}}/addons/eks-upgrade-insights-demo/values.yaml'
            - '$values/environments/{{.metadata.labels.environment}}/addons/eks-upgrade-insights-demo/{{.metadata.annotations.addons_repo_revision}}/values.yaml'
            - '$values/clusters/{{.nameNormalized}}/addons/eks-upgrade-insights-demo/values.yaml'
            - '$values/clusters/{{.nameNormalized}}/addons/eks-upgrade-insights-demo/{{.metadata.annotations.addons_repo_revision}}/values.yaml'
      destination:
        namespace: 'argocd'
        name: '{{.name}}'
      syncPolicy:
        automated:
          allowEmpty: true
          prune: false
          selfHeal: false
        retry:
          backoff:
            duration: 5s
            factor: 2
            maxDuration: 10m
          limit: -1
        syncOptions:
        - CreateNamespace=true
        - ServerSideApply=true
---
# Source: gitops-bridge/templates/applicationsets.yaml
apiVersion: argoproj.io/v1alpha1
kind: ApplicationSet
metadata:
  name: enable-aws-fsx-csi-driver
  namespace: argocd
  annotations:
    helm.sh/chart: gitops-bridge-1.0.0
  labels:
    helm.sh/chart: gitops-bridge-1.0.0
    app.kubernetes.io/name: gitops-bridge
    app.kubernetes.io/instance: my-release
    app.kubernetes.io/managed-by: Helm
    addon: "true"
spec:
  syncPolicy:
    preserveResourcesOnDeletion: true
  goTemplate: true
  goTemplateOptions:
  - missingkey=error
  generators:
          - clusters: # for reason this is need it as second in the matrix, if not the above extracting .tenants doesn't work
              selector:
                matchLabels:
                  argocd.argoproj.io/secret-type: cluster
                matchExpressions:
                - key: enable_aws_fsx_csi_driver
                  operator: In
                  values:
                  - "true"


  template:
    metadata:
      name: addon-enable-aws-fsx-csi-driver-{{.nameNormalized}}
      annotations:
        argocd.argoproj.io/manifest-generate-paths: default/addons/enable-aws-fsx-csi-driver/values.yaml;environments/{{.metadata.labels.environment}}/addons/enable-aws-fsx-csi-driver/values.yaml;clusters/{{.nameNormalized}}/addons/enable-aws-fsx-csi-driver/values.yaml;
        helm.sh/chart: gitops-bridge-1.0.0
      labels:
        helm.sh/chart: gitops-bridge-1.0.0
        app.kubernetes.io/name: gitops-bridge
        app.kubernetes.io/instance: my-release
        app.kubernetes.io/managed-by: Helm
        addon: "true"
        component: 'enable-aws-fsx-csi-driver'
        environment: '{{.metadata.labels.environment}}'
        cluster: '{{.name}}'
    spec:
      project: default
      sources:
      - repoURL: '{{.metadata.annotations.addons_repo_url}}'
        targetRevision: '{{.metadata.annotations.addons_repo_revision}}'
        ref: values
      - repoURL: 'https://kubernetes-sigs.github.io/aws-fsx-csi-driver'
        targetRevision: '1.9.0'
        chart: 'aws-fsx-csi-driver'
        helm:
          releaseName: 'aws-fsx-csi-driver'
          ignoreMissingValueFiles: true
          valueFiles:
            - '$values/default/addons/enable-aws-fsx-csi-driver/values.yaml'
            - '$values/default/addons/enable-aws-fsx-csi-driver/1.9/values.yaml'
            - '$values/environments/{{.metadata.labels.environment}}/addons/enable-aws-fsx-csi-driver/values.yaml'
            - '$values/environments/{{.metadata.labels.environment}}/addons/enable-aws-fsx-csi-driver/1.9/values.yaml'
            - '$values/clusters/{{.nameNormalized}}/addons/enable-aws-fsx-csi-driver/values.yaml'
            - '$values/clusters/{{.nameNormalized}}/addons/enable-aws-fsx-csi-driver/1.9/values.yaml'
          valuesObject:
            controller:
              serviceAccount:
                annotations:
                  eks.amazonaws.com/role-arn: '{{.metadata.annotations.aws_fsx_csi_driver_iam_role_arn}}'
                name: '{{.metadata.annotations.aws_fsx_csi_driver_controller_service_account}}'
            node:
              serviceAccount:
                annotations:
                  eks.amazonaws.com/role-arn: '{{.metadata.annotations.aws_fsx_csi_driver_iam_role_arn}}'
                name: '{{.metadata.annotations.aws_fsx_csi_driver_node_service_account}}'
      destination:
        namespace: '{{ default "kube-system" (index .metadata.annotations "aws_fsx_csi_driver_namespace") }}'
        name: '{{.name}}'
      syncPolicy:
        automated:
          allowEmpty: true
          prune: false
          selfHeal: false
        retry:
          backoff:
            duration: 5s
            factor: 2
            maxDuration: 10m
          limit: -1
        syncOptions:
        - CreateNamespace=true
        - ServerSideApply=true
---
# Source: gitops-bridge/templates/applicationsets.yaml
apiVersion: argoproj.io/v1alpha1
kind: ApplicationSet
metadata:
  name: external-dns
  namespace: argocd
  annotations:
    helm.sh/chart: gitops-bridge-1.0.0
  labels:
    helm.sh/chart: gitops-bridge-1.0.0
    app.kubernetes.io/name: gitops-bridge
    app.kubernetes.io/instance: my-release
    app.kubernetes.io/managed-by: Helm
    addon: "true"
spec:
  syncPolicy:
    preserveResourcesOnDeletion: true
  goTemplate: true
  goTemplateOptions:
  - missingkey=error
  generators:
          - clusters: # for reason this is need it as second in the matrix, if not the above extracting .tenants doesn't work
              selector:
                matchLabels:
                  argocd.argoproj.io/secret-type: cluster
                matchExpressions:
                - key: enable_external_dns
                  operator: In
                  values:
                  - "true"


  template:
    metadata:
      name: addon-external-dns-{{.nameNormalized}}
      annotations:
        argocd.argoproj.io/manifest-generate-paths: default/addons/external-dns/values.yaml;environments/{{.metadata.labels.environment}}/addons/external-dns/values.yaml;clusters/{{.nameNormalized}}/addons/external-dns/values.yaml;
        helm.sh/chart: gitops-bridge-1.0.0
      labels:
        helm.sh/chart: gitops-bridge-1.0.0
        app.kubernetes.io/name: gitops-bridge
        app.kubernetes.io/instance: my-release
        app.kubernetes.io/managed-by: Helm
        addon: "true"
        component: 'external-dns'
        environment: '{{.metadata.labels.environment}}'
        cluster: '{{.name}}'
    spec:
      project: default
      sources:
      - repoURL: '{{.metadata.annotations.addons_repo_url}}'
        targetRevision: '{{.metadata.annotations.addons_repo_revision}}'
        ref: values
      - repoURL: 'https://kubernetes-sigs.github.io/external-dns'
        targetRevision: '1.14.5'
        chart: 'external-dns'
        helm:
          releaseName: 'external-dns'
          ignoreMissingValueFiles: true
          valueFiles:
            - '$values/default/addons/external-dns/values.yaml'
            - '$values/default/addons/external-dns/1.14/values.yaml'
            - '$values/environments/{{.metadata.labels.environment}}/addons/external-dns/values.yaml'
            - '$values/environments/{{.metadata.labels.environment}}/addons/external-dns/1.14/values.yaml'
            - '$values/clusters/{{.nameNormalized}}/addons/external-dns/values.yaml'
            - '$values/clusters/{{.nameNormalized}}/addons/external-dns/1.14/values.yaml'
          valuesObject:
            domainFilters:
            - '{{.metadata.annotations.external_dns_domain_filters}}'
            policy: '{{ default "upsert-only" (index .metadata.annotations "external_dns_policy")}}'
            provider: aws
            serviceAccount:
              annotations:
                eks.amazonaws.com/role-arn: '{{.metadata.annotations.external_dns_iam_role_arn}}'
              name: '{{.metadata.annotations.external_dns_service_account}}'
            txtOwnerId: '{{.metadata.annotations.aws_cluster_name}}'
      destination:
        namespace: '{{ default "kube-system" (index .metadata.annotations "external_dns_namespace") }}'
        name: '{{.name}}'
      syncPolicy:
        automated:
          allowEmpty: true
          prune: false
          selfHeal: false
        retry:
          backoff:
            duration: 5s
            factor: 2
            maxDuration: 10m
          limit: -1
        syncOptions:
        - CreateNamespace=true
        - ServerSideApply=true
---
# Source: gitops-bridge/templates/applicationsets.yaml
apiVersion: argoproj.io/v1alpha1
kind: ApplicationSet
metadata:
  name: external-secrets
  namespace: argocd
  annotations:
    helm.sh/chart: gitops-bridge-1.0.0
  labels:
    helm.sh/chart: gitops-bridge-1.0.0
    app.kubernetes.io/name: gitops-bridge
    app.kubernetes.io/instance: my-release
    app.kubernetes.io/managed-by: Helm
    addon: "true"
spec:
  syncPolicy:
    preserveResourcesOnDeletion: true
  goTemplate: true
  goTemplateOptions:
  - missingkey=error
  generators:
          - clusters: # for reason this is need it as second in the matrix, if not the above extracting .tenants doesn't work
              selector:
                matchLabels:
                  argocd.argoproj.io/secret-type: cluster
                matchExpressions:
                - key: enable_external_secrets
                  operator: In
                  values:
                  - "true"


  template:
    metadata:
      name: addon-external-secrets-{{.nameNormalized}}
      annotations:
        argocd.argoproj.io/manifest-generate-paths: default/addons/external-secrets/values.yaml;environments/{{.metadata.labels.environment}}/addons/external-secrets/values.yaml;clusters/{{.nameNormalized}}/addons/external-secrets/values.yaml;
        helm.sh/chart: gitops-bridge-1.0.0
      labels:
        helm.sh/chart: gitops-bridge-1.0.0
        app.kubernetes.io/name: gitops-bridge
        app.kubernetes.io/instance: my-release
        app.kubernetes.io/managed-by: Helm
        addon: "true"
        component: 'external-secrets'
        environment: '{{.metadata.labels.environment}}'
        cluster: '{{.name}}'
    spec:
      project: default
      sources:
      - repoURL: '{{.metadata.annotations.addons_repo_url}}'
        targetRevision: '{{.metadata.annotations.addons_repo_revision}}'
        ref: values
      - repoURL: 'https://charts.external-secrets.io'
        targetRevision: '0.10.0'
        chart: 'external-secrets'
        helm:
          releaseName: 'external-secrets'
          ignoreMissingValueFiles: true
          valueFiles:
            - '$values/default/addons/external-secrets/values.yaml'
            - '$values/default/addons/external-secrets/0.10/values.yaml'
            - '$values/environments/{{.metadata.labels.environment}}/addons/external-secrets/values.yaml'
            - '$values/environments/{{.metadata.labels.environment}}/addons/external-secrets/0.10/values.yaml'
            - '$values/clusters/{{.nameNormalized}}/addons/external-secrets/values.yaml'
            - '$values/clusters/{{.nameNormalized}}/addons/external-secrets/0.10/values.yaml'
          valuesObject:
            serviceAccount:
              annotations:
                eks.amazonaws.com/role-arn: '{{default "" (index .metadata.annotations "external_secrets_iam_role_arn")}}'
              name: '{{.metadata.annotations.external_secrets_service_account}}'
      destination:
        namespace: '{{ default "kube-system" (index .metadata.annotations "external_secrets_namespace") }}'
        name: '{{.name}}'
      syncPolicy:
        automated:
          allowEmpty: true
          prune: false
          selfHeal: false
        retry:
          backoff:
            duration: 5s
            factor: 2
            maxDuration: 10m
          limit: -1
        syncOptions:
        - CreateNamespace=true
        - ServerSideApply=true
---
# Source: gitops-bridge/templates/applicationsets.yaml
apiVersion: argoproj.io/v1alpha1
kind: ApplicationSet
metadata:
  name: gatekeeper
  namespace: argocd
  annotations:
    helm.sh/chart: gitops-bridge-1.0.0
  labels:
    helm.sh/chart: gitops-bridge-1.0.0
    app.kubernetes.io/name: gitops-bridge
    app.kubernetes.io/instance: my-release
    app.kubernetes.io/managed-by: Helm
    addon: "true"
spec:
  syncPolicy:
    preserveResourcesOnDeletion: true
  goTemplate: true
  goTemplateOptions:
  - missingkey=error
  generators:
          - clusters: # for reason this is need it as second in the matrix, if not the above extracting .tenants doesn't work
              selector:
                matchLabels:
                  argocd.argoproj.io/secret-type: cluster
                matchExpressions:
                - key: enable_gatekeeper
                  operator: In
                  values:
                  - "true"


  template:
    metadata:
      name: addon-gatekeeper-{{.nameNormalized}}
      annotations:
        argocd.argoproj.io/manifest-generate-paths: default/addons/gatekeeper/values.yaml;environments/{{.metadata.labels.environment}}/addons/gatekeeper/values.yaml;clusters/{{.nameNormalized}}/addons/gatekeeper/values.yaml;
        helm.sh/chart: gitops-bridge-1.0.0
      labels:
        helm.sh/chart: gitops-bridge-1.0.0
        app.kubernetes.io/name: gitops-bridge
        app.kubernetes.io/instance: my-release
        app.kubernetes.io/managed-by: Helm
        addon: "true"
        component: 'gatekeeper'
        environment: '{{.metadata.labels.environment}}'
        cluster: '{{.name}}'
    spec:
      project: default
      sources:
      - repoURL: '{{.metadata.annotations.addons_repo_url}}'
        targetRevision: '{{.metadata.annotations.addons_repo_revision}}'
        ref: values
      - repoURL: 'https://open-policy-agent.github.io/gatekeeper/charts'
        targetRevision: '3.16.3'
        chart: 'gatekeeper'
        helm:
          releaseName: 'gatekeeper'
          ignoreMissingValueFiles: true
          valueFiles:
            - '$values/default/addons/gatekeeper/values.yaml'
            - '$values/default/addons/gatekeeper/3.16/values.yaml'
            - '$values/environments/{{.metadata.labels.environment}}/addons/gatekeeper/values.yaml'
            - '$values/environments/{{.metadata.labels.environment}}/addons/gatekeeper/3.16/values.yaml'
            - '$values/clusters/{{.nameNormalized}}/addons/gatekeeper/values.yaml'
            - '$values/clusters/{{.nameNormalized}}/addons/gatekeeper/3.16/values.yaml'
      - repoURL: '{{.metadata.annotations.addons_repo_url}}'
        targetRevision: '{{.metadata.annotations.addons_repo_revision}}'
        path: '{{.metadata.annotations.addons_repo_basepath}}charts/resources/gatekeeper'
        helm:
          releaseName: 'gatekeeper'
          ignoreMissingValueFiles: true
          valueFiles:
            - '$values/default/addons/gatekeeper/resources/values.yaml'
            - '$values/default/addons/gatekeeper/3.16/resources/values.yaml'
            - '$values/environments/{{.metadata.labels.environment}}/addons/gatekeeper/resources/values.yaml'
            - '$values/environments/{{.metadata.labels.environment}}/addons/gatekeeper/3.16/resources/values.yaml'
            - '$values/clusters/{{.nameNormalized}}/addons/gatekeeper/resources/values.yaml'
            - '$values/clusters/{{.nameNormalized}}/addons/gatekeeper/3.16/resources/values.yaml'
          valuesObject:
            environment: '{{.metadata.labels.environment}}'
      destination:
        namespace: 'gatekeeper-system'
        name: '{{.name}}'
      syncPolicy:
        automated:
          allowEmpty: true
          prune: false
          selfHeal: false
        retry:
          backoff:
            duration: 5s
            factor: 2
            maxDuration: 10m
          limit: -1
        syncOptions:
        - CreateNamespace=true
        - ServerSideApply=true
---
# Source: gitops-bridge/templates/applicationsets.yaml
apiVersion: argoproj.io/v1alpha1
kind: ApplicationSet
metadata:
  name: gpu-operator
  namespace: argocd
  annotations:
    helm.sh/chart: gitops-bridge-1.0.0
  labels:
    helm.sh/chart: gitops-bridge-1.0.0
    app.kubernetes.io/name: gitops-bridge
    app.kubernetes.io/instance: my-release
    app.kubernetes.io/managed-by: Helm
    addon: "true"
spec:
  syncPolicy:
    preserveResourcesOnDeletion: true
  goTemplate: true
  goTemplateOptions:
  - missingkey=error
  generators:
          - clusters: # for reason this is need it as second in the matrix, if not the above extracting .tenants doesn't work
              selector:
                matchLabels:
                  argocd.argoproj.io/secret-type: cluster
                matchExpressions:
                - key: enable_gpu_operator
                  operator: In
                  values:
                  - "true"


  template:
    metadata:
      name: addon-gpu-operator-{{.nameNormalized}}
      annotations:
        argocd.argoproj.io/manifest-generate-paths: default/addons/gpu-operator/values.yaml;environments/{{.metadata.labels.environment}}/addons/gpu-operator/values.yaml;clusters/{{.nameNormalized}}/addons/gpu-operator/values.yaml;
        helm.sh/chart: gitops-bridge-1.0.0
      labels:
        helm.sh/chart: gitops-bridge-1.0.0
        app.kubernetes.io/name: gitops-bridge
        app.kubernetes.io/instance: my-release
        app.kubernetes.io/managed-by: Helm
        addon: "true"
        component: 'gpu-operator'
        environment: '{{.metadata.labels.environment}}'
        cluster: '{{.name}}'
    spec:
      project: default
      sources:
      - repoURL: '{{.metadata.annotations.addons_repo_url}}'
        targetRevision: '{{.metadata.annotations.addons_repo_revision}}'
        ref: values
      - repoURL: 'https://nvidia.github.io/gpu-operator'
        targetRevision: 'v24.6.0'
        chart: 'gpu-operator'
        helm:
          releaseName: 'gpu-operator'
          ignoreMissingValueFiles: true
          valueFiles:
            - '$values/default/addons/gpu-operator/values.yaml'
            - '$values/default/addons/gpu-operator/24.6/values.yaml'
            - '$values/environments/{{.metadata.labels.environment}}/addons/gpu-operator/values.yaml'
            - '$values/environments/{{.metadata.labels.environment}}/addons/gpu-operator/24.6/values.yaml'
            - '$values/clusters/{{.nameNormalized}}/addons/gpu-operator/values.yaml'
            - '$values/clusters/{{.nameNormalized}}/addons/gpu-operator/24.6/values.yaml'
      destination:
        namespace: '{{ default "gpu-operator" (index .metadata.annotations "gpu_operator_namespace")}}'
        name: '{{.name}}'
      syncPolicy:
        automated:
          allowEmpty: true
          prune: false
          selfHeal: false
        retry:
          backoff:
            duration: 5s
            factor: 2
            maxDuration: 10m
          limit: -1
        syncOptions:
        - CreateNamespace=true
        - ServerSideApply=true
---
# Source: gitops-bridge/templates/applicationsets.yaml
apiVersion: argoproj.io/v1alpha1
kind: ApplicationSet
metadata:
  name: grafana-operator
  namespace: argocd
  annotations:
    helm.sh/chart: gitops-bridge-1.0.0
  labels:
    helm.sh/chart: gitops-bridge-1.0.0
    app.kubernetes.io/name: gitops-bridge
    app.kubernetes.io/instance: my-release
    app.kubernetes.io/managed-by: Helm
    addon: "true"
spec:
  syncPolicy:
    preserveResourcesOnDeletion: true
  goTemplate: true
  goTemplateOptions:
  - missingkey=error
  generators:
          - clusters: # for reason this is need it as second in the matrix, if not the above extracting .tenants doesn't work
              selector:
                matchLabels:
                  argocd.argoproj.io/secret-type: cluster
                matchExpressions:
                - key: enable_grafana_operator
                  operator: In
                  values:
                  - "true"


  template:
    metadata:
      name: addon-grafana-operator-{{.nameNormalized}}
      annotations:
        argocd.argoproj.io/manifest-generate-paths: default/addons/grafana-operator/values.yaml;environments/{{.metadata.labels.environment}}/addons/grafana-operator/values.yaml;clusters/{{.nameNormalized}}/addons/grafana-operator/values.yaml;
        helm.sh/chart: gitops-bridge-1.0.0
      labels:
        helm.sh/chart: gitops-bridge-1.0.0
        app.kubernetes.io/name: gitops-bridge
        app.kubernetes.io/instance: my-release
        app.kubernetes.io/managed-by: Helm
        addon: "true"
        component: 'grafana-operator'
        environment: '{{.metadata.labels.environment}}'
        cluster: '{{.name}}'
    spec:
      project: default
      sources:
      - repoURL: '{{.metadata.annotations.addons_repo_url}}'
        targetRevision: '{{.metadata.annotations.addons_repo_revision}}'
        ref: values
      - repoURL: 'ghcr.io'
        targetRevision: 'v5.12.0'
        chart: 'grafana/helm-charts/grafana-operator'
        helm:
          releaseName: 'grafana-operator'
          ignoreMissingValueFiles: true
          valueFiles:
            - '$values/default/addons/grafana-operator/values.yaml'
            - '$values/default/addons/grafana-operator/5.12/values.yaml'
            - '$values/environments/{{.metadata.labels.environment}}/addons/grafana-operator/values.yaml'
            - '$values/environments/{{.metadata.labels.environment}}/addons/grafana-operator/5.12/values.yaml'
            - '$values/clusters/{{.nameNormalized}}/addons/grafana-operator/values.yaml'
            - '$values/clusters/{{.nameNormalized}}/addons/grafana-operator/5.12/values.yaml'
      - repoURL: '{{.metadata.annotations.addons_repo_url}}'
        targetRevision: '{{.metadata.annotations.addons_repo_revision}}'
        path: '{{.metadata.annotations.addons_repo_basepath}}charts/resources/grafana-operator'
        helm:
          releaseName: 'grafana-operator'
          ignoreMissingValueFiles: true
          valueFiles:
            - '$values/default/addons/grafana-operator/resources/values.yaml'
            - '$values/default/addons/grafana-operator/5.12/resources/values.yaml'
            - '$values/environments/{{.metadata.labels.environment}}/addons/grafana-operator/resources/values.yaml'
            - '$values/environments/{{.metadata.labels.environment}}/addons/grafana-operator/5.12/resources/values.yaml'
            - '$values/clusters/{{.nameNormalized}}/addons/grafana-operator/resources/values.yaml'
            - '$values/clusters/{{.nameNormalized}}/addons/grafana-operator/5.12/resources/values.yaml'
          valuesObject:
            AMP_AWS_REGION: '{{.metadata.annotations.aws_region}}'
            AMP_ENDPOINT_URL: '{{.metadata.annotations.amp_endpoint_url}}'
      destination:
        namespace: '{{ default "grafana-operator" (index .metadata.annotations "grafana_operator_namespace")}}'
        name: '{{.name}}'
      syncPolicy:
        automated:
          allowEmpty: true
          prune: false
          selfHeal: false
        retry:
          backoff:
            duration: 5s
            factor: 2
            maxDuration: 10m
          limit: -1
        syncOptions:
        - CreateNamespace=true
        - ServerSideApply=true
---
# Source: gitops-bridge/templates/applicationsets.yaml
apiVersion: argoproj.io/v1alpha1
kind: ApplicationSet
metadata:
  name: ingress-nginx
  namespace: argocd
  annotations:
    helm.sh/chart: gitops-bridge-1.0.0
  labels:
    helm.sh/chart: gitops-bridge-1.0.0
    app.kubernetes.io/name: gitops-bridge
    app.kubernetes.io/instance: my-release
    app.kubernetes.io/managed-by: Helm
    addon: "true"
spec:
  syncPolicy:
    preserveResourcesOnDeletion: true
  goTemplate: true
  goTemplateOptions:
  - missingkey=error
  generators:
          - clusters: # for reason this is need it as second in the matrix, if not the above extracting .tenants doesn't work
              selector:
                matchLabels:
                  argocd.argoproj.io/secret-type: cluster
                matchExpressions:
                - key: enable_ingress_nginx
                  operator: In
                  values:
                  - "true"


  template:
    metadata:
      name: addon-ingress-nginx-{{.nameNormalized}}
      annotations:
        argocd.argoproj.io/manifest-generate-paths: default/addons/ingress-nginx/values.yaml;environments/{{.metadata.labels.environment}}/addons/ingress-nginx/values.yaml;clusters/{{.nameNormalized}}/addons/ingress-nginx/values.yaml;
        helm.sh/chart: gitops-bridge-1.0.0
      labels:
        helm.sh/chart: gitops-bridge-1.0.0
        app.kubernetes.io/name: gitops-bridge
        app.kubernetes.io/instance: my-release
        app.kubernetes.io/managed-by: Helm
        addon: "true"
        component: 'ingress-nginx'
        environment: '{{.metadata.labels.environment}}'
        cluster: '{{.name}}'
    spec:
      project: default
      sources:
      - repoURL: '{{.metadata.annotations.addons_repo_url}}'
        targetRevision: '{{.metadata.annotations.addons_repo_revision}}'
        ref: values
      - repoURL: 'https://kubernetes.github.io/ingress-nginx'
        targetRevision: '4.11.1'
        chart: 'ingress-nginx'
        helm:
          releaseName: 'ingress-nginx'
          ignoreMissingValueFiles: true
          valueFiles:
            - '$values/default/addons/ingress-nginx/values.yaml'
            - '$values/default/addons/ingress-nginx/4.11/values.yaml'
            - '$values/environments/{{.metadata.labels.environment}}/addons/ingress-nginx/values.yaml'
            - '$values/environments/{{.metadata.labels.environment}}/addons/ingress-nginx/4.11/values.yaml'
            - '$values/clusters/{{.nameNormalized}}/addons/ingress-nginx/values.yaml'
            - '$values/clusters/{{.nameNormalized}}/addons/ingress-nginx/4.11/values.yaml'
      destination:
        namespace: '{{ default "ingress-nginx" (index .metadata.annotations "ingress_nginx_namespace")}}'
        name: '{{.name}}'
      syncPolicy:
        automated:
          allowEmpty: true
          prune: false
          selfHeal: false
        retry:
          backoff:
            duration: 5s
            factor: 2
            maxDuration: 10m
          limit: -1
        syncOptions:
        - CreateNamespace=true
        - ServerSideApply=true
---
# Source: gitops-bridge/templates/applicationsets.yaml
apiVersion: argoproj.io/v1alpha1
kind: ApplicationSet
metadata:
  name: karpenter
  namespace: argocd
  annotations:
    helm.sh/chart: gitops-bridge-1.0.0
  labels:
    helm.sh/chart: gitops-bridge-1.0.0
    app.kubernetes.io/name: gitops-bridge
    app.kubernetes.io/instance: my-release
    app.kubernetes.io/managed-by: Helm
    addon: "true"
spec:
  syncPolicy:
    preserveResourcesOnDeletion: true
  goTemplate: true
  goTemplateOptions:
  - missingkey=error
  generators:
          - clusters: # for reason this is need it as second in the matrix, if not the above extracting .tenants doesn't work
              selector:
                matchLabels:
                  argocd.argoproj.io/secret-type: cluster
                matchExpressions:
                - key: enable_karpenter
                  operator: In
                  values:
                  - "true"


  template:
    metadata:
      name: addon-karpenter-{{.nameNormalized}}
      annotations:
        argocd.argoproj.io/manifest-generate-paths: default/addons/karpenter/values.yaml;environments/{{.metadata.labels.environment}}/addons/karpenter/values.yaml;clusters/{{.nameNormalized}}/addons/karpenter/values.yaml;
        helm.sh/chart: gitops-bridge-1.0.0
      labels:
        helm.sh/chart: gitops-bridge-1.0.0
        app.kubernetes.io/name: gitops-bridge
        app.kubernetes.io/instance: my-release
        app.kubernetes.io/managed-by: Helm
        addon: "true"
        component: 'karpenter'
        environment: '{{.metadata.labels.environment}}'
        cluster: '{{.name}}'
    spec:
      project: default
      sources:
      - repoURL: '{{.metadata.annotations.addons_repo_url}}'
        targetRevision: '{{.metadata.annotations.addons_repo_revision}}'
        ref: values
      - repoURL: 'public.ecr.aws'
        targetRevision: '1.0.4'
        chart: 'karpenter/karpenter'
        helm:
          releaseName: 'karpenter'
          ignoreMissingValueFiles: true
          valueFiles:
            - '$values/default/addons/karpenter/values.yaml'
            - '$values/default/addons/karpenter/1.0/values.yaml'
            - '$values/environments/{{.metadata.labels.environment}}/addons/karpenter/values.yaml'
            - '$values/environments/{{.metadata.labels.environment}}/addons/karpenter/1.0/values.yaml'
            - '$values/clusters/{{.nameNormalized}}/addons/karpenter/values.yaml'
            - '$values/clusters/{{.nameNormalized}}/addons/karpenter/1.0/values.yaml'
          valuesObject:
            serviceAccount:
              annotations:
                eks.amazonaws.com/role-arn: '{{ default "" (index .metadata.annotations "karpenter_iam_role_arn")
                  }}'
              name: '{{ default "karpenter" (index .metadata.annotations "karpenter_service_account")
                }}'
            settings:
              clusterName: '{{.metadata.annotations.aws_cluster_name}}'
              interruptionQueue: '{{.metadata.annotations.karpenter_sqs_queue_name}}'
      - repoURL: '{{.metadata.annotations.addons_repo_url}}'
        targetRevision: '{{.metadata.annotations.addons_repo_revision}}'
        path: '{{.metadata.annotations.addons_repo_basepath}}charts/resources/karpenter'
        helm:
          releaseName: 'karpenter'
          ignoreMissingValueFiles: true
          valueFiles:
            - '$values/default/addons/karpenter/resources/values.yaml'
            - '$values/default/addons/karpenter/1.0/resources/values.yaml'
            - '$values/environments/{{.metadata.labels.environment}}/addons/karpenter/resources/values.yaml'
            - '$values/environments/{{.metadata.labels.environment}}/addons/karpenter/1.0/resources/values.yaml'
            - '$values/clusters/{{.nameNormalized}}/addons/karpenter/resources/values.yaml'
            - '$values/clusters/{{.nameNormalized}}/addons/karpenter/1.0/resources/values.yaml'
          valuesObject:
            IamRole: '{{.metadata.annotations.karpenter_node_iam_role_name}}'
            clusterName: '{{.metadata.annotations.aws_cluster_name}}'
            environment: '{{.metadata.labels.environment}}'
            securityGroupSelectorTerms:
            - tags:
                karpenter.sh/discovery: '{{.metadata.annotations.aws_cluster_name}}'
            subnetSelectorTerms:
            - tags:
                karpenter.sh/discovery: '{{.metadata.annotations.aws_vpc_name}}'
      destination:
        namespace: '{{ default "kube-system" (index .metadata.annotations "karpenter_namespace") }}'
        name: '{{.name}}'
      syncPolicy:
        automated:
          allowEmpty: true
          prune: false
          selfHeal: false
        retry:
          backoff:
            duration: 5s
            factor: 2
            maxDuration: 10m
          limit: -1
        syncOptions:
        - CreateNamespace=true
        - ServerSideApply=true
---
# Source: gitops-bridge/templates/applicationsets.yaml
apiVersion: argoproj.io/v1alpha1
kind: ApplicationSet
metadata:
  name: keda
  namespace: argocd
  annotations:
    helm.sh/chart: gitops-bridge-1.0.0
  labels:
    helm.sh/chart: gitops-bridge-1.0.0
    app.kubernetes.io/name: gitops-bridge
    app.kubernetes.io/instance: my-release
    app.kubernetes.io/managed-by: Helm
    addon: "true"
spec:
  syncPolicy:
    preserveResourcesOnDeletion: true
  goTemplate: true
  goTemplateOptions:
  - missingkey=error
  generators:
          - clusters: # for reason this is need it as second in the matrix, if not the above extracting .tenants doesn't work
              selector:
                matchLabels:
                  argocd.argoproj.io/secret-type: cluster
                matchExpressions:
                - key: enable_keda
                  operator: In
                  values:
                  - "true"


  template:
    metadata:
      name: addon-keda-{{.nameNormalized}}
      annotations:
        argocd.argoproj.io/manifest-generate-paths: default/addons/keda/values.yaml;environments/{{.metadata.labels.environment}}/addons/keda/values.yaml;clusters/{{.nameNormalized}}/addons/keda/values.yaml;
        helm.sh/chart: gitops-bridge-1.0.0
      labels:
        helm.sh/chart: gitops-bridge-1.0.0
        app.kubernetes.io/name: gitops-bridge
        app.kubernetes.io/instance: my-release
        app.kubernetes.io/managed-by: Helm
        addon: "true"
        component: 'keda'
        environment: '{{.metadata.labels.environment}}'
        cluster: '{{.name}}'
    spec:
      project: default
      sources:
      - repoURL: '{{.metadata.annotations.addons_repo_url}}'
        targetRevision: '{{.metadata.annotations.addons_repo_revision}}'
        ref: values
      - repoURL: 'https://kedacore.github.io/charts'
        targetRevision: '2.15.0'
        chart: 'keda'
        helm:
          releaseName: 'keda'
          ignoreMissingValueFiles: true
          valueFiles:
            - '$values/default/addons/keda/values.yaml'
            - '$values/default/addons/keda/2.15/values.yaml'
            - '$values/environments/{{.metadata.labels.environment}}/addons/keda/values.yaml'
            - '$values/environments/{{.metadata.labels.environment}}/addons/keda/2.15/values.yaml'
            - '$values/clusters/{{.nameNormalized}}/addons/keda/values.yaml'
            - '$values/clusters/{{.nameNormalized}}/addons/keda/2.15/values.yaml'
      destination:
        namespace: '{{ default "keda" (index .metadata.annotations "keda_namespace")}}'
        name: '{{.name}}'
      syncPolicy:
        automated:
          allowEmpty: true
          prune: false
          selfHeal: false
        retry:
          backoff:
            duration: 5s
            factor: 2
            maxDuration: 10m
          limit: -1
        syncOptions:
        - CreateNamespace=true
        - ServerSideApply=true
---
# Source: gitops-bridge/templates/applicationsets.yaml
apiVersion: argoproj.io/v1alpha1
kind: ApplicationSet
metadata:
  name: kro
  namespace: argocd
  annotations:
    helm.sh/chart: gitops-bridge-1.0.0
  labels:
    helm.sh/chart: gitops-bridge-1.0.0
    app.kubernetes.io/name: gitops-bridge
    app.kubernetes.io/instance: my-release
    app.kubernetes.io/managed-by: Helm
    addon: "true"
spec:
  syncPolicy:
    preserveResourcesOnDeletion: true
  goTemplate: true
  goTemplateOptions:
  - missingkey=error
  generators:
          - clusters: # for reason this is need it as second in the matrix, if not the above extracting .tenants doesn't work
              selector:
                matchLabels:
                  argocd.argoproj.io/secret-type: cluster
                matchExpressions:
                - key: enable_kro
                  operator: In
                  values:
                  - "true"


  template:
    metadata:
      name: addon-kro-{{.nameNormalized}}
      annotations:
        argocd.argoproj.io/manifest-generate-paths: default/addons/kro/values.yaml;environments/{{.metadata.labels.environment}}/addons/kro/values.yaml;clusters/{{.nameNormalized}}/addons/kro/values.yaml;
        helm.sh/chart: gitops-bridge-1.0.0
      labels:
        helm.sh/chart: gitops-bridge-1.0.0
        app.kubernetes.io/name: gitops-bridge
        app.kubernetes.io/instance: my-release
        app.kubernetes.io/managed-by: Helm
        addon: "true"
        component: 'kro'
        environment: '{{.metadata.labels.environment}}'
        cluster: '{{.name}}'
    spec:
      project: default
      sources:
      - repoURL: '{{.metadata.annotations.addons_repo_url}}'
        targetRevision: '{{.metadata.annotations.addons_repo_revision}}'
        ref: values
      - repoURL: 'ghcr.io'
        targetRevision: '0.2.0'
        chart: 'kro-run/kro/kro'
        helm:
          releaseName: 'kro'
          ignoreMissingValueFiles: true
          valueFiles:
            - '$values/default/addons/kro/values.yaml'
            - '$values/default/addons/kro/0.2/values.yaml'
            - '$values/environments/{{.metadata.labels.environment}}/addons/kro/values.yaml'
            - '$values/environments/{{.metadata.labels.environment}}/addons/kro/0.2/values.yaml'
            - '$values/clusters/{{.nameNormalized}}/addons/kro/values.yaml'
            - '$values/clusters/{{.nameNormalized}}/addons/kro/0.2/values.yaml'
      destination:
        namespace: 'kro'
        name: '{{.name}}'
      syncPolicy:
        automated:
          allowEmpty: true
          prune: false
          selfHeal: false
        retry:
          backoff:
            duration: 5s
            factor: 2
            maxDuration: 10m
          limit: -1
        syncOptions:
        - CreateNamespace=true
        - ServerSideApply=true
---
# Source: gitops-bridge/templates/applicationsets.yaml
apiVersion: argoproj.io/v1alpha1
kind: ApplicationSet
metadata:
  name: kube-prometheus-stack
  namespace: argocd
  annotations:
    helm.sh/chart: gitops-bridge-1.0.0
  labels:
    helm.sh/chart: gitops-bridge-1.0.0
    app.kubernetes.io/name: gitops-bridge
    app.kubernetes.io/instance: my-release
    app.kubernetes.io/managed-by: Helm
    addon: "true"
spec:
  syncPolicy:
    preserveResourcesOnDeletion: true
  goTemplate: true
  goTemplateOptions:
  - missingkey=error
  generators:
          - clusters: # for reason this is need it as second in the matrix, if not the above extracting .tenants doesn't work
              selector:
                matchLabels:
                  argocd.argoproj.io/secret-type: cluster
                matchExpressions:
                - key: enable_kube_prometheus_stack
                  operator: In
                  values:
                  - "true"


  template:
    metadata:
      name: addon-kube-prometheus-stack-{{.nameNormalized}}
      annotations:
        argocd.argoproj.io/manifest-generate-paths: default/addons/kube-prometheus-stack/values.yaml;environments/{{.metadata.labels.environment}}/addons/kube-prometheus-stack/values.yaml;clusters/{{.nameNormalized}}/addons/kube-prometheus-stack/values.yaml;
        helm.sh/chart: gitops-bridge-1.0.0
      labels:
        helm.sh/chart: gitops-bridge-1.0.0
        app.kubernetes.io/name: gitops-bridge
        app.kubernetes.io/instance: my-release
        app.kubernetes.io/managed-by: Helm
        addon: "true"
        component: 'kube-prometheus-stack'
        environment: '{{.metadata.labels.environment}}'
        cluster: '{{.name}}'
    spec:
      project: default
      sources:
      - repoURL: '{{.metadata.annotations.addons_repo_url}}'
        targetRevision: '{{.metadata.annotations.addons_repo_revision}}'
        ref: values
      - repoURL: 'https://prometheus-community.github.io/helm-charts'
        targetRevision: '62.4.0'
        chart: 'kube-prometheus-stack'
        helm:
          releaseName: 'kube-prometheus-stack'
          ignoreMissingValueFiles: true
          valueFiles:
            - '$values/default/addons/kube-prometheus-stack/values.yaml'
            - '$values/default/addons/kube-prometheus-stack/62.4/values.yaml'
            - '$values/environments/{{.metadata.labels.environment}}/addons/kube-prometheus-stack/values.yaml'
            - '$values/environments/{{.metadata.labels.environment}}/addons/kube-prometheus-stack/62.4/values.yaml'
            - '$values/clusters/{{.nameNormalized}}/addons/kube-prometheus-stack/values.yaml'
            - '$values/clusters/{{.nameNormalized}}/addons/kube-prometheus-stack/62.4/values.yaml'
      destination:
        namespace: '{{ default "kube-prometheus-stack" (index .metadata.annotations "kube_prometheus_stack_namespace")}}'
        name: '{{.name}}'
      syncPolicy:
        automated:
          allowEmpty: true
          prune: false
          selfHeal: false
        retry:
          backoff:
            duration: 5s
            factor: 2
            maxDuration: 10m
          limit: -1
        syncOptions:
        - CreateNamespace=true
        - ServerSideApply=true
---
# Source: gitops-bridge/templates/applicationsets.yaml
apiVersion: argoproj.io/v1alpha1
kind: ApplicationSet
metadata:
  name: kube-state-metrics
  namespace: argocd
  annotations:
    helm.sh/chart: gitops-bridge-1.0.0
  labels:
    helm.sh/chart: gitops-bridge-1.0.0
    app.kubernetes.io/name: gitops-bridge
    app.kubernetes.io/instance: my-release
    app.kubernetes.io/managed-by: Helm
    addon: "true"
spec:
  syncPolicy:
    preserveResourcesOnDeletion: true
  goTemplate: true
  goTemplateOptions:
  - missingkey=error
  generators:
          - clusters: # for reason this is need it as second in the matrix, if not the above extracting .tenants doesn't work
              selector:
                matchLabels:
                  argocd.argoproj.io/secret-type: cluster
                matchExpressions:
                - key: enable_kube_state_metrics
                  operator: In
                  values:
                  - "true"


  template:
    metadata:
      name: addon-kube-state-metrics-{{.nameNormalized}}
      annotations:
        argocd.argoproj.io/manifest-generate-paths: default/addons/kube-state-metrics/values.yaml;environments/{{.metadata.labels.environment}}/addons/kube-state-metrics/values.yaml;clusters/{{.nameNormalized}}/addons/kube-state-metrics/values.yaml;
        helm.sh/chart: gitops-bridge-1.0.0
      labels:
        helm.sh/chart: gitops-bridge-1.0.0
        app.kubernetes.io/name: gitops-bridge
        app.kubernetes.io/instance: my-release
        app.kubernetes.io/managed-by: Helm
        addon: "true"
        component: 'kube-state-metrics'
        environment: '{{.metadata.labels.environment}}'
        cluster: '{{.name}}'
    spec:
      project: default
      sources:
      - repoURL: '{{.metadata.annotations.addons_repo_url}}'
        targetRevision: '{{.metadata.annotations.addons_repo_revision}}'
        ref: values
      - repoURL: 'https://prometheus-community.github.io/helm-charts'
        targetRevision: '5.25.1'
        chart: 'kube-state-metrics'
        helm:
          releaseName: 'kube-state-metrics'
          ignoreMissingValueFiles: true
          valueFiles:
            - '$values/default/addons/kube-state-metrics/values.yaml'
            - '$values/default/addons/kube-state-metrics/5.25/values.yaml'
            - '$values/environments/{{.metadata.labels.environment}}/addons/kube-state-metrics/values.yaml'
            - '$values/environments/{{.metadata.labels.environment}}/addons/kube-state-metrics/5.25/values.yaml'
            - '$values/clusters/{{.nameNormalized}}/addons/kube-state-metrics/values.yaml'
            - '$values/clusters/{{.nameNormalized}}/addons/kube-state-metrics/5.25/values.yaml'
      destination:
        namespace: '{{ default "kube-prometheus-stack" (index .metadata.annotations "kube_state_metrics_namespace")}}'
        name: '{{.name}}'
      syncPolicy:
        automated:
          allowEmpty: true
          prune: false
          selfHeal: false
        retry:
          backoff:
            duration: 5s
            factor: 2
            maxDuration: 10m
          limit: -1
        syncOptions:
        - CreateNamespace=true
        - ServerSideApply=true
---
# Source: gitops-bridge/templates/applicationsets.yaml
apiVersion: argoproj.io/v1alpha1
kind: ApplicationSet
metadata:
  name: kyverno
  namespace: argocd
  annotations:
    helm.sh/chart: gitops-bridge-1.0.0
  labels:
    helm.sh/chart: gitops-bridge-1.0.0
    app.kubernetes.io/name: gitops-bridge
    app.kubernetes.io/instance: my-release
    app.kubernetes.io/managed-by: Helm
    addon: "true"
spec:
  syncPolicy:
    preserveResourcesOnDeletion: true
  goTemplate: true
  goTemplateOptions:
  - missingkey=error
  generators:
          - clusters: # for reason this is need it as second in the matrix, if not the above extracting .tenants doesn't work
              selector:
                matchLabels:
                  argocd.argoproj.io/secret-type: cluster
                matchExpressions:
                - key: enable_kyverno
                  operator: In
                  values:
                  - "true"


  template:
    metadata:
      name: addon-kyverno-{{.nameNormalized}}
      annotations:
        argocd.argoproj.io/manifest-generate-paths: default/addons/kyverno/values.yaml;environments/{{.metadata.labels.environment}}/addons/kyverno/values.yaml;clusters/{{.nameNormalized}}/addons/kyverno/values.yaml;
        helm.sh/chart: gitops-bridge-1.0.0
      labels:
        helm.sh/chart: gitops-bridge-1.0.0
        app.kubernetes.io/name: gitops-bridge
        app.kubernetes.io/instance: my-release
        app.kubernetes.io/managed-by: Helm
        addon: "true"
        component: 'kyverno'
        environment: '{{.metadata.labels.environment}}'
        cluster: '{{.name}}'
    spec:
      project: default
      sources:
      - repoURL: '{{.metadata.annotations.addons_repo_url}}'
        targetRevision: '{{.metadata.annotations.addons_repo_revision}}'
        ref: values
      - repoURL: 'https://kyverno.github.io/kyverno'
        targetRevision: '3.3.4'
        chart: 'kyverno'
        helm:
          releaseName: 'kyverno'
          ignoreMissingValueFiles: true
          valueFiles:
            - '$values/default/addons/kyverno/values.yaml'
            - '$values/default/addons/kyverno/3.3/values.yaml'
            - '$values/environments/{{.metadata.labels.environment}}/addons/kyverno/values.yaml'
            - '$values/environments/{{.metadata.labels.environment}}/addons/kyverno/3.3/values.yaml'
            - '$values/clusters/{{.nameNormalized}}/addons/kyverno/values.yaml'
            - '$values/clusters/{{.nameNormalized}}/addons/kyverno/3.3/values.yaml'
      - repoURL: '{{.metadata.annotations.addons_repo_url}}'
        targetRevision: '{{.metadata.annotations.addons_repo_revision}}'
        path: '{{.metadata.annotations.addons_repo_basepath}}charts/resources/kyverno'
        helm:
          releaseName: 'kyverno'
          ignoreMissingValueFiles: true
          valueFiles:
            - '$values/default/addons/kyverno/resources/values.yaml'
            - '$values/default/addons/kyverno/3.3/resources/values.yaml'
            - '$values/environments/{{.metadata.labels.environment}}/addons/kyverno/resources/values.yaml'
            - '$values/environments/{{.metadata.labels.environment}}/addons/kyverno/3.3/resources/values.yaml'
            - '$values/clusters/{{.nameNormalized}}/addons/kyverno/resources/values.yaml'
            - '$values/clusters/{{.nameNormalized}}/addons/kyverno/3.3/resources/values.yaml'
          valuesObject:
            environment: '{{.metadata.labels.environment}}'
      destination:
        namespace: '{{ default "kyverno" (index .metadata.annotations "kyverno_namespace")}}'
        name: '{{.name}}'
      syncPolicy:
        automated:
          allowEmpty: true
          prune: false
          selfHeal: false
        retry:
          backoff:
            duration: 5s
            factor: 2
            maxDuration: 10m
          limit: -1
        syncOptions:
        - CreateNamespace=true
        - ServerSideApply=true
---
# Source: gitops-bridge/templates/applicationsets.yaml
apiVersion: argoproj.io/v1alpha1
kind: ApplicationSet
metadata:
  name: kyverno-policies
  namespace: argocd
  annotations:
    helm.sh/chart: gitops-bridge-1.0.0
  labels:
    helm.sh/chart: gitops-bridge-1.0.0
    app.kubernetes.io/name: gitops-bridge
    app.kubernetes.io/instance: my-release
    app.kubernetes.io/managed-by: Helm
    addon: "true"
spec:
  syncPolicy:
    preserveResourcesOnDeletion: true
  goTemplate: true
  goTemplateOptions:
  - missingkey=error
  generators:
          - clusters: # for reason this is need it as second in the matrix, if not the above extracting .tenants doesn't work
              selector:
                matchLabels:
                  argocd.argoproj.io/secret-type: cluster
                matchExpressions:
                - key: enable_kyverno_policies
                  operator: In
                  values:
                  - "true"


  template:
    metadata:
      name: addon-kyverno-policies-{{.nameNormalized}}
      annotations:
        argocd.argoproj.io/manifest-generate-paths: default/addons/kyverno-policies/values.yaml;environments/{{.metadata.labels.environment}}/addons/kyverno-policies/values.yaml;clusters/{{.nameNormalized}}/addons/kyverno-policies/values.yaml;
        helm.sh/chart: gitops-bridge-1.0.0
      labels:
        helm.sh/chart: gitops-bridge-1.0.0
        app.kubernetes.io/name: gitops-bridge
        app.kubernetes.io/instance: my-release
        app.kubernetes.io/managed-by: Helm
        addon: "true"
        component: 'kyverno-policies'
        environment: '{{.metadata.labels.environment}}'
        cluster: '{{.name}}'
    spec:
      project: default
      sources:
      - repoURL: '{{.metadata.annotations.addons_repo_url}}'
        targetRevision: '{{.metadata.annotations.addons_repo_revision}}'
        ref: values
      - repoURL: 'https://kyverno.github.io/kyverno'
        targetRevision: '3.2.5'
        chart: 'kyverno-policies'
        helm:
          releaseName: 'kyverno-policies'
          ignoreMissingValueFiles: true
          valueFiles:
            - '$values/default/addons/kyverno-policies/values.yaml'
            - '$values/default/addons/kyverno-policies/3.2/values.yaml'
            - '$values/environments/{{.metadata.labels.environment}}/addons/kyverno-policies/values.yaml'
            - '$values/environments/{{.metadata.labels.environment}}/addons/kyverno-policies/3.2/values.yaml'
            - '$values/clusters/{{.nameNormalized}}/addons/kyverno-policies/values.yaml'
            - '$values/clusters/{{.nameNormalized}}/addons/kyverno-policies/3.2/values.yaml'
          valuesObject:
            podSecurityStandard: restricted
            skipBackgroundRequests: false
            validationFailureAction: Audit
      destination:
        namespace: '{{ default "kyverno" (index .metadata.annotations "kyverno_namespace")}}'
        name: '{{.name}}'
      syncPolicy:
        automated:
          allowEmpty: true
          prune: false
          selfHeal: false
        retry:
          backoff:
            duration: 5s
            factor: 2
            maxDuration: 10m
          limit: -1
        syncOptions:
        - CreateNamespace=true
        - ServerSideApply=true
---
# Source: gitops-bridge/templates/applicationsets.yaml
apiVersion: argoproj.io/v1alpha1
kind: ApplicationSet
metadata:
  name: kyverno-policy-reporter
  namespace: argocd
  annotations:
    helm.sh/chart: gitops-bridge-1.0.0
  labels:
    helm.sh/chart: gitops-bridge-1.0.0
    app.kubernetes.io/name: gitops-bridge
    app.kubernetes.io/instance: my-release
    app.kubernetes.io/managed-by: Helm
    addon: "true"
spec:
  syncPolicy:
    preserveResourcesOnDeletion: true
  goTemplate: true
  goTemplateOptions:
  - missingkey=error
  generators:
          - clusters: # for reason this is need it as second in the matrix, if not the above extracting .tenants doesn't work
              selector:
                matchLabels:
                  argocd.argoproj.io/secret-type: cluster
                matchExpressions:
                - key: enable_kyverno_policy_reporter
                  operator: In
                  values:
                  - "true"


  template:
    metadata:
      name: addon-kyverno-policy-reporter-{{.nameNormalized}}
      annotations:
        argocd.argoproj.io/manifest-generate-paths: default/addons/kyverno-policy-reporter/values.yaml;environments/{{.metadata.labels.environment}}/addons/kyverno-policy-reporter/values.yaml;clusters/{{.nameNormalized}}/addons/kyverno-policy-reporter/values.yaml;
        helm.sh/chart: gitops-bridge-1.0.0
      labels:
        helm.sh/chart: gitops-bridge-1.0.0
        app.kubernetes.io/name: gitops-bridge
        app.kubernetes.io/instance: my-release
        app.kubernetes.io/managed-by: Helm
        addon: "true"
        component: 'kyverno-policy-reporter'
        environment: '{{.metadata.labels.environment}}'
        cluster: '{{.name}}'
    spec:
      project: default
      sources:
      - repoURL: '{{.metadata.annotations.addons_repo_url}}'
        targetRevision: '{{.metadata.annotations.addons_repo_revision}}'
        ref: values
      - repoURL: 'https://kyverno.github.io/policy-reporter'
        targetRevision: '3.0.0'
        chart: 'policy-reporter'
        helm:
          releaseName: 'kyverno-policy-reporter'
          ignoreMissingValueFiles: true
          valueFiles:
            - '$values/default/addons/kyverno-policy-reporter/values.yaml'
            - '$values/default/addons/kyverno-policy-reporter/3.0/values.yaml'
            - '$values/environments/{{.metadata.labels.environment}}/addons/kyverno-policy-reporter/values.yaml'
            - '$values/environments/{{.metadata.labels.environment}}/addons/kyverno-policy-reporter/3.0/values.yaml'
            - '$values/clusters/{{.nameNormalized}}/addons/kyverno-policy-reporter/values.yaml'
            - '$values/clusters/{{.nameNormalized}}/addons/kyverno-policy-reporter/3.0/values.yaml'
          valuesObject:
            logging:
              logLevel: 0
            plugin:
              kyverno:
                enabled: true
            serviceAccount:
              name: policy-reporter
            target:
              securityHub:
                accountId: '{{.metadata.annotations.aws_account_id}}'
                customFields:
                  account: '{{.metadata.annotations.aws_account_id}}'
                  cluster: '{{.metadata.annotations.aws_cluster_name}}'
                  eks_console_url: https://{{.metadata.annotations.aws_region}}.console.aws.amazon.com/eks/home?region={{.metadata.annotations.aws_region}}#/clusters/{{.metadata.annotations.aws_cluster_name}}?selectedTab=cluster-resources-tab&selectedResourceId=namespaces
                  region: '{{.metadata.annotations.aws_region}}'
                delayInSeconds: 10
                minimumPriority: warning
                productName: '{{.metadata.annotations.aws_cluster_name}}'
                region: '{{.metadata.annotations.aws_region}}'
                skipExistingOnStartup: false
                synchronize: true
            ui:
              banner: '{{.metadata.annotations.aws_cluster_name}}'
              enabled: true
      destination:
        namespace: '{{ default "kyverno" (index .metadata.annotations "kyverno_namespace")}}'
        name: '{{.name}}'
      syncPolicy:
        automated:
          allowEmpty: true
          prune: false
          selfHeal: false
        retry:
          backoff:
            duration: 5s
            factor: 2
            maxDuration: 10m
          limit: -1
        syncOptions:
        - CreateNamespace=true
        - ServerSideApply=true
---
# Source: gitops-bridge/templates/applicationsets.yaml
apiVersion: argoproj.io/v1alpha1
kind: ApplicationSet
metadata:
  name: metrics-server
  namespace: argocd
  annotations:
    helm.sh/chart: gitops-bridge-1.0.0
  labels:
    helm.sh/chart: gitops-bridge-1.0.0
    app.kubernetes.io/name: gitops-bridge
    app.kubernetes.io/instance: my-release
    app.kubernetes.io/managed-by: Helm
    addon: "true"
spec:
  syncPolicy:
    preserveResourcesOnDeletion: true
  goTemplate: true
  goTemplateOptions:
  - missingkey=error
  generators:
          - clusters: # for reason this is need it as second in the matrix, if not the above extracting .tenants doesn't work
              selector:
                matchLabels:
                  argocd.argoproj.io/secret-type: cluster
                matchExpressions:
                - key: enable_metrics_server
                  operator: In
                  values:
                  - "true"


  template:
    metadata:
      name: addon-metrics-server-{{.nameNormalized}}
      annotations:
        argocd.argoproj.io/manifest-generate-paths: default/addons/metrics-server/values.yaml;environments/{{.metadata.labels.environment}}/addons/metrics-server/values.yaml;clusters/{{.nameNormalized}}/addons/metrics-server/values.yaml;
        helm.sh/chart: gitops-bridge-1.0.0
      labels:
        helm.sh/chart: gitops-bridge-1.0.0
        app.kubernetes.io/name: gitops-bridge
        app.kubernetes.io/instance: my-release
        app.kubernetes.io/managed-by: Helm
        addon: "true"
        component: 'metrics-server'
        environment: '{{.metadata.labels.environment}}'
        cluster: '{{.name}}'
    spec:
      project: default
      sources:
      - repoURL: '{{.metadata.annotations.addons_repo_url}}'
        targetRevision: '{{.metadata.annotations.addons_repo_revision}}'
        ref: values
      - repoURL: 'https://kubernetes-sigs.github.io/metrics-server'
        targetRevision: '3.12.1'
        chart: 'metrics-server'
        helm:
          releaseName: 'metrics-server'
          ignoreMissingValueFiles: true
          valueFiles:
            - '$values/default/addons/metrics-server/values.yaml'
            - '$values/default/addons/metrics-server/3.12/values.yaml'
            - '$values/environments/{{.metadata.labels.environment}}/addons/metrics-server/values.yaml'
            - '$values/environments/{{.metadata.labels.environment}}/addons/metrics-server/3.12/values.yaml'
            - '$values/clusters/{{.nameNormalized}}/addons/metrics-server/values.yaml'
            - '$values/clusters/{{.nameNormalized}}/addons/metrics-server/3.12/values.yaml'
      destination:
        namespace: 'kube-system'
        name: '{{.name}}'
      syncPolicy:
        automated:
          allowEmpty: true
          prune: false
          selfHeal: false
        retry:
          backoff:
            duration: 5s
            factor: 2
            maxDuration: 10m
          limit: -1
        syncOptions:
        - CreateNamespace=true
        - ServerSideApply=true
---
# Source: gitops-bridge/templates/applicationsets.yaml
apiVersion: argoproj.io/v1alpha1
kind: ApplicationSet
metadata:
  name: opentelemetry-operator
  namespace: argocd
  annotations:
    helm.sh/chart: gitops-bridge-1.0.0
  labels:
    helm.sh/chart: gitops-bridge-1.0.0
    app.kubernetes.io/name: gitops-bridge
    app.kubernetes.io/instance: my-release
    app.kubernetes.io/managed-by: Helm
    addon: "true"
spec:
  syncPolicy:
    preserveResourcesOnDeletion: true
  goTemplate: true
  goTemplateOptions:
  - missingkey=error
  generators:
          - clusters: # for reason this is need it as second in the matrix, if not the above extracting .tenants doesn't work
              selector:
                matchLabels:
                  argocd.argoproj.io/secret-type: cluster
                matchExpressions:
                - key: enable_opentelemetry_operator
                  operator: In
                  values:
                  - "true"


  template:
    metadata:
      name: addon-opentelemetry-operator-{{.nameNormalized}}
      annotations:
        argocd.argoproj.io/manifest-generate-paths: default/addons/opentelemetry-operator/values.yaml;environments/{{.metadata.labels.environment}}/addons/opentelemetry-operator/values.yaml;clusters/{{.nameNormalized}}/addons/opentelemetry-operator/values.yaml;
        helm.sh/chart: gitops-bridge-1.0.0
      labels:
        helm.sh/chart: gitops-bridge-1.0.0
        app.kubernetes.io/name: gitops-bridge
        app.kubernetes.io/instance: my-release
        app.kubernetes.io/managed-by: Helm
        addon: "true"
        component: 'opentelemetry-operator'
        environment: '{{.metadata.labels.environment}}'
        cluster: '{{.name}}'
    spec:
      project: default
      sources:
      - repoURL: '{{.metadata.annotations.addons_repo_url}}'
        targetRevision: '{{.metadata.annotations.addons_repo_revision}}'
        ref: values
      - repoURL: 'https://open-telemetry.github.io/opentelemetry-helm-charts'
        targetRevision: '0.71.1'
        chart: 'opentelemetry-operator'
        helm:
          releaseName: 'opentelemetry-operator'
          ignoreMissingValueFiles: true
          valueFiles:
            - '$values/default/addons/opentelemetry-operator/values.yaml'
            - '$values/default/addons/opentelemetry-operator/0.71/values.yaml'
            - '$values/environments/{{.metadata.labels.environment}}/addons/opentelemetry-operator/values.yaml'
            - '$values/environments/{{.metadata.labels.environment}}/addons/opentelemetry-operator/0.71/values.yaml'
            - '$values/clusters/{{.nameNormalized}}/addons/opentelemetry-operator/values.yaml'
            - '$values/clusters/{{.nameNormalized}}/addons/opentelemetry-operator/0.71/values.yaml'
          valuesObject:
            manager:
              collectorImage:
                repository: otel/opentelemetry-collector-k8s
      destination:
        namespace: 'opentelemetry-operator-system'
        name: '{{.name}}'
      syncPolicy:
        automated:
          allowEmpty: true
          prune: false
          selfHeal: false
        retry:
          backoff:
            duration: 5s
            factor: 2
            maxDuration: 10m
          limit: -1
        syncOptions:
        - CreateNamespace=true
        - ServerSideApply=true
---
# Source: gitops-bridge/templates/applicationsets.yaml
apiVersion: argoproj.io/v1alpha1
kind: ApplicationSet
metadata:
  name: prometheus-adapter
  namespace: argocd
  annotations:
    helm.sh/chart: gitops-bridge-1.0.0
  labels:
    helm.sh/chart: gitops-bridge-1.0.0
    app.kubernetes.io/name: gitops-bridge
    app.kubernetes.io/instance: my-release
    app.kubernetes.io/managed-by: Helm
    addon: "true"
spec:
  syncPolicy:
    preserveResourcesOnDeletion: true
  goTemplate: true
  goTemplateOptions:
  - missingkey=error
  generators:
          - clusters: # for reason this is need it as second in the matrix, if not the above extracting .tenants doesn't work
              selector:
                matchLabels:
                  argocd.argoproj.io/secret-type: cluster
                matchExpressions:
                - key: enable_prometheus_adapter
                  operator: In
                  values:
                  - "true"


  template:
    metadata:
      name: addon-prometheus-adapter-{{.nameNormalized}}
      annotations:
        argocd.argoproj.io/manifest-generate-paths: default/addons/prometheus-adapter/values.yaml;environments/{{.metadata.labels.environment}}/addons/prometheus-adapter/values.yaml;clusters/{{.nameNormalized}}/addons/prometheus-adapter/values.yaml;
        helm.sh/chart: gitops-bridge-1.0.0
      labels:
        helm.sh/chart: gitops-bridge-1.0.0
        app.kubernetes.io/name: gitops-bridge
        app.kubernetes.io/instance: my-release
        app.kubernetes.io/managed-by: Helm
        addon: "true"
        component: 'prometheus-adapter'
        environment: '{{.metadata.labels.environment}}'
        cluster: '{{.name}}'
    spec:
      project: default
      sources:
      - repoURL: '{{.metadata.annotations.addons_repo_url}}'
        targetRevision: '{{.metadata.annotations.addons_repo_revision}}'
        ref: values
      - repoURL: 'https://prometheus-community.github.io/helm-charts'
        targetRevision: '4.10.0'
        chart: 'prometheus-adapter'
        helm:
          releaseName: 'prometheus-adapter'
          ignoreMissingValueFiles: true
          valueFiles:
            - '$values/default/addons/prometheus-adapter/values.yaml'
            - '$values/default/addons/prometheus-adapter/4.10/values.yaml'
            - '$values/environments/{{.metadata.labels.environment}}/addons/prometheus-adapter/values.yaml'
            - '$values/environments/{{.metadata.labels.environment}}/addons/prometheus-adapter/4.10/values.yaml'
            - '$values/clusters/{{.nameNormalized}}/addons/prometheus-adapter/values.yaml'
            - '$values/clusters/{{.nameNormalized}}/addons/prometheus-adapter/4.10/values.yaml'
      destination:
        namespace: '{{ default "prometheus-adapter" (index .metadata.annotations "prometheus_adapter_namespace")}}'
        name: '{{.name}}'
      syncPolicy:
        automated:
          allowEmpty: true
          prune: false
          selfHeal: false
        retry:
          backoff:
            duration: 5s
            factor: 2
            maxDuration: 10m
          limit: -1
        syncOptions:
        - CreateNamespace=true
        - ServerSideApply=true
---
# Source: gitops-bridge/templates/applicationsets.yaml
apiVersion: argoproj.io/v1alpha1
kind: ApplicationSet
metadata:
  name: prometheus-node-exporter
  namespace: argocd
  annotations:
    helm.sh/chart: gitops-bridge-1.0.0
  labels:
    helm.sh/chart: gitops-bridge-1.0.0
    app.kubernetes.io/name: gitops-bridge
    app.kubernetes.io/instance: my-release
    app.kubernetes.io/managed-by: Helm
    addon: "true"
spec:
  syncPolicy:
    preserveResourcesOnDeletion: true
  goTemplate: true
  goTemplateOptions:
  - missingkey=error
  generators:
          - clusters: # for reason this is need it as second in the matrix, if not the above extracting .tenants doesn't work
              selector:
                matchLabels:
                  argocd.argoproj.io/secret-type: cluster
                matchExpressions:
                - key: enable_prometheus_node_exporter
                  operator: In
                  values:
                  - "true"


  template:
    metadata:
      name: addon-prometheus-node-exporter-{{.nameNormalized}}
      annotations:
        argocd.argoproj.io/manifest-generate-paths: default/addons/prometheus-node-exporter/values.yaml;environments/{{.metadata.labels.environment}}/addons/prometheus-node-exporter/values.yaml;clusters/{{.nameNormalized}}/addons/prometheus-node-exporter/values.yaml;
        helm.sh/chart: gitops-bridge-1.0.0
      labels:
        helm.sh/chart: gitops-bridge-1.0.0
        app.kubernetes.io/name: gitops-bridge
        app.kubernetes.io/instance: my-release
        app.kubernetes.io/managed-by: Helm
        addon: "true"
        component: 'prometheus-node-exporter'
        environment: '{{.metadata.labels.environment}}'
        cluster: '{{.name}}'
    spec:
      project: default
      sources:
      - repoURL: '{{.metadata.annotations.addons_repo_url}}'
        targetRevision: '{{.metadata.annotations.addons_repo_revision}}'
        ref: values
      - repoURL: 'https://prometheus-community.github.io/helm-charts'
        targetRevision: '4.39.0'
        chart: 'prometheus-node-exporter'
        helm:
          releaseName: 'prometheus-node-exporter'
          ignoreMissingValueFiles: true
          valueFiles:
            - '$values/default/addons/prometheus-node-exporter/values.yaml'
            - '$values/default/addons/prometheus-node-exporter/4.39/values.yaml'
            - '$values/environments/{{.metadata.labels.environment}}/addons/prometheus-node-exporter/values.yaml'
            - '$values/environments/{{.metadata.labels.environment}}/addons/prometheus-node-exporter/4.39/values.yaml'
            - '$values/clusters/{{.nameNormalized}}/addons/prometheus-node-exporter/values.yaml'
            - '$values/clusters/{{.nameNormalized}}/addons/prometheus-node-exporter/4.39/values.yaml'
      destination:
        namespace: '{{ default "kube-prometheus-stack" (index .metadata.annotations "prometheus_node_exporter_namespace")}}'
        name: '{{.name}}'
      syncPolicy:
        automated:
          allowEmpty: true
          prune: false
          selfHeal: false
        retry:
          backoff:
            duration: 5s
            factor: 2
            maxDuration: 10m
          limit: -1
        syncOptions:
        - CreateNamespace=true
        - ServerSideApply=true
---
# Source: gitops-bridge/templates/applicationsets.yaml
apiVersion: argoproj.io/v1alpha1
kind: ApplicationSet
metadata:
  name: secrets-store-csi-driver
  namespace: argocd
  annotations:
    helm.sh/chart: gitops-bridge-1.0.0
  labels:
    helm.sh/chart: gitops-bridge-1.0.0
    app.kubernetes.io/name: gitops-bridge
    app.kubernetes.io/instance: my-release
    app.kubernetes.io/managed-by: Helm
    addon: "true"
spec:
  syncPolicy:
    preserveResourcesOnDeletion: true
  goTemplate: true
  goTemplateOptions:
  - missingkey=error
  generators:
          - clusters: # for reason this is need it as second in the matrix, if not the above extracting .tenants doesn't work
              selector:
                matchLabels:
                  argocd.argoproj.io/secret-type: cluster
                matchExpressions:
                - key: enable_secrets_store_csi_driver
                  operator: In
                  values:
                  - "true"


  template:
    metadata:
      name: addon-secrets-store-csi-driver-{{.nameNormalized}}
      annotations:
        argocd.argoproj.io/manifest-generate-paths: default/addons/secrets-store-csi-driver/values.yaml;environments/{{.metadata.labels.environment}}/addons/secrets-store-csi-driver/values.yaml;clusters/{{.nameNormalized}}/addons/secrets-store-csi-driver/values.yaml;
        helm.sh/chart: gitops-bridge-1.0.0
      labels:
        helm.sh/chart: gitops-bridge-1.0.0
        app.kubernetes.io/name: gitops-bridge
        app.kubernetes.io/instance: my-release
        app.kubernetes.io/managed-by: Helm
        addon: "true"
        component: 'secrets-store-csi-driver'
        environment: '{{.metadata.labels.environment}}'
        cluster: '{{.name}}'
    spec:
      project: default
      sources:
      - repoURL: '{{.metadata.annotations.addons_repo_url}}'
        targetRevision: '{{.metadata.annotations.addons_repo_revision}}'
        ref: values
      - repoURL: 'https://kubernetes-sigs.github.io/secrets-store-csi-driver/charts'
        targetRevision: '1.4.4'
        chart: 'secrets-store-csi-driver'
        helm:
          releaseName: 'secrets-store-csi-driver'
          ignoreMissingValueFiles: true
          valueFiles:
            - '$values/default/addons/secrets-store-csi-driver/values.yaml'
            - '$values/default/addons/secrets-store-csi-driver/1.4/values.yaml'
            - '$values/environments/{{.metadata.labels.environment}}/addons/secrets-store-csi-driver/values.yaml'
            - '$values/environments/{{.metadata.labels.environment}}/addons/secrets-store-csi-driver/1.4/values.yaml'
            - '$values/clusters/{{.nameNormalized}}/addons/secrets-store-csi-driver/values.yaml'
            - '$values/clusters/{{.nameNormalized}}/addons/secrets-store-csi-driver/1.4/values.yaml'
      destination:
        namespace: '{{ default "kube-system" (index .metadata.annotations "secrets_store_csi_driver_namespace")}}'
        name: '{{.name}}'
      syncPolicy:
        automated:
          allowEmpty: true
          prune: false
          selfHeal: false
        retry:
          backoff:
            duration: 5s
            factor: 2
            maxDuration: 10m
          limit: -1
        syncOptions:
        - CreateNamespace=true
        - ServerSideApply=true
---
# Source: gitops-bridge/templates/applicationsets.yaml
apiVersion: argoproj.io/v1alpha1
kind: ApplicationSet
metadata:
  name: velero
  namespace: argocd
  annotations:
    helm.sh/chart: gitops-bridge-1.0.0
  labels:
    helm.sh/chart: gitops-bridge-1.0.0
    app.kubernetes.io/name: gitops-bridge
    app.kubernetes.io/instance: my-release
    app.kubernetes.io/managed-by: Helm
    addon: "true"
spec:
  syncPolicy:
    preserveResourcesOnDeletion: true
  goTemplate: true
  goTemplateOptions:
  - missingkey=error
  generators:
          - clusters: # for reason this is need it as second in the matrix, if not the above extracting .tenants doesn't work
              selector:
                matchLabels:
                  argocd.argoproj.io/secret-type: cluster
                matchExpressions:
                - key: enable_velero
                  operator: In
                  values:
                  - "true"


  template:
    metadata:
      name: addon-velero-{{.nameNormalized}}
      annotations:
        argocd.argoproj.io/manifest-generate-paths: default/addons/velero/values.yaml;environments/{{.metadata.labels.environment}}/addons/velero/values.yaml;clusters/{{.nameNormalized}}/addons/velero/values.yaml;
        helm.sh/chart: gitops-bridge-1.0.0
      labels:
        helm.sh/chart: gitops-bridge-1.0.0
        app.kubernetes.io/name: gitops-bridge
        app.kubernetes.io/instance: my-release
        app.kubernetes.io/managed-by: Helm
        addon: "true"
        component: 'velero'
        environment: '{{.metadata.labels.environment}}'
        cluster: '{{.name}}'
    spec:
      project: default
      sources:
      - repoURL: '{{.metadata.annotations.addons_repo_url}}'
        targetRevision: '{{.metadata.annotations.addons_repo_revision}}'
        ref: values
      - repoURL: 'https://vmware-tanzu.github.io/helm-charts'
        targetRevision: '7.1.4'
        chart: 'velero'
        helm:
          releaseName: 'velero'
          ignoreMissingValueFiles: true
          valueFiles:
            - '$values/default/addons/velero/values.yaml'
            - '$values/default/addons/velero/7.1/values.yaml'
            - '$values/environments/{{.metadata.labels.environment}}/addons/velero/values.yaml'
            - '$values/environments/{{.metadata.labels.environment}}/addons/velero/7.1/values.yaml'
            - '$values/clusters/{{.nameNormalized}}/addons/velero/values.yaml'
            - '$values/clusters/{{.nameNormalized}}/addons/velero/7.1/values.yaml'
          valuesObject:
            configuration:
              backupStorageLocation:
              - bucket: '{{.metadata.annotations.velero_backup_s3_bucket_name}}'
                config:
                  region: '{{.metadata.annotations.aws_region}}'
                name: default
                prefix: '{{.metadata.annotations.velero_backup_s3_bucket_prefix}}'
                provider: aws
              volumeSnapshotLocation:
              - config:
                  region: '{{.metadata.annotations.aws_region}}'
                name: default
                provider: aws
            initContainers:
            - image: velero/velero-plugin-for-aws:v1.10.0
              imagePullPolicy: IfNotPresent
              name: velero-plugin-for-aws
              volumeMounts:
              - mountPath: /target
                name: plugins
            serviceAccount:
              server:
                annotations:
                  eks.amazonaws.com/role-arn: '{{.metadata.annotations.velero_iam_role_arn}}'
                name: '{{.metadata.annotations.velero_service_account}}'
      destination:
        namespace: '{{ default "kube-system" (index .metadata.annotations "velero_namespace") }}'
        name: '{{.name}}'
      syncPolicy:
        automated:
          allowEmpty: true
          prune: false
          selfHeal: false
        retry:
          backoff:
            duration: 5s
            factor: 2
            maxDuration: 10m
          limit: -1
        syncOptions:
        - CreateNamespace=true
        - ServerSideApply=true
---
# Source: gitops-bridge/templates/applicationsets.yaml
apiVersion: argoproj.io/v1alpha1
kind: ApplicationSet
metadata:
  name: volcano
  namespace: argocd
  annotations:
    helm.sh/chart: gitops-bridge-1.0.0
  labels:
    helm.sh/chart: gitops-bridge-1.0.0
    app.kubernetes.io/name: gitops-bridge
    app.kubernetes.io/instance: my-release
    app.kubernetes.io/managed-by: Helm
    addon: "true"
spec:
  syncPolicy:
    preserveResourcesOnDeletion: true
  goTemplate: true
  goTemplateOptions:
  - missingkey=error
  generators:
          - clusters: # for reason this is need it as second in the matrix, if not the above extracting .tenants doesn't work
              selector:
                matchLabels:
                  argocd.argoproj.io/secret-type: cluster
                matchExpressions:
                - key: enable_volcano
                  operator: In
                  values:
                  - "true"


  template:
    metadata:
      name: addon-volcano-{{.nameNormalized}}
      annotations:
        argocd.argoproj.io/manifest-generate-paths: default/addons/volcano/values.yaml;environments/{{.metadata.labels.environment}}/addons/volcano/values.yaml;clusters/{{.nameNormalized}}/addons/volcano/values.yaml;
        helm.sh/chart: gitops-bridge-1.0.0
        argocd.argoproj.io/compare-options: ServerSideDiff=true
      labels:
        helm.sh/chart: gitops-bridge-1.0.0
        app.kubernetes.io/name: gitops-bridge
        app.kubernetes.io/instance: my-release
        app.kubernetes.io/managed-by: Helm
        addon: "true"
        component: 'volcano'
        environment: '{{.metadata.labels.environment}}'
        cluster: '{{.name}}'
    spec:
      project: default
      sources:
      - repoURL: '{{.metadata.annotations.addons_repo_url}}'
        targetRevision: '{{.metadata.annotations.addons_repo_revision}}'
        ref: values
      - repoURL: 'https://volcano-sh.github.io/helm-charts'
        targetRevision: '1.9.0'
        chart: 'volcano'
        helm:
          releaseName: 'volcano'
          ignoreMissingValueFiles: true
          valueFiles:
            - '$values/default/addons/volcano/values.yaml'
            - '$values/default/addons/volcano/1.9/values.yaml'
            - '$values/environments/{{.metadata.labels.environment}}/addons/volcano/values.yaml'
            - '$values/environments/{{.metadata.labels.environment}}/addons/volcano/1.9/values.yaml'
            - '$values/clusters/{{.nameNormalized}}/addons/volcano/values.yaml'
            - '$values/clusters/{{.nameNormalized}}/addons/volcano/1.9/values.yaml'
      destination:
        namespace: 'volcano-system'
        name: '{{.name}}'
      syncPolicy:
        automated:
          allowEmpty: true
          prune: false
          selfHeal: false
        retry:
          backoff:
            duration: 5s
            factor: 2
            maxDuration: 10m
          limit: -1
        syncOptions:
        - CreateNamespace=true
        - ServerSideApply=true
---
# Source: gitops-bridge/templates/applicationsets.yaml
apiVersion: argoproj.io/v1alpha1
kind: ApplicationSet
metadata:
  name: vpa
  namespace: argocd
  annotations:
    helm.sh/chart: gitops-bridge-1.0.0
  labels:
    helm.sh/chart: gitops-bridge-1.0.0
    app.kubernetes.io/name: gitops-bridge
    app.kubernetes.io/instance: my-release
    app.kubernetes.io/managed-by: Helm
    addon: "true"
spec:
  syncPolicy:
    preserveResourcesOnDeletion: true
  goTemplate: true
  goTemplateOptions:
  - missingkey=error
  generators:
          - clusters: # for reason this is need it as second in the matrix, if not the above extracting .tenants doesn't work
              selector:
                matchLabels:
                  argocd.argoproj.io/secret-type: cluster
                matchExpressions:
                - key: enable_vpa
                  operator: In
                  values:
                  - "true"


  template:
    metadata:
      name: addon-vpa-{{.nameNormalized}}
      annotations:
        argocd.argoproj.io/manifest-generate-paths: default/addons/vpa/values.yaml;environments/{{.metadata.labels.environment}}/addons/vpa/values.yaml;clusters/{{.nameNormalized}}/addons/vpa/values.yaml;
        helm.sh/chart: gitops-bridge-1.0.0
      labels:
        helm.sh/chart: gitops-bridge-1.0.0
        app.kubernetes.io/name: gitops-bridge
        app.kubernetes.io/instance: my-release
        app.kubernetes.io/managed-by: Helm
        addon: "true"
        component: 'vpa'
        environment: '{{.metadata.labels.environment}}'
        cluster: '{{.name}}'
    spec:
      project: default
      sources:
      - repoURL: '{{.metadata.annotations.addons_repo_url}}'
        targetRevision: '{{.metadata.annotations.addons_repo_revision}}'
        ref: values
      - repoURL: 'https://charts.fairwinds.com/stable'
        targetRevision: '4.5.0'
        chart: 'vpa'
        helm:
          releaseName: 'vpa'
          ignoreMissingValueFiles: true
          valueFiles:
            - '$values/default/addons/vpa/values.yaml'
            - '$values/default/addons/vpa/4.5/values.yaml'
            - '$values/environments/{{.metadata.labels.environment}}/addons/vpa/values.yaml'
            - '$values/environments/{{.metadata.labels.environment}}/addons/vpa/4.5/values.yaml'
            - '$values/clusters/{{.nameNormalized}}/addons/vpa/values.yaml'
            - '$values/clusters/{{.nameNormalized}}/addons/vpa/4.5/values.yaml'
      destination:
        namespace: '{{ default "vpa" (index .metadata.annotations "vpa_namespace")}}'
        name: '{{.name}}'
      syncPolicy:
        automated:
          allowEmpty: true
          prune: false
          selfHeal: false
        retry:
          backoff:
            duration: 5s
            factor: 2
            maxDuration: 10m
          limit: -1
        syncOptions:
        - CreateNamespace=true
        - ServerSideApply=true
